    <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
    <html xmlns="http://www.w3.org/1999/xhtml">
<!--
This file was generated by Devel::NYTProf version 6.04
-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Language" content="en-us" />
    <meta name="robots" content="noindex,nofollow" />
    <title>Profile of alnmnr/io.pm</title>
    <link rel="stylesheet" type="text/css" href="style.css" />
    <script type="text/javascript" src="js/jquery-min.js"></script>

    <script type="text/javascript" src="js/jquery.floatThead.min.js"></script>
    <script type="text/javascript" src="js/jquery-tablesorter-min.js"></script>
    <link rel="stylesheet" type="text/css" href="js/style-tablesorter.css" />
    <script type="text/javascript">
    // when a column is first clicked on to sort it, use descending order
    // XXX doesn't seem to work (and not just because the tablesorter formatSortingOrder() is broken)
    $.tablesorter.defaults.sortInitialOrder = "desc";
    // add parser through the tablesorter addParser method
    $.tablesorter.addParser({
        id: 'fmt_time',   // name of this parser
        is: function(s) {
            return false; // return false so this parser is not auto detected
        },
        format: function(orig) { // format data for normalization
            // console.log(orig);
            var val = orig.replace(/ns/,'');
            if (val != orig) { return val / (1000*1000*1000); }
            val = orig.replace(/[µ\\xB5]s/,''); /* micro */
            if (val != orig) { return val / (1000*1000); }
            val = orig.replace(/ms/,'');
            if (val != orig) { return val / (1000); }
            val = orig.replace(/([0-9])s/,"$1");
            if (val != orig) { return val; }
            if (orig == '0') { return orig; }
            var non_number = orig.replace(/^[-+]?[0-9.]+/, '', 'g');
            console.log('no match for fmt_time of '+orig+' (units:'+non_number+' charCodeAt0:'+non_number.charCodeAt(0)+')');
            return orig;
        },
        type: 'numeric' // set type, either numeric or text
    });

    function show_fragment_target() {
        var tgt = $(':target');
        var table = tgt.closest('table.floatHeaders');
        if( tgt.is('a') && table.is('table.floatHeaders') )
        {
            var cury     = $(window).scrollTop();
            var fhYPos   = table.prev('.floatThead-container').offset().top;
            var thHeight = table.find('thead').first().height();
            var tYPos    = parseInt($(':target').closest('tr').position().top);
            if( tYPos < (fhYPos + thHeight) )
            {
                $(window).scrollTop(
                    tYPos - (thHeight)
                );
            }
        }
    }
    </script>
</head>

<body > 
<div class="header" style="position: relative; overflow-x: hidden; overflow-y: hidden; z-index: 0; ">
<div class="header_back">
            <a href="index.html">&larr; Index</a>
        </div>
<div class="headerForeground" style="float: left">
    <span class="siteTitle">NYTProf Performance Profile</span>
    <span class="siteSubtitle">&emsp;&emsp;<span>&laquo;&emsp;<span class="mode_btn mode_btn_selected">line view</span>&emsp;&raquo;</span><br />
            For /NGS/working_projects/AllenBrainAtlas/allenminer/src/allenminer.pl
        </span>
</div>
<div class="headerForeground" style="float: right; text-align: right">
    <span class="siteTitle">&nbsp;</span>
    <span class="siteSubtitle">Run on Tue Aug 22 15:21:37 2017<br />Reported on Tue Aug 22 15:22:46 2017</span>
</div>
<div style="position: absolute; left: 0px; top: 0%; width: 100%; height: 101%; z-index: -1; background-color: rgb(17, 136, 255); "></div>
<div style="position: absolute; left: 0px; top: 2%; width: 100%; height: 99%; z-index: -1; background-color: rgb(16, 134, 253); "></div>
<div style="position: absolute; left: 0px; top: 4%; width: 100%; height: 97%; z-index: -1; background-color: rgb(16, 133, 252); "></div>
<div style="position: absolute; left: 0px; top: 6%; width: 100%; height: 95%; z-index: -1; background-color: rgb(15, 131, 250); "></div>
<div style="position: absolute; left: 0px; top: 8%; width: 100%; height: 93%; z-index: -1; background-color: rgb(15, 130, 249); "></div>
<div style="position: absolute; left: 0px; top: 10%; width: 100%; height: 91%; z-index: -1; background-color: rgb(15, 129, 248); "></div>
<div style="position: absolute; left: 0px; top: 12%; width: 100%; height: 89%; z-index: -1; background-color: rgb(14, 127, 246); "></div>
<div style="position: absolute; left: 0px; top: 14%; width: 100%; height: 87%; z-index: -1; background-color: rgb(14, 126, 245); "></div>
<div style="position: absolute; left: 0px; top: 16%; width: 100%; height: 85%; z-index: -1; background-color: rgb(14, 125, 244); "></div>
<div style="position: absolute; left: 0px; top: 18%; width: 100%; height: 83%; z-index: -1; background-color: rgb(13, 123, 242); "></div>
<div style="position: absolute; left: 0px; top: 20%; width: 100%; height: 81%; z-index: -1; background-color: rgb(13, 122, 241); "></div>
<div style="position: absolute; left: 0px; top: 22%; width: 100%; height: 79%; z-index: -1; background-color: rgb(13, 121, 240); "></div>
<div style="position: absolute; left: 0px; top: 24%; width: 100%; height: 77%; z-index: -1; background-color: rgb(12, 119, 238); "></div>
<div style="position: absolute; left: 0px; top: 26%; width: 100%; height: 75%; z-index: -1; background-color: rgb(12, 118, 237); "></div>
<div style="position: absolute; left: 0px; top: 28%; width: 100%; height: 73%; z-index: -1; background-color: rgb(12, 116, 235); "></div>
<div style="position: absolute; left: 0px; top: 30%; width: 100%; height: 71%; z-index: -1; background-color: rgb(11, 115, 234); "></div>
<div style="position: absolute; left: 0px; top: 32%; width: 100%; height: 69%; z-index: -1; background-color: rgb(11, 114, 233); "></div>
<div style="position: absolute; left: 0px; top: 34%; width: 100%; height: 67%; z-index: -1; background-color: rgb(11, 112, 231); "></div>
<div style="position: absolute; left: 0px; top: 36%; width: 100%; height: 65%; z-index: -1; background-color: rgb(10, 111, 230); "></div>
<div style="position: absolute; left: 0px; top: 38%; width: 100%; height: 63%; z-index: -1; background-color: rgb(10, 110, 229); "></div>
<div style="position: absolute; left: 0px; top: 40%; width: 100%; height: 61%; z-index: -1; background-color: rgb(10, 108, 227); "></div>
<div style="position: absolute; left: 0px; top: 42%; width: 100%; height: 59%; z-index: -1; background-color: rgb(9, 107, 226); "></div>
<div style="position: absolute; left: 0px; top: 44%; width: 100%; height: 57%; z-index: -1; background-color: rgb(9, 106, 225); "></div>
<div style="position: absolute; left: 0px; top: 46%; width: 100%; height: 55%; z-index: -1; background-color: rgb(9, 104, 223); "></div>
<div style="position: absolute; left: 0px; top: 48%; width: 100%; height: 53%; z-index: -1; background-color: rgb(8, 103, 222); "></div>
<div style="position: absolute; left: 0px; top: 50%; width: 100%; height: 51%; z-index: -1; background-color: rgb(8, 102, 221); "></div>
<div style="position: absolute; left: 0px; top: 52%; width: 100%; height: 49%; z-index: -1; background-color: rgb(8, 100, 219); "></div>
<div style="position: absolute; left: 0px; top: 54%; width: 100%; height: 47%; z-index: -1; background-color: rgb(7, 99, 218); "></div>
<div style="position: absolute; left: 0px; top: 56%; width: 100%; height: 45%; z-index: -1; background-color: rgb(7, 97, 216); "></div>
<div style="position: absolute; left: 0px; top: 58%; width: 100%; height: 43%; z-index: -1; background-color: rgb(7, 96, 215); "></div>
<div style="position: absolute; left: 0px; top: 60%; width: 100%; height: 41%; z-index: -1; background-color: rgb(6, 95, 214); "></div>
<div style="position: absolute; left: 0px; top: 62%; width: 100%; height: 39%; z-index: -1; background-color: rgb(6, 93, 212); "></div>
<div style="position: absolute; left: 0px; top: 64%; width: 100%; height: 37%; z-index: -1; background-color: rgb(6, 92, 211); "></div>
<div style="position: absolute; left: 0px; top: 66%; width: 100%; height: 35%; z-index: -1; background-color: rgb(5, 91, 210); "></div>
<div style="position: absolute; left: 0px; top: 68%; width: 100%; height: 33%; z-index: -1; background-color: rgb(5, 89, 208); "></div>
<div style="position: absolute; left: 0px; top: 70%; width: 100%; height: 31%; z-index: -1; background-color: rgb(5, 88, 207); "></div>
<div style="position: absolute; left: 0px; top: 72%; width: 100%; height: 29%; z-index: -1; background-color: rgb(4, 87, 206); "></div>
<div style="position: absolute; left: 0px; top: 74%; width: 100%; height: 27%; z-index: -1; background-color: rgb(4, 85, 204); "></div>
<div style="position: absolute; left: 0px; top: 76%; width: 100%; height: 25%; z-index: -1; background-color: rgb(4, 84, 203); "></div>
<div style="position: absolute; left: 0px; top: 78%; width: 100%; height: 23%; z-index: -1; background-color: rgb(3, 82, 201); "></div>
<div style="position: absolute; left: 0px; top: 80%; width: 100%; height: 21%; z-index: -1; background-color: rgb(3, 81, 200); "></div>
<div style="position: absolute; left: 0px; top: 82%; width: 100%; height: 19%; z-index: -1; background-color: rgb(3, 80, 199); "></div>
<div style="position: absolute; left: 0px; top: 84%; width: 100%; height: 17%; z-index: -1; background-color: rgb(2, 78, 197); "></div>
<div style="position: absolute; left: 0px; top: 86%; width: 100%; height: 15%; z-index: -1; background-color: rgb(2, 77, 196); "></div>
<div style="position: absolute; left: 0px; top: 88%; width: 100%; height: 13%; z-index: -1; background-color: rgb(2, 76, 195); "></div>
<div style="position: absolute; left: 0px; top: 90%; width: 100%; height: 11%; z-index: -1; background-color: rgb(1, 74, 193); "></div>
<div style="position: absolute; left: 0px; top: 92%; width: 100%; height: 9%; z-index: -1; background-color: rgb(1, 73, 192); "></div>
<div style="position: absolute; left: 0px; top: 94%; width: 100%; height: 7%; z-index: -1; background-color: rgb(1, 72, 191); "></div>
<div style="position: absolute; left: 0px; top: 96%; width: 100%; height: 5%; z-index: -1; background-color: rgb(0, 70, 189); "></div>
<div style="position: absolute; left: 0px; top: 98%; width: 100%; height: 3%; z-index: -1; background-color: rgb(0, 69, 188); "></div>
<div style="position: absolute; left: 0px; top: 100%; width: 100%; height: 1%; z-index: -1; background-color: rgb(0, 68, 187); "></div>
</div>

<div class="body_content"><br />
<table class="file_summary"><tr><td class="h">Filename</td><td align="left"><a href="file:///NGS/working_projects/AllenBrainAtlas/allenminer/src/perl_api/alnmnr/io.pm">/NGS/working_projects/AllenBrainAtlas/allenminer/src/perl_api/alnmnr/io.pm</a></td></tr>
<tr><td class="h">Statements</td><td align="left">Executed 18400556 statements in 26.9s</td></tr></table>
        
        <table id="subs_table" border="1" cellpadding="0" class="tablesorter floatHeaders">
        <caption>Subroutines</caption>
        <thead>
        <tr>
        <th>Calls</th>
        <th><span title="Number of Places sub is called from">P</span></th>
        <th><span title="Number of Files sub is called from">F</span></th>
        <th>Exclusive<br />Time</th>
        <th>Inclusive<br />Time</th>
        <th>Subroutine</th>
        </tr>
        </thead>
    <tbody>
<tr><td class="c3">11</td><td class="c1">2</td><td class="c3">1</td><td class="c0"><span title="60.2%">21.6s</span></td><td class="c0"><span title="70.2%">25.2s</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::aba_parse_xpz</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#73">aba_parse_xpz</a></td></tr>
<tr><td class="c3">1</td><td class="c3">1</td><td class="c3">1</td><td class="c0"><span title="4.3%">1.54s</span></td><td class="c0"><span title="4.5%">1.62s</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::load_aba_Annotation</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#1695">load_aba_Annotation</a></td></tr>
<tr><td class="c0">3505172</td><td class="c3">1</td><td class="c3">1</td><td class="c0"><span title="3.9%">1.39s</span></td><td class="c0"><span title="3.9%">1.39s</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::CORE:unpack</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_unpack">CORE:unpack</a>&nbsp;(opcode)</td></tr>
<tr><td class="c0">3505194</td><td class="c1">2</td><td class="c3">1</td><td class="c0"><span title="2.9%">1.03s</span></td><td class="c0"><span title="2.9%">1.03s</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::CORE:read</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_read">CORE:read</a>&nbsp;(opcode)</td></tr>
<tr><td class="c3">11</td><td class="c3">1</td><td class="c3">1</td><td class="c0"><span title="1.2%">448ms</span></td><td class="c0"><span title="1.2%">448ms</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::CORE:system</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_system">CORE:system</a>&nbsp;(opcode)</td></tr>
<tr><td class="c3">1</td><td class="c3">1</td><td class="c3">1</td><td class="c0"><span title="0.3%">105ms</span></td><td class="c0"><span title="4.9%">1.76s</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::readin_roi_file</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#835">readin_roi_file</a></td></tr>
<tr><td class="c0">267454</td><td class="c0">8</td><td class="c3">1</td><td class="c0"><span title="0.3%">94.4ms</span></td><td class="c0"><span title="0.3%">94.4ms</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::CORE:readline</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_readline">CORE:readline</a>&nbsp;(opcode)</td></tr>
<tr><td class="c0">66</td><td class="c1">2</td><td class="c3">1</td><td class="c0"><span title="0.2%">74.8ms</span></td><td class="c0"><span title="0.2%">74.8ms</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::CORE:unlink</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_unlink">CORE:unlink</a>&nbsp;(opcode)</td></tr>
<tr><td class="c3">11</td><td class="c3">1</td><td class="c3">1</td><td class="c0"><span title="0.1%">44.8ms</span></td><td class="c0"><span title="0.2%">84.0ms</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::parse_image_series_xml</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#1811">parse_image_series_xml</a></td></tr>
<tr><td class="c0">58</td><td class="c0">6</td><td class="c3">1</td><td class="c0"><span title="0.1%">26.4ms</span></td><td class="c3"><span title="0.1%">26.4ms</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::CORE:open</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_open">CORE:open</a>&nbsp;(opcode)</td></tr>
<tr><td class="c3">1</td><td class="c3">1</td><td class="c3">1</td><td class="c1"><span title="0.1%">21.1ms</span></td><td class="c3"><span title="0.1%">26.4ms</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::load_aba_brainstructures</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#1440">load_aba_brainstructures</a></td></tr>
<tr><td class="c0">9052</td><td class="c0">14</td><td class="c3">1</td><td class="c1"><span title="0.1%">19.1ms</span></td><td class="c3"><span title="0.1%">19.1ms</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::CORE:match</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_match">CORE:match</a>&nbsp;(opcode)</td></tr>
<tr><td class="c3">11</td><td class="c3">1</td><td class="c3">1</td><td class="c3"><span title="0.0%">10.6ms</span></td><td class="c3"><span title="0.0%">10.6ms</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::CORE:rmdir</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_rmdir">CORE:rmdir</a>&nbsp;(opcode)</td></tr>
<tr><td class="c3">1</td><td class="c3">1</td><td class="c3">1</td><td class="c3"><span title="0.0%">7.78ms</span></td><td class="c2"><span title="0.1%">35.8ms</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::get_brainstrx_voxels</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#1548">get_brainstrx_voxels</a></td></tr>
<tr><td class="c0">70</td><td class="c0">6</td><td class="c3">1</td><td class="c3"><span title="0.0%">3.15ms</span></td><td class="c3"><span title="0.0%">3.15ms</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::CORE:ftsize</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_ftsize">CORE:ftsize</a>&nbsp;(opcode)</td></tr>
<tr><td class="c0">1728</td><td class="c1">2</td><td class="c3">1</td><td class="c3"><span title="0.0%">2.98ms</span></td><td class="c3"><span title="0.0%">2.98ms</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::CORE:subst</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_subst">CORE:subst</a>&nbsp;(opcode)</td></tr>
<tr><td class="c0">33</td><td class="c0">3</td><td class="c3">1</td><td class="c3"><span title="0.0%">2.45ms</span></td><td class="c3"><span title="0.0%">2.45ms</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::CORE:chdir</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_chdir">CORE:chdir</a>&nbsp;(opcode)</td></tr>
<tr><td class="c3">1</td><td class="c3">1</td><td class="c3">1</td><td class="c3"><span title="0.0%">1.18ms</span></td><td class="c3"><span title="0.1%">28.0ms</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::get_brainstrx_info</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#1653">get_brainstrx_info</a></td></tr>
<tr><td class="c0">58</td><td class="c0">6</td><td class="c3">1</td><td class="c3"><span title="0.0%">846µs</span></td><td class="c3"><span title="0.0%">846µs</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::CORE:close</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_close">CORE:close</a>&nbsp;(opcode)</td></tr>
<tr><td class="c0">59</td><td class="c1">2</td><td class="c3">1</td><td class="c3"><span title="0.0%">386µs</span></td><td class="c3"><span title="0.0%">386µs</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::get_kids</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#1769">get_kids</a>&nbsp;(recurses: max depth 5, inclusive time 1.04ms)</td></tr>
<tr><td class="c3">3</td><td class="c0">3</td><td class="c3">1</td><td class="c3"><span title="0.0%">64µs</span></td><td class="c3"><span title="0.0%">64µs</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::CORE:print</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_print">CORE:print</a>&nbsp;(opcode)</td></tr>
<tr><td class="c3">1</td><td class="c3">1</td><td class="c3">1</td><td class="c3"><span title="0.0%">20µs</span></td><td class="c3"><span title="0.0%">23µs</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::BEGIN@32</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#32">BEGIN@32</a></td></tr>
<tr><td class="c3">1</td><td class="c3">1</td><td class="c3">1</td><td class="c3"><span title="0.0%">8µs</span></td><td class="c3"><span title="0.0%">14µs</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::BEGIN@33</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#33">BEGIN@33</a></td></tr>
<tr><td class="c3">1</td><td class="c3">1</td><td class="c3">1</td><td class="c3"><span title="0.0%">8µs</span></td><td class="c3"><span title="0.0%">55µs</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::BEGIN@34</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#34">BEGIN@34</a></td></tr>
<tr><td class="c3">1</td><td class="c3">1</td><td class="c3">1</td><td class="c3"><span title="0.0%">8µs</span></td><td class="c3"><span title="0.0%">35µs</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::BEGIN@36</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#36">BEGIN@36</a></td></tr>
<tr><td class="c3">1</td><td class="c3">1</td><td class="c3">1</td><td class="c3"><span title="0.0%">8µs</span></td><td class="c3"><span title="0.0%">55µs</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::BEGIN@37</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#37">BEGIN@37</a></td></tr>
<tr><td class="c3">1</td><td class="c3">1</td><td class="c3">1</td><td class="c3"><span title="0.0%">7µs</span></td><td class="c3"><span title="0.0%">31µs</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::BEGIN@35</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#35">BEGIN@35</a></td></tr>
<tr><td class="c3">0</td><td class="c3">0</td><td class="c3">0</td><td class="c3"><span title="0.0%">0s</span></td><td class="c3"><span title="0.0%">0s</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::PERLZLIB_aba_parse_xpz</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#1000">PERLZLIB_aba_parse_xpz</a></td></tr>
<tr><td class="c3">0</td><td class="c3">0</td><td class="c3">0</td><td class="c3"><span title="0.0%">0s</span></td><td class="c3"><span title="0.0%">0s</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::_aba_parse_xpr_uncompress_xpr</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#627">_aba_parse_xpr_uncompress_xpr</a></td></tr>
<tr><td class="c3">0</td><td class="c3">0</td><td class="c3">0</td><td class="c3"><span title="0.0%">0s</span></td><td class="c3"><span title="0.0%">0s</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::aba_displayxpr_pdbformat</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#566">aba_displayxpr_pdbformat</a></td></tr>
<tr><td class="c3">0</td><td class="c3">0</td><td class="c3">0</td><td class="c3"><span title="0.0%">0s</span></td><td class="c3"><span title="0.0%">0s</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::aba_parse_sva</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#674">aba_parse_sva</a></td></tr>
<tr><td class="c3">0</td><td class="c3">0</td><td class="c3">0</td><td class="c3"><span title="0.0%">0s</span></td><td class="c3"><span title="0.0%">0s</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::aba_parse_xpr</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#328">aba_parse_xpr</a></td></tr>
<tr><td class="c3">0</td><td class="c3">0</td><td class="c3">0</td><td class="c3"><span title="0.0%">0s</span></td><td class="c3"><span title="0.0%">0s</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::display_roidef</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#1241">display_roidef</a></td></tr>
<tr><td class="c3">0</td><td class="c3">0</td><td class="c3">0</td><td class="c3"><span title="0.0%">0s</span></td><td class="c3"><span title="0.0%">0s</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::display_roidef_pdb</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#1278">display_roidef_pdb</a></td></tr>
<tr><td class="c3">0</td><td class="c3">0</td><td class="c3">0</td><td class="c3"><span title="0.0%">0s</span></td><td class="c3"><span title="0.0%">0s</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::downsample_aba_Annotation</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#1346">downsample_aba_Annotation</a></td></tr>
<tr><td class="c3">0</td><td class="c3">0</td><td class="c3">0</td><td class="c3"><span title="0.0%">0s</span></td><td class="c3"><span title="0.0%">0s</span></td><td class="sub_name"><span style="display: none;">alnmnr::io::::readin_1col_arr</span>alnmnr::io::<a href="alnmnr-io-pm-49-line.html#1795">readin_1col_arr</a></td></tr>
</tbody></table>
                Call graph for these subroutines as a
                <a href="http://en.wikipedia.org/wiki/Graphviz">Graphviz</a>
                <a href="NGS-working_projects-AllenBrainAtlas-allenminer-src-perl_api-alnmnr-io-pm.dot">dot language file</a>.
            
      <table border="1" cellpadding="0" class="floatHeaders">
      <thead>
      <tr><th>Line</th>
      <th><span title="Number of statements executed">State<br />ments</span></th>
      <th><span title="Time spend executing statements on the line,
        excluding time spent executing statements in any called subroutines">Time<br />on line</span></th>
      <th><span title="Number of subroutines calls">Calls</span></th>
      <th><span title="Time spent in subroutines called (inclusive)">Time<br />in subs</span></th>
      <th class="left_indent_header">Code</th>
      </tr>

      </thead>
      <tbody>
    <tr><td class="h"><a name="1"></a>1</td><td></td><td></td><td></td><td></td><td class="s">=head1 NAME</td></tr>
<tr><td class="h"><a name="2"></a>2</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="3"></a>3</td><td></td><td></td><td></td><td></td><td class="s">alnmnr::io.pm - routines to interact with ABA and ALLENMINER files</td></tr>
<tr><td class="h"><a name="4"></a>4</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="5"></a>5</td><td></td><td></td><td></td><td></td><td class="s">=head1 AUTHOR</td></tr>
<tr><td class="h"><a name="6"></a>6</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="7"></a>7</td><td></td><td></td><td></td><td></td><td class="s">Fred P. Davis (fredpdavis@gmail.com)</td></tr>
<tr><td class="h"><a name="8"></a>8</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="9"></a>9</td><td></td><td></td><td></td><td></td><td class="s">=head1 LICENCE AND COPYRIGHT</td></tr>
<tr><td class="h"><a name="10"></a>10</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="11"></a>11</td><td></td><td></td><td></td><td></td><td class="s">Copyright 2008,2011 Fred P. Davis (fredpdavis@gmail.com).</td></tr>
<tr><td class="h"><a name="12"></a>12</td><td></td><td></td><td></td><td></td><td class="s">See the file COPYING for copying permission.</td></tr>
<tr><td class="h"><a name="13"></a>13</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="14"></a>14</td><td></td><td></td><td></td><td></td><td class="s">This file is part of ALLENMINER.</td></tr>
<tr><td class="h"><a name="15"></a>15</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="16"></a>16</td><td></td><td></td><td></td><td></td><td class="s">ALLENMINER is free software: you can redistribute it and/or modify</td></tr>
<tr><td class="h"><a name="17"></a>17</td><td></td><td></td><td></td><td></td><td class="s">it under the terms of the GNU General Public License as published by</td></tr>
<tr><td class="h"><a name="18"></a>18</td><td></td><td></td><td></td><td></td><td class="s">the Free Software Foundation, either version 3 of the License, or</td></tr>
<tr><td class="h"><a name="19"></a>19</td><td></td><td></td><td></td><td></td><td class="s">(at your option) any later version.</td></tr>
<tr><td class="h"><a name="20"></a>20</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="21"></a>21</td><td></td><td></td><td></td><td></td><td class="s">ALLENMINER is distributed in the hope that it will be useful,</td></tr>
<tr><td class="h"><a name="22"></a>22</td><td></td><td></td><td></td><td></td><td class="s">but WITHOUT ANY WARRANTY; without even the implied warranty of</td></tr>
<tr><td class="h"><a name="23"></a>23</td><td></td><td></td><td></td><td></td><td class="s">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</td></tr>
<tr><td class="h"><a name="24"></a>24</td><td></td><td></td><td></td><td></td><td class="s">GNU General Public License for more details.</td></tr>
<tr><td class="h"><a name="25"></a>25</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="26"></a>26</td><td></td><td></td><td></td><td></td><td class="s">You should have received a copy of the GNU General Public License</td></tr>
<tr><td class="h"><a name="27"></a>27</td><td></td><td></td><td></td><td></td><td class="s">along with ALLENMINER.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</td></tr>
<tr><td class="h"><a name="28"></a>28</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="29"></a>29</td><td></td><td></td><td></td><td></td><td class="s">=cut</td></tr>
<tr><td class="h"><a name="30"></a>30</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="31"></a>31</td><td></td><td></td><td></td><td></td><td class="s">package alnmnr::io ;</td></tr>
<tr><td class="h"><a name="32"></a>32</td><td class="c3">2</td><td class="c3"><span title="Avg 19µs">38µs</span></td><td class="c3">2</td><td class="c3">26µs</td><td class="s"><div class="calls"><div class="calls_in"># spent 23µs (20+3) within alnmnr::io::BEGIN@32 which was called:
#    once (20µs+3µs) by alnmnr::getinp::BEGIN@38 at <a href="alnmnr-io-pm-49-line.html#32">line 32</a></div></div>use strict;<div class="calls"><div class="calls_out"># spent    23µs making 1 call to <a href="alnmnr-io-pm-49-line.html#32">alnmnr::io::BEGIN@32</a>
# spent     3µs making 1 call to <a href="strict-pm-4-line.html#60">strict::import</a></div></div></td></tr>
<tr><td class="h"><a name="33"></a>33</td><td class="c3">2</td><td class="c3"><span title="Avg 14µs">28µs</span></td><td class="c3">2</td><td class="c3">20µs</td><td class="s"><div class="calls"><div class="calls_in"># spent 14µs (8+6) within alnmnr::io::BEGIN@33 which was called:
#    once (8µs+6µs) by alnmnr::getinp::BEGIN@38 at <a href="alnmnr-io-pm-49-line.html#33">line 33</a></div></div>use warnings;<div class="calls"><div class="calls_out"># spent    14µs making 1 call to <a href="alnmnr-io-pm-49-line.html#33">alnmnr::io::BEGIN@33</a>
# spent     6µs making 1 call to <a href="warnings-pm-5-line.html#287">warnings::import</a></div></div></td></tr>
<tr><td class="h"><a name="34"></a>34</td><td class="c3">2</td><td class="c3"><span title="Avg 17µs">34µs</span></td><td class="c3">2</td><td class="c3">102µs</td><td class="s"><div class="calls"><div class="calls_in"># spent 55µs (8+47) within alnmnr::io::BEGIN@34 which was called:
#    once (8µs+47µs) by alnmnr::getinp::BEGIN@38 at <a href="alnmnr-io-pm-49-line.html#34">line 34</a></div></div>use Cwd;<div class="calls"><div class="calls_out"># spent    55µs making 1 call to <a href="alnmnr-io-pm-49-line.html#34">alnmnr::io::BEGIN@34</a>
# spent    47µs making 1 call to <a href="Exporter-pm-10-line.html#28">Exporter::import</a></div></div></td></tr>
<tr><td class="h"><a name="35"></a>35</td><td class="c3">2</td><td class="c3"><span title="Avg 17µs">33µs</span></td><td class="c3">2</td><td class="c3">55µs</td><td class="s"><div class="calls"><div class="calls_in"># spent 31µs (7+24) within alnmnr::io::BEGIN@35 which was called:
#    once (7µs+24µs) by alnmnr::getinp::BEGIN@38 at <a href="alnmnr-io-pm-49-line.html#35">line 35</a></div></div>use File::Path qw/mkpath/ ;<div class="calls"><div class="calls_out"># spent    31µs making 1 call to <a href="alnmnr-io-pm-49-line.html#35">alnmnr::io::BEGIN@35</a>
# spent    24µs making 1 call to <a href="Exporter-pm-10-line.html#28">Exporter::import</a></div></div></td></tr>
<tr><td class="h"><a name="36"></a>36</td><td class="c3">2</td><td class="c3"><span title="Avg 20µs">39µs</span></td><td class="c3">2</td><td class="c3">62µs</td><td class="s"><div class="calls"><div class="calls_in"># spent 35µs (8+27) within alnmnr::io::BEGIN@36 which was called:
#    once (8µs+27µs) by alnmnr::getinp::BEGIN@38 at <a href="alnmnr-io-pm-49-line.html#36">line 36</a></div></div>use File::Temp qw/tempfile tempdir/ ;<div class="calls"><div class="calls_out"># spent    35µs making 1 call to <a href="alnmnr-io-pm-49-line.html#36">alnmnr::io::BEGIN@36</a>
# spent    27µs making 1 call to <a href="Exporter-pm-10-line.html#28">Exporter::import</a></div></div></td></tr>
<tr><td class="h"><a name="37"></a>37</td><td class="c3">2</td><td class="c0"><span title="Avg 5.41ms">10.8ms</span></td><td class="c3">2</td><td class="c3">103µs</td><td class="s"><div class="calls"><div class="calls_in"># spent 55µs (8+48) within alnmnr::io::BEGIN@37 which was called:
#    once (8µs+48µs) by alnmnr::getinp::BEGIN@38 at <a href="alnmnr-io-pm-49-line.html#37">line 37</a></div></div>use POSIX qw/floor ceil/ ;<div class="calls"><div class="calls_out"># spent    55µs making 1 call to <a href="alnmnr-io-pm-49-line.html#37">alnmnr::io::BEGIN@37</a>
# spent    48µs making 1 call to <a href="POSIX-pm-44-line.html#21">POSIX::import</a></div></div></td></tr>
<tr><td class="h"><a name="38"></a>38</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="39"></a>39</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="40"></a>40</td><td></td><td></td><td></td><td></td><td class="s">=head2 aba_parse_xpz()</td></tr>
<tr><td class="h"><a name="41"></a>41</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="42"></a>42</td><td></td><td></td><td></td><td></td><td class="s">   Title:       aba_parse_xpz()</td></tr>
<tr><td class="h"><a name="43"></a>43</td><td></td><td></td><td></td><td></td><td class="s">   Function:    Parses binary ABA XPZ files and converts it to a tab-delimited</td></tr>
<tr><td class="h"><a name="44"></a>44</td><td></td><td></td><td></td><td></td><td class="s">                  text format or a PDB file (XPZ = Developing mouse atlas)</td></tr>
<tr><td class="h"><a name="45"></a>45</td><td></td><td></td><td></td><td></td><td class="s">   Args:        $_-&gt;{xpz} - XPZ file path</td></tr>
<tr><td class="h"><a name="46"></a>46</td><td></td><td></td><td></td><td></td><td class="s">                $_-&gt;{out_xyz} - file name for XYZ output [optional]</td></tr>
<tr><td class="h"><a name="47"></a>47</td><td></td><td></td><td></td><td></td><td class="s">                $_-&gt;{out_pdb} - file name for PDB format output [optional]</td></tr>
<tr><td class="h"><a name="48"></a>48</td><td></td><td></td><td></td><td></td><td class="s">                $_-&gt;{out_data} - flag to return hash holding data</td></tr>
<tr><td class="h"><a name="49"></a>49</td><td></td><td></td><td></td><td></td><td class="s">                $_-&gt;{roidef} - optional; if specified, only stores points in ROI</td></tr>
<tr><td class="h"><a name="50"></a>50</td><td></td><td></td><td></td><td></td><td class="s">                $_-&gt;{energy_fl} - optional; if specified, sends back xyz hash</td></tr>
<tr><td class="h"><a name="51"></a>51</td><td></td><td></td><td></td><td></td><td class="s">                                  pointing to `energy' surrogate.</td></tr>
<tr><td class="h"><a name="52"></a>52</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="53"></a>53</td><td></td><td></td><td></td><td></td><td class="s">                     Energy = Intensity * sqrt(Density)</td></tr>
<tr><td class="h"><a name="54"></a>54</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="55"></a>55</td><td></td><td></td><td></td><td></td><td class="s">                     We don't have the raw pixel/cube mapping to get the 'real'</td></tr>
<tr><td class="h"><a name="56"></a>56</td><td></td><td></td><td></td><td></td><td class="s">                     energy per ABA White Paper. this should do for now.</td></tr>
<tr><td class="h"><a name="57"></a>57</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="58"></a>58</td><td></td><td></td><td></td><td></td><td class="s">   Returns:     $-&gt;{} (if $_-&gt;{out_data} is specified}</td></tr>
<tr><td class="h"><a name="59"></a>59</td><td></td><td></td><td></td><td></td><td class="s">   File out:    XYZ output (in $_-&gt;{out_xyz}, if specified}</td></tr>
<tr><td class="h"><a name="60"></a>60</td><td></td><td></td><td></td><td></td><td class="s">                  1. x</td></tr>
<tr><td class="h"><a name="61"></a>61</td><td></td><td></td><td></td><td></td><td class="s">                  2. y</td></tr>
<tr><td class="h"><a name="62"></a>62</td><td></td><td></td><td></td><td></td><td class="s">                  3. z</td></tr>
<tr><td class="h"><a name="63"></a>63</td><td></td><td></td><td></td><td></td><td class="s">                  4. density</td></tr>
<tr><td class="h"><a name="64"></a>64</td><td></td><td></td><td></td><td></td><td class="s">                  5. intensity</td></tr>
<tr><td class="h"><a name="65"></a>65</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="66"></a>66</td><td></td><td></td><td></td><td></td><td class="s">  NOTE: Density values in the Brain Explorer are floor(VALUE/65)</td></tr>
<tr><td class="h"><a name="67"></a>67</td><td></td><td></td><td></td><td></td><td class="s">  NOTE: Density values also stored as 'num_expressors' and</td></tr>
<tr><td class="h"><a name="68"></a>68</td><td></td><td></td><td></td><td></td><td class="s">        intensity values as 'expression_level' so XPR routines can</td></tr>
<tr><td class="h"><a name="69"></a>69</td><td></td><td></td><td></td><td></td><td class="s">        be reused on XPZ files without significant modification.</td></tr>
<tr><td class="h"><a name="70"></a>70</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="71"></a>71</td><td></td><td></td><td></td><td></td><td class="s">=cut</td></tr>
<tr><td class="h"><a name="72"></a>72</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="73"></a>73</td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 25.2s (21.6+3.62) within alnmnr::io::aba_parse_xpz which was called 11 times, avg 2.29s/call:
# 10 times (19.6s+3.28s) by alnmnr::runs::_run_simsearch at <a href="alnmnr-runs-pm-50-line.html#717">line 717 of alnmnr/runs.pm</a>, avg 2.29s/call
#     once (2.02s+336ms) by alnmnr::runs::_run_simsearch at <a href="alnmnr-runs-pm-50-line.html#685">line 685 of alnmnr/runs.pm</a></div></div>sub aba_parse_xpz {</td></tr>
<tr><td class="h"><a name="74"></a>74</td><td class="c3">11</td><td class="c1"><span title="Avg 7µs">81µs</span></td><td></td><td></td><td class="s">   require File::Basename ;</td></tr>
<tr><td class="h"><a name="75"></a>75</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="76"></a>76</td><td></td><td></td><td></td><td></td><td class="s"># XPZ file are ZIP archives of:</td></tr>
<tr><td class="h"><a name="77"></a>77</td><td></td><td></td><td></td><td></td><td class="s"># 1. image_series.xml - contains meta info (ascii)</td></tr>
<tr><td class="h"><a name="78"></a>78</td><td></td><td></td><td></td><td></td><td class="s"># 2. intensity.mhd - header file describing intensity file format (ascii)</td></tr>
<tr><td class="h"><a name="79"></a>79</td><td></td><td></td><td></td><td></td><td class="s"># 3. intensity.raw - raw intensity data (binary format)</td></tr>
<tr><td class="h"><a name="80"></a>80</td><td></td><td></td><td></td><td></td><td class="s"># 4. density.mhd - header file describing density file format (ascii)</td></tr>
<tr><td class="h"><a name="81"></a>81</td><td></td><td></td><td></td><td></td><td class="s"># 5. density.raw - raw density data (binary format)</td></tr>
<tr><td class="h"><a name="82"></a>82</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="83"></a>83</td><td class="c3">11</td><td class="c3"><span title="Avg 791ns">9µs</span></td><td></td><td></td><td class="s">   my $in = shift ;</td></tr>
<tr><td class="h"><a name="84"></a>84</td><td class="c3">11</td><td class="c3"><span title="Avg 2µs">24µs</span></td><td></td><td></td><td class="s">   my ($fn, $fh) ;</td></tr>
<tr><td class="h"><a name="85"></a>85</td><td class="c3">11</td><td class="c3"><span title="Avg 855ns">9µs</span></td><td></td><td></td><td class="s">   if (!exists $in-&gt;{fn}) {</td></tr>
<tr><td class="h"><a name="86"></a>86</td><td></td><td></td><td></td><td></td><td class="s">      die &quot;XPZ file not specified&quot; ; }</td></tr>
<tr><td class="h"><a name="87"></a>87</td><td class="c3">11</td><td class="c0"><span title="Avg 45µs">495µs</span></td><td class="c3">11</td><td class="c3">419µs</td><td class="s">   if (!-s $in-&gt;{fn})     {<div class="calls"><div class="calls_out">   # spent   419µs making 11 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_ftsize">alnmnr::io::CORE:ftsize</a>, avg 38µs/call</div></div></td></tr>
<tr><td class="h"><a name="88"></a>88</td><td></td><td></td><td></td><td></td><td class="s">      print STDERR &quot;XPZ file $in-&gt;{fn} not found &quot; ;</td></tr>
<tr><td class="h"><a name="89"></a>89</td><td></td><td></td><td></td><td></td><td class="s">      return {error_fl =&gt; &quot;file not found &quot;} ;</td></tr>
<tr><td class="h"><a name="90"></a>90</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="91"></a>91</td><td class="c3">11</td><td class="c3"><span title="Avg 2µs">21µs</span></td><td></td><td></td><td class="s">   $fn-&gt;{xpz} = $in-&gt;{fn} ;</td></tr>
<tr><td class="h"><a name="92"></a>92</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="93"></a>93</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="94"></a>94</td><td class="c3">11</td><td class="c3"><span title="Avg 845ns">9µs</span></td><td></td><td></td><td class="s">   my $data = {};</td></tr>
<tr><td class="h"><a name="95"></a>95</td><td class="c3">11</td><td class="c0"><span title="Avg 12µs">134µs</span></td><td class="c3">11</td><td class="c0">1.27ms</td><td class="s">   $data-&gt;{meta}-&gt;{xpz_name} = File::Basename::basename($fn-&gt;{xpz}) ;<div class="calls"><div class="calls_out">   # spent  1.27ms making 11 calls to <a href="File-Basename-pm-19-line.html#214">File::Basename::basename</a>, avg 116µs/call</div></div></td></tr>
<tr><td class="h"><a name="96"></a>96</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="97"></a>97</td><td></td><td></td><td></td><td></td><td class="s"># 0. Make a temporary directory and unzip the file.</td></tr>
<tr><td class="h"><a name="98"></a>98</td><td></td><td></td><td></td><td></td><td class="s">   </td></tr>
<tr><td class="h"><a name="99"></a>99</td><td class="c3">11</td><td class="c0"><span title="Avg 32µs">352µs</span></td><td class="c3">11</td><td class="c3">272µs</td><td class="s">   my $pwd = getcwd ;<div class="calls"><div class="calls_out">   # spent   272µs making 11 calls to <a href="Cwd-pm-11-line.html#Cwd__getcwd">Cwd::getcwd</a>, avg 25µs/call</div></div></td></tr>
<tr><td class="h"><a name="100"></a>100</td><td class="c3">11</td><td class="c0"><span title="Avg 28µs">306µs</span></td><td class="c3">11</td><td class="c0">31.9ms</td><td class="s">   my $unzip_dir = tempdir(&quot;unzip_xpz_XXXXX&quot;) ;<div class="calls"><div class="calls_out">   # spent  31.9ms making 11 calls to <a href="File-Temp-pm-12-line.html#1137">File::Temp::tempdir</a>, avg 2.90ms/call</div></div></td></tr>
<tr><td class="h"><a name="101"></a>101</td><td class="c3">11</td><td class="c0"><span title="Avg 16µs">175µs</span></td><td class="c3">11</td><td class="c0">46.1ms</td><td class="s">   alnmnr::core::safe_copy($fn-&gt;{xpz}, $unzip_dir) ;<div class="calls"><div class="calls_out">   # spent  46.1ms making 11 calls to <a href="alnmnr-core-pm-51-line.html#975">alnmnr::core::safe_copy</a>, avg 4.19ms/call</div></div></td></tr>
<tr><td class="h"><a name="102"></a>102</td><td class="c3">11</td><td class="c0"><span title="Avg 16µs">171µs</span></td><td class="c3">11</td><td class="c3">87µs</td><td class="s">   chdir($unzip_dir);<div class="calls"><div class="calls_out">   # spent    87µs making 11 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_chdir">alnmnr::io::CORE:chdir</a>, avg 8µs/call</div></div></td></tr>
<tr><td class="h"><a name="103"></a>103</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="104"></a>104</td><td class="c3">11</td><td class="c0"><span title="Avg 40.8ms">448ms</span></td><td class="c3">11</td><td class="c0">448ms</td><td class="s">   system(&quot;unzip &quot;.$data-&gt;{meta}-&gt;{xpz_name}.&quot; &gt; /dev/null&quot;) ;<div class="calls"><div class="calls_out">   # spent   448ms making 11 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_system">alnmnr::io::CORE:system</a>, avg 40.7ms/call</div></div></td></tr>
<tr><td class="h"><a name="105"></a>105</td><td class="c3">11</td><td class="c0"><span title="Avg 29µs">318µs</span></td><td class="c3">11</td><td class="c3">196µs</td><td class="s">   chdir($pwd) ;<div class="calls"><div class="calls_out">   # spent   196µs making 11 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_chdir">alnmnr::io::CORE:chdir</a>, avg 18µs/call</div></div></td></tr>
<tr><td class="h"><a name="106"></a>106</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="107"></a>107</td><td class="c3">11</td><td class="c0"><span title="Avg 41µs">451µs</span></td><td></td><td></td><td class="s">   my @expected_files = ('image_series.xml', 'intensity.mhd', 'intensity.raw',</td></tr>
<tr><td class="h"><a name="108"></a>108</td><td></td><td></td><td></td><td></td><td class="s">                         'density.mhd', 'density.raw') ;</td></tr>
<tr><td class="h"><a name="109"></a>109</td><td class="c3">11</td><td class="c1"><span title="Avg 7µs">76µs</span></td><td></td><td></td><td class="s">   foreach my $cur_fn (@expected_files) {</td></tr>
<tr><td class="h"><a name="110"></a>110</td><td class="c0">55</td><td class="c0"><span title="Avg 12µs">673µs</span></td><td class="c0">55</td><td class="c3">324µs</td><td class="s">      if (!-s $unzip_dir.'/'.$cur_fn) {<div class="calls"><div class="calls_out">      # spent   324µs making 55 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_ftsize">alnmnr::io::CORE:ftsize</a>, avg 6µs/call</div></div></td></tr>
<tr><td class="h"><a name="111"></a>111</td><td></td><td></td><td></td><td></td><td class="s">         return {error_fl =&gt;</td></tr>
<tr><td class="h"><a name="112"></a>112</td><td></td><td></td><td></td><td></td><td class="s">                 &quot;Fatal error: $fn-&gt;{xpz} XPZ file did not contain $cur_fn&quot;};</td></tr>
<tr><td class="h"><a name="113"></a>113</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="114"></a>114</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="115"></a>115</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="116"></a>116</td><td></td><td></td><td></td><td></td><td class="s"># energy_only flag set if only vector of energy values wanted for simsearch</td></tr>
<tr><td class="h"><a name="117"></a>117</td><td class="c3">11</td><td class="c3"><span title="Avg 1µs">13µs</span></td><td></td><td></td><td class="s">   my $energy_only = 0 ;</td></tr>
<tr><td class="h"><a name="118"></a>118</td><td class="c3">11</td><td class="c0"><span title="Avg 22µs">238µs</span></td><td></td><td></td><td class="s">   if (exists $in-&gt;{energy_only} &amp;&amp; $in-&gt;{energy_only} == 1) {</td></tr>
<tr><td class="h"><a name="119"></a>119</td><td></td><td></td><td></td><td></td><td class="s">      $energy_only = 1 ; }</td></tr>
<tr><td class="h"><a name="120"></a>120</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="121"></a>121</td><td></td><td></td><td></td><td></td><td class="s"># 1. Parse image-series meta info</td></tr>
<tr><td class="h"><a name="122"></a>122</td><td></td><td></td><td></td><td></td><td class="s">#   $data-&gt;{meta}-&gt;{imageseries} = read_xpz_imageseries_file(&quot;image_series.xml&quot;);</td></tr>
<tr><td class="h"><a name="123"></a>123</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="124"></a>124</td><td></td><td></td><td></td><td></td><td class="s">   parse_image_series_xml({</td></tr>
<tr><td class="h"><a name="125"></a>125</td><td class="c3">11</td><td class="c0"><span title="Avg 50µs">550µs</span></td><td class="c3">11</td><td class="c0">84.0ms</td><td class="s">      data      =&gt; $data,<div class="calls"><div class="calls_out">      # spent  84.0ms making 11 calls to <a href="alnmnr-io-pm-49-line.html#1811">alnmnr::io::parse_image_series_xml</a>, avg 7.63ms/call</div></div></td></tr>
<tr><td class="h"><a name="126"></a>126</td><td></td><td></td><td></td><td></td><td class="s">      fn        =&gt; $unzip_dir.'/image_series.xml'</td></tr>
<tr><td class="h"><a name="127"></a>127</td><td></td><td></td><td></td><td></td><td class="s">   }) ;</td></tr>
<tr><td class="h"><a name="128"></a>128</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="129"></a>129</td><td></td><td></td><td></td><td></td><td class="s"># 2. Parse intensity header file</td></tr>
<tr><td class="h"><a name="130"></a>130</td><td></td><td></td><td></td><td></td><td class="s">#-------------------------------</td></tr>
<tr><td class="h"><a name="131"></a>131</td><td></td><td></td><td></td><td></td><td class="s"># ObjectType = Image</td></tr>
<tr><td class="h"><a name="132"></a>132</td><td></td><td></td><td></td><td></td><td class="s"># NDims = 3</td></tr>
<tr><td class="h"><a name="133"></a>133</td><td></td><td></td><td></td><td></td><td class="s"># BinaryData = True</td></tr>
<tr><td class="h"><a name="134"></a>134</td><td></td><td></td><td></td><td></td><td class="s"># BinaryDataByteOrderMSB = False</td></tr>
<tr><td class="h"><a name="135"></a>135</td><td></td><td></td><td></td><td></td><td class="s"># CompressedData = False</td></tr>
<tr><td class="h"><a name="136"></a>136</td><td></td><td></td><td></td><td></td><td class="s"># TransformMatrix = 1 0 0 0 1 0 0 0 1</td></tr>
<tr><td class="h"><a name="137"></a>137</td><td></td><td></td><td></td><td></td><td class="s"># Offset = 0 0 -160</td></tr>
<tr><td class="h"><a name="138"></a>138</td><td></td><td></td><td></td><td></td><td class="s"># CenterOfRotation = 0 0 0</td></tr>
<tr><td class="h"><a name="139"></a>139</td><td></td><td></td><td></td><td></td><td class="s"># AnatomicalOrientation = RAI</td></tr>
<tr><td class="h"><a name="140"></a>140</td><td></td><td></td><td></td><td></td><td class="s"># ElementSpacing = 80 80 80</td></tr>
<tr><td class="h"><a name="141"></a>141</td><td></td><td></td><td></td><td></td><td class="s"># DimSize = 70 75 40</td></tr>
<tr><td class="h"><a name="142"></a>142</td><td></td><td></td><td></td><td></td><td class="s"># ElementType = MET_UCHAR</td></tr>
<tr><td class="h"><a name="143"></a>143</td><td></td><td></td><td></td><td></td><td class="s"># ElementDataFile = intensity.raw</td></tr>
<tr><td class="h"><a name="144"></a>144</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="145"></a>145</td><td class="c3">11</td><td class="c3"><span title="Avg 2µs">19µs</span></td><td></td><td></td><td class="s">   my $raw_data = {};</td></tr>
<tr><td class="h"><a name="146"></a>146</td><td class="c3">11</td><td class="c3"><span title="Avg 1µs">13µs</span></td><td></td><td></td><td class="s">   my $max_val = {} ;</td></tr>
<tr><td class="h"><a name="147"></a>147</td><td class="c3">11</td><td class="c3"><span title="Avg 3µs">32µs</span></td><td></td><td></td><td class="s">   foreach my $file_type (qw/intensity density/) {</td></tr>
<tr><td class="h"><a name="148"></a>148</td><td class="c1">22</td><td class="c0"><span title="Avg 529µs">11.6ms</span></td><td class="c1">22</td><td class="c0">11.3ms</td><td class="s">      open(MHD, $unzip_dir.'/'.$file_type.'.mhd') ;<div class="calls"><div class="calls_out">      # spent  11.3ms making 22 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_open">alnmnr::io::CORE:open</a>, avg 512µs/call</div></div></td></tr>
<tr><td class="h"><a name="149"></a>149</td><td class="c1">22</td><td class="c0"><span title="Avg 61µs">1.34ms</span></td><td class="c0">308</td><td class="c2">502µs</td><td class="s">      while(my $line = &lt;MHD&gt;) {<div class="calls"><div class="calls_out">      # spent   502µs making 308 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_readline">alnmnr::io::CORE:readline</a>, avg 2µs/call</div></div></td></tr>
<tr><td class="h"><a name="150"></a>150</td><td class="c0">286</td><td class="c0"><span title="Avg 464ns">133µs</span></td><td></td><td></td><td class="s">         chomp $line ;</td></tr>
<tr><td class="h"><a name="151"></a>151</td><td class="c0">286</td><td class="c0"><span title="Avg 3µs">851µs</span></td><td></td><td></td><td class="s">         my ($key, $val) = split(' = ', $line) ;</td></tr>
<tr><td class="h"><a name="152"></a>152</td><td class="c0">286</td><td class="c0"><span title="Avg 3µs">855µs</span></td><td></td><td></td><td class="s">         $data-&gt;{meta}-&gt;{$file_type}-&gt;{$key} = $val ;</td></tr>
<tr><td class="h"><a name="153"></a>153</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="154"></a>154</td><td class="c1">22</td><td class="c0"><span title="Avg 12µs">254µs</span></td><td class="c1">22</td><td class="c3">125µs</td><td class="s">      close(MHD) ;<div class="calls"><div class="calls_out">      # spent   125µs making 22 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_close">alnmnr::io::CORE:close</a>, avg 6µs/call</div></div></td></tr>
<tr><td class="h"><a name="155"></a>155</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="156"></a>156</td><td></td><td></td><td></td><td></td><td class="s">      ($data-&gt;{meta}-&gt;{dims_x},</td></tr>
<tr><td class="h"><a name="157"></a>157</td><td></td><td></td><td></td><td></td><td class="s">       $data-&gt;{meta}-&gt;{dims_y},</td></tr>
<tr><td class="h"><a name="158"></a>158</td><td></td><td></td><td></td><td></td><td class="s">       $data-&gt;{meta}-&gt;{dims_z}) = split(' ',</td></tr>
<tr><td class="h"><a name="159"></a>159</td><td class="c1">22</td><td class="c0"><span title="Avg 11µs">235µs</span></td><td></td><td></td><td class="s">         $data-&gt;{meta}-&gt;{$file_type}-&gt;{DimSize}) ;</td></tr>
<tr><td class="h"><a name="160"></a>160</td><td class="c1">22</td><td class="c3"><span title="Avg 1µs">31µs</span></td><td></td><td></td><td class="s">      my $element_type = $data-&gt;{meta}-&gt;{$file_type}-&gt;{ElementType} ;</td></tr>
<tr><td class="h"><a name="161"></a>161</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="162"></a>162</td><td></td><td></td><td></td><td></td><td class="s">#MET_UCHAR = 1 byte; MET_USHORT = 2 byte</td></tr>
<tr><td class="h"><a name="163"></a>163</td><td class="c1">22</td><td class="c3"><span title="Avg 409ns">9µs</span></td><td></td><td></td><td class="s">      my ($read_size, $unpack_tmpl) ;</td></tr>
<tr><td class="h"><a name="164"></a>164</td><td class="c1">22</td><td class="c3"><span title="Avg 2µs">47µs</span></td><td></td><td></td><td class="s">      if ($element_type eq 'MET_UCHAR') {</td></tr>
<tr><td class="h"><a name="165"></a>165</td><td class="c3">11</td><td class="c3"><span title="Avg 464ns">5µs</span></td><td></td><td></td><td class="s">         $read_size = 1 ;</td></tr>
<tr><td class="h"><a name="166"></a>166</td><td class="c3">11</td><td class="c3"><span title="Avg 1µs">16µs</span></td><td></td><td></td><td class="s">         $unpack_tmpl = 'C8' ;</td></tr>
<tr><td class="h"><a name="167"></a>167</td><td></td><td></td><td></td><td></td><td class="s">      } elsif ($element_type eq 'MET_USHORT') {</td></tr>
<tr><td class="h"><a name="168"></a>168</td><td class="c3">11</td><td class="c3"><span title="Avg 236ns">3µs</span></td><td></td><td></td><td class="s">         $read_size = 2 ;</td></tr>
<tr><td class="h"><a name="169"></a>169</td><td class="c3">11</td><td class="c3"><span title="Avg 2µs">21µs</span></td><td></td><td></td><td class="s">         $unpack_tmpl = 'S' ;</td></tr>
<tr><td class="h"><a name="170"></a>170</td><td></td><td></td><td></td><td></td><td class="s">      } else {</td></tr>
<tr><td class="h"><a name="171"></a>171</td><td></td><td></td><td></td><td></td><td class="s">         return {error_fl =&gt; &quot;FATAL ERROR: $fn-&gt;{xpz}/$file_type.raw&quot;.</td></tr>
<tr><td class="h"><a name="172"></a>172</td><td></td><td></td><td></td><td></td><td class="s">                             &quot; ElementType $element_type not recognized\n&quot; };</td></tr>
<tr><td class="h"><a name="173"></a>173</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="174"></a>174</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="175"></a>175</td><td class="c1">22</td><td class="c0"><span title="Avg 451µs">9.92ms</span></td><td class="c1">22</td><td class="c0">9.62ms</td><td class="s">      open(RAW, $unzip_dir.'/'.$file_type.'.raw') ;<div class="calls"><div class="calls_out">      # spent  9.62ms making 22 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_open">alnmnr::io::CORE:open</a>, avg 437µs/call</div></div></td></tr>
<tr><td class="h"><a name="176"></a>176</td><td class="c1">22</td><td class="c3"><span title="Avg 459ns">10µs</span></td><td></td><td></td><td class="s">      my $buffer ;</td></tr>
<tr><td class="h"><a name="177"></a>177</td><td class="c1">22</td><td class="c3"><span title="Avg 2µs">40µs</span></td><td></td><td></td><td class="s">      my ($cur_x, $cur_z, $cur_y) = (0,0,0) ;</td></tr>
<tr><td class="h"><a name="178"></a>178</td><td class="c1">22</td><td class="c0"><span title="Avg 23µs">508µs</span></td><td class="c1">22</td><td class="c3">334µs</td><td class="s">      while (read(RAW, $buffer, $read_size)) {<div class="calls"><div class="calls_out">      # spent   334µs making 22 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_read">alnmnr::io::CORE:read</a>, avg 15µs/call</div></div></td></tr>
<tr><td class="h"><a name="179"></a>179</td><td class="c0">3505172</td><td class="c0"><span title="Avg 2µs">8.29s</span></td><td class="c0">3505172</td><td class="c0">1.39s</td><td class="s">         my $val = unpack($unpack_tmpl, $buffer) ;<div class="calls"><div class="calls_out">         # spent  1.39s making 3505172 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_unpack">alnmnr::io::CORE:unpack</a>, avg 396ns/call</div></div></td></tr>
<tr><td class="h"><a name="180"></a>180</td><td class="c0">3505172</td><td class="c0"><span title="Avg 348ns">1.22s</span></td><td></td><td></td><td class="s">         push @{$raw_data-&gt;{$file_type}}, $val ;</td></tr>
<tr><td class="h"><a name="181"></a>181</td><td class="c0">3505172</td><td class="c0"><span title="Avg 3µs">9.59s</span></td><td class="c0">3505172</td><td class="c0">1.03s</td><td class="s">         if (!exists $max_val-&gt;{$file_type} ||<div class="calls"><div class="calls_out">         # spent  1.03s making 3505172 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_read">alnmnr::io::CORE:read</a>, avg 294ns/call</div></div></td></tr>
<tr><td class="h"><a name="182"></a>182</td><td></td><td></td><td></td><td></td><td class="s">             $val &gt; $max_val-&gt;{$file_type}) {</td></tr>
<tr><td class="h"><a name="183"></a>183</td><td></td><td></td><td></td><td></td><td class="s">            $max_val-&gt;{$file_type} = $val ;</td></tr>
<tr><td class="h"><a name="184"></a>184</td><td></td><td></td><td></td><td></td><td class="s">         }</td></tr>
<tr><td class="h"><a name="185"></a>185</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="186"></a>186</td><td class="c1">22</td><td class="c0"><span title="Avg 38µs">834µs</span></td><td class="c1">22</td><td class="c2">536µs</td><td class="s">      close(RAW) ;<div class="calls"><div class="calls_out">      # spent   536µs making 22 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_close">alnmnr::io::CORE:close</a>, avg 24µs/call</div></div></td></tr>
<tr><td class="h"><a name="187"></a>187</td><td></td><td></td><td></td><td></td><td class="s">#      print STDERR &quot;MAX $file_type: &quot;.$max_val-&gt;{$file_type}.&quot;\n&quot;;</td></tr>
<tr><td class="h"><a name="188"></a>188</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="189"></a>189</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="190"></a>190</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="191"></a>191</td><td class="c3">11</td><td class="c0"><span title="Avg 17µs">189µs</span></td><td></td><td></td><td class="s">   my $xy_plane_size = $data-&gt;{meta}-&gt;{dims_x} * $data-&gt;{meta}-&gt;{dims_y} ;</td></tr>
<tr><td class="h"><a name="192"></a>192</td><td class="c3">11</td><td class="c2"><span title="Avg 6µs">70µs</span></td><td></td><td></td><td class="s">   $data-&gt;{xyz} = [] ;</td></tr>
<tr><td class="h"><a name="193"></a>193</td><td class="c3">11</td><td class="c0"><span title="Avg 24.0ms">264ms</span></td><td></td><td></td><td class="s">   foreach my $j ( 0 .. $#{$raw_data-&gt;{intensity}}) {</td></tr>
<tr><td class="h"><a name="194"></a>194</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="195"></a>195</td><td></td><td></td><td></td><td></td><td class="s">#NOTE: fpd111224_0715  - what is the conversion code for density?</td></tr>
<tr><td class="h"><a name="196"></a>196</td><td></td><td></td><td></td><td></td><td class="s"># per e-notebook 2010-Oct-22 Brain Explorer 2 displays density as floor(VAL/65)</td></tr>
<tr><td class="h"><a name="197"></a>197</td><td class="c0">1752586</td><td class="c0"><span title="Avg 344ns">603ms</span></td><td></td><td></td><td class="s">      $raw_data-&gt;{density}-&gt;[$j] /= 65535 ;</td></tr>
<tr><td class="h"><a name="198"></a>198</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="199"></a>199</td><td class="c0">1752586</td><td class="c0"><span title="Avg 246ns">432ms</span></td><td></td><td></td><td class="s">      if ($raw_data-&gt;{density}-&gt;[$j]   == 0 ||</td></tr>
<tr><td class="h"><a name="200"></a>200</td><td class="c0">1376898</td><td class="c0"><span title="Avg 102ns">140ms</span></td><td></td><td></td><td class="s">          $raw_data-&gt;{intensity}-&gt;[$j] == 0) {next;}</td></tr>
<tr><td class="h"><a name="201"></a>201</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="202"></a>202</td><td class="c0">375688</td><td class="c0"><span title="Avg 4µs">1.32s</span></td><td class="c0">375688</td><td class="c0">291ms</td><td class="s">      my $z = POSIX::floor($j / $xy_plane_size) ;<div class="calls"><div class="calls_out">      # spent   291ms making 375688 calls to <a href="POSIX-pm-44-line.html#POSIX__floor">POSIX::floor</a>, avg 774ns/call</div></div></td></tr>
<tr><td class="h"><a name="203"></a>203</td><td></td><td></td><td></td><td></td><td class="s">      my $y = POSIX::floor(($j - $z * $xy_plane_size) /</td></tr>
<tr><td class="h"><a name="204"></a>204</td><td class="c0">375688</td><td class="c0"><span title="Avg 3µs">1.26s</span></td><td class="c0">375688</td><td class="c0">184ms</td><td class="s">                              $data-&gt;{meta}-&gt;{dims_x}) ;<div class="calls"><div class="calls_out">                              # spent   184ms making 375688 calls to <a href="POSIX-pm-44-line.html#POSIX__floor">POSIX::floor</a>, avg 489ns/call</div></div></td></tr>
<tr><td class="h"><a name="205"></a>205</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="206"></a>206</td><td class="c0">375688</td><td class="c0"><span title="Avg 371ns">139ms</span></td><td></td><td></td><td class="s">      my $x = $j - $z * $xy_plane_size - $y * $data-&gt;{meta}-&gt;{dims_x} ;</td></tr>
<tr><td class="h"><a name="207"></a>207</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="208"></a>208</td><td></td><td></td><td></td><td></td><td class="s"># if roidef specified, only store points within ROI</td></tr>
<tr><td class="h"><a name="209"></a>209</td><td class="c0">375688</td><td class="c0"><span title="Avg 2µs">814ms</span></td><td></td><td></td><td class="s">      if (defined $in-&gt;{roidef} &amp;&amp;</td></tr>
<tr><td class="h"><a name="210"></a>210</td><td class="c0">363853</td><td class="c0"><span title="Avg 411ns">150ms</span></td><td></td><td></td><td class="s">          !exists $in-&gt;{roidef}-&gt;{point2roi}-&gt;{$x.','.$y.','.$z}) {next;}</td></tr>
<tr><td class="h"><a name="211"></a>211</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="212"></a>212</td><td></td><td></td><td></td><td></td><td class="s">#HERENOW 111220_1524 - double check `energy' equation</td></tr>
<tr><td class="h"><a name="213"></a>213</td><td></td><td></td><td></td><td></td><td class="s">         $raw_data-&gt;{energy}-&gt;[$j] = sprintf(&quot;%.3f&quot;,</td></tr>
<tr><td class="h"><a name="214"></a>214</td><td class="c0">11835</td><td class="c0"><span title="Avg 3µs">39.5ms</span></td><td></td><td></td><td class="s">            $raw_data-&gt;{intensity}-&gt;[$j] * $raw_data-&gt;{density}-&gt;[$j]) ;</td></tr>
<tr><td class="h"><a name="215"></a>215</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="216"></a>216</td><td class="c0">11835</td><td class="c0"><span title="Avg 4µs">48.4ms</span></td><td></td><td></td><td class="s">      if ($energy_only) {</td></tr>
<tr><td class="h"><a name="217"></a>217</td><td></td><td></td><td></td><td></td><td class="s">         $data-&gt;{energy}-&gt;{&quot;$x,$y,$z&quot;} = $raw_data-&gt;{energy}-&gt;[$j] ;</td></tr>
<tr><td class="h"><a name="218"></a>218</td><td></td><td></td><td></td><td></td><td class="s">      } else {</td></tr>
<tr><td class="h"><a name="219"></a>219</td><td></td><td></td><td></td><td></td><td class="s">         push @{$data-&gt;{xyz}}, {</td></tr>
<tr><td class="h"><a name="220"></a>220</td><td></td><td></td><td></td><td></td><td class="s">            x              =&gt; $x,</td></tr>
<tr><td class="h"><a name="221"></a>221</td><td></td><td></td><td></td><td></td><td class="s">            y              =&gt; $y,</td></tr>
<tr><td class="h"><a name="222"></a>222</td><td></td><td></td><td></td><td></td><td class="s">            z              =&gt; $z,</td></tr>
<tr><td class="h"><a name="223"></a>223</td><td></td><td></td><td></td><td></td><td class="s">            intensity      =&gt; $raw_data-&gt;{intensity}-&gt;[$j],</td></tr>
<tr><td class="h"><a name="224"></a>224</td><td></td><td></td><td></td><td></td><td class="s">            density        =&gt; $raw_data-&gt;{density}-&gt;[$j],</td></tr>
<tr><td class="h"><a name="225"></a>225</td><td></td><td></td><td></td><td></td><td class="s">            energy         =&gt; $raw_data-&gt;{energy}-&gt;[$j],</td></tr>
<tr><td class="h"><a name="226"></a>226</td><td></td><td></td><td></td><td></td><td class="s">         } ;</td></tr>
<tr><td class="h"><a name="227"></a>227</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="228"></a>228</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="229"></a>229</td><td class="c3">11</td><td class="c0"><span title="Avg 16.3ms">179ms</span></td><td></td><td></td><td class="s">   $raw_data = {} ;</td></tr>
<tr><td class="h"><a name="230"></a>230</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="231"></a>231</td><td class="c3">11</td><td class="c1"><span title="Avg 9µs">104µs</span></td><td></td><td></td><td class="s">   if (exists $in-&gt;{out_xyz}) {</td></tr>
<tr><td class="h"><a name="232"></a>232</td><td></td><td></td><td></td><td></td><td class="s">      my $fh_xyz ;</td></tr>
<tr><td class="h"><a name="233"></a>233</td><td></td><td></td><td></td><td></td><td class="s">      open($fh_xyz, &quot;&gt; $in-&gt;{out_xyz}&quot; );</td></tr>
<tr><td class="h"><a name="234"></a>234</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="235"></a>235</td><td></td><td></td><td></td><td></td><td class="s">      foreach my $metainfo (@{$data-&gt;{meta}-&gt;{gene}}) {</td></tr>
<tr><td class="h"><a name="236"></a>236</td><td></td><td></td><td></td><td></td><td class="s">         print {$fh_xyz} &quot;#meta\t$metainfo\n&quot; ;</td></tr>
<tr><td class="h"><a name="237"></a>237</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="238"></a>238</td><td></td><td></td><td></td><td></td><td class="s">      print {$fh_xyz} &quot;#imageseries_id\t&quot;.$data-&gt;{meta}-&gt;{imageseries_id}.&quot;\n&quot; ;</td></tr>
<tr><td class="h"><a name="239"></a>239</td><td></td><td></td><td></td><td></td><td class="s">      print {$fh_xyz} &quot;#gene\t&quot;.$data-&gt;{meta}-&gt;{gene_name}.&quot;\n&quot; ;</td></tr>
<tr><td class="h"><a name="240"></a>240</td><td></td><td></td><td></td><td></td><td class="s">      print {$fh_xyz} &quot;#stage\t&quot;.$data-&gt;{meta}-&gt;{stage}.&quot;\n&quot; ;</td></tr>
<tr><td class="h"><a name="241"></a>241</td><td></td><td></td><td></td><td></td><td class="s">      print {$fh_xyz} &quot;#slice\t&quot;.$data-&gt;{meta}-&gt;{plane}.&quot;\n&quot; ;</td></tr>
<tr><td class="h"><a name="242"></a>242</td><td></td><td></td><td></td><td></td><td class="s">      my @fields = qw/x y z intensity density energy/;</td></tr>
<tr><td class="h"><a name="243"></a>243</td><td></td><td></td><td></td><td></td><td class="s">      print {$fh_xyz} '#'.join(&quot;\t&quot;, @fields).&quot;\n&quot; ;</td></tr>
<tr><td class="h"><a name="244"></a>244</td><td></td><td></td><td></td><td></td><td class="s">      my $xy_plane_size = $data-&gt;{meta}-&gt;{dims_x} *</td></tr>
<tr><td class="h"><a name="245"></a>245</td><td></td><td></td><td></td><td></td><td class="s">                          $data-&gt;{meta}-&gt;{dims_y} ;</td></tr>
<tr><td class="h"><a name="246"></a>246</td><td></td><td></td><td></td><td></td><td class="s">      foreach my $point (@{$data-&gt;{xyz}}) {</td></tr>
<tr><td class="h"><a name="247"></a>247</td><td></td><td></td><td></td><td></td><td class="s">         my @outvals = ($point-&gt;{x},</td></tr>
<tr><td class="h"><a name="248"></a>248</td><td></td><td></td><td></td><td></td><td class="s">                        $point-&gt;{y},</td></tr>
<tr><td class="h"><a name="249"></a>249</td><td></td><td></td><td></td><td></td><td class="s">                        $point-&gt;{z},</td></tr>
<tr><td class="h"><a name="250"></a>250</td><td></td><td></td><td></td><td></td><td class="s">                        $point-&gt;{intensity},</td></tr>
<tr><td class="h"><a name="251"></a>251</td><td></td><td></td><td></td><td></td><td class="s">                        sprintf(&quot;%.5f&quot;, $point-&gt;{density}),</td></tr>
<tr><td class="h"><a name="252"></a>252</td><td></td><td></td><td></td><td></td><td class="s">                        $point-&gt;{energy}) ;</td></tr>
<tr><td class="h"><a name="253"></a>253</td><td></td><td></td><td></td><td></td><td class="s">         print {$fh_xyz} join(&quot;\t&quot;, @outvals).&quot;\n&quot;;</td></tr>
<tr><td class="h"><a name="254"></a>254</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="255"></a>255</td><td></td><td></td><td></td><td></td><td class="s">      close($fh_xyz) ;</td></tr>
<tr><td class="h"><a name="256"></a>256</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="257"></a>257</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="258"></a>258</td><td class="c3">11</td><td class="c3"><span title="Avg 1µs">12µs</span></td><td></td><td></td><td class="s">   if (exists $in-&gt;{out_pdb}) {</td></tr>
<tr><td class="h"><a name="259"></a>259</td><td></td><td></td><td></td><td></td><td class="s">      my $out_pdb_fn = $in-&gt;{out_pdb} ;</td></tr>
<tr><td class="h"><a name="260"></a>260</td><td></td><td></td><td></td><td></td><td class="s">      my $compress_fl = 0 ;</td></tr>
<tr><td class="h"><a name="261"></a>261</td><td></td><td></td><td></td><td></td><td class="s">      if ($out_pdb_fn =~ /\.gz$/) {</td></tr>
<tr><td class="h"><a name="262"></a>262</td><td></td><td></td><td></td><td></td><td class="s">         $compress_fl = 1 ; $out_pdb_fn =~ s/\.gz// ;}</td></tr>
<tr><td class="h"><a name="263"></a>263</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="264"></a>264</td><td></td><td></td><td></td><td></td><td class="s">      aba_displayxpr_pdbformat({</td></tr>
<tr><td class="h"><a name="265"></a>265</td><td></td><td></td><td></td><td></td><td class="s">         out_pdb =&gt; $out_pdb_fn,</td></tr>
<tr><td class="h"><a name="266"></a>266</td><td></td><td></td><td></td><td></td><td class="s">         data =&gt; $data,</td></tr>
<tr><td class="h"><a name="267"></a>267</td><td></td><td></td><td></td><td></td><td class="s">      }) ;</td></tr>
<tr><td class="h"><a name="268"></a>268</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="269"></a>269</td><td></td><td></td><td></td><td></td><td class="s">      if ($compress_fl) {</td></tr>
<tr><td class="h"><a name="270"></a>270</td><td></td><td></td><td></td><td></td><td class="s">         system(&quot;gzip $out_pdb_fn&quot;) ; }</td></tr>
<tr><td class="h"><a name="271"></a>271</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="272"></a>272</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="273"></a>273</td><td></td><td></td><td></td><td></td><td class="s"># Clean up temporary unzip directory</td></tr>
<tr><td class="h"><a name="274"></a>274</td><td class="c3">11</td><td class="c1"><span title="Avg 8µs">88µs</span></td><td></td><td></td><td class="s">   foreach my $file (@expected_files) {</td></tr>
<tr><td class="h"><a name="275"></a>275</td><td class="c0">55</td><td class="c0"><span title="Avg 1.14ms">63.0ms</span></td><td class="c0">55</td><td class="c0">62.0ms</td><td class="s">      unlink $unzip_dir.'/'.$file ; }<div class="calls"><div class="calls_out">      # spent  62.0ms making 55 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_unlink">alnmnr::io::CORE:unlink</a>, avg 1.13ms/call</div></div></td></tr>
<tr><td class="h"><a name="276"></a>276</td><td class="c3">11</td><td class="c0"><span title="Avg 1.19ms">13.1ms</span></td><td class="c3">11</td><td class="c0">12.8ms</td><td class="s">   unlink $unzip_dir.'/'.$data-&gt;{meta}-&gt;{xpz_name} ;<div class="calls"><div class="calls_out">   # spent  12.8ms making 11 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_unlink">alnmnr::io::CORE:unlink</a>, avg 1.16ms/call</div></div></td></tr>
<tr><td class="h"><a name="277"></a>277</td><td class="c3">11</td><td class="c0"><span title="Avg 203µs">2.23ms</span></td><td class="c3">11</td><td class="c0">2.17ms</td><td class="s">   chdir $pwd ;<div class="calls"><div class="calls_out">   # spent  2.17ms making 11 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_chdir">alnmnr::io::CORE:chdir</a>, avg 197µs/call</div></div></td></tr>
<tr><td class="h"><a name="278"></a>278</td><td class="c3">11</td><td class="c0"><span title="Avg 971µs">10.7ms</span></td><td class="c3">11</td><td class="c0">10.6ms</td><td class="s">   rmdir $unzip_dir ;<div class="calls"><div class="calls_out">   # spent  10.6ms making 11 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_rmdir">alnmnr::io::CORE:rmdir</a>, avg 959µs/call</div></div></td></tr>
<tr><td class="h"><a name="279"></a>279</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="280"></a>280</td><td class="c3">11</td><td class="c0"><span title="Avg 41µs">453µs</span></td><td></td><td></td><td class="s">   return $data ;</td></tr>
<tr><td class="h"><a name="281"></a>281</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="282"></a>282</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="283"></a>283</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="284"></a>284</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="285"></a>285</td><td></td><td></td><td></td><td></td><td class="s">=head2 aba_parse_xpr()</td></tr>
<tr><td class="h"><a name="286"></a>286</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="287"></a>287</td><td></td><td></td><td></td><td></td><td class="s">   Title:       aba_parse_xpr()</td></tr>
<tr><td class="h"><a name="288"></a>288</td><td></td><td></td><td></td><td></td><td class="s">   Function:    Parses binary ABA XPR files and converts it to a tab-delimited</td></tr>
<tr><td class="h"><a name="289"></a>289</td><td></td><td></td><td></td><td></td><td class="s">                  text format or a PDB file</td></tr>
<tr><td class="h"><a name="290"></a>290</td><td></td><td></td><td></td><td></td><td class="s">   Args:        $_-&gt;{xpr} - XPR file path</td></tr>
<tr><td class="h"><a name="291"></a>291</td><td></td><td></td><td></td><td></td><td class="s">                $_-&gt;{out_xyz} - file name for XYZ output [optional]</td></tr>
<tr><td class="h"><a name="292"></a>292</td><td></td><td></td><td></td><td></td><td class="s">                $_-&gt;{out_pdb} - file name for PDB format output [optional]</td></tr>
<tr><td class="h"><a name="293"></a>293</td><td></td><td></td><td></td><td></td><td class="s">                $_-&gt;{out_data} - flag to return hash holding data</td></tr>
<tr><td class="h"><a name="294"></a>294</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="295"></a>295</td><td></td><td></td><td></td><td></td><td class="s">   Returns:     $-&gt;{} (if $_-&gt;{out_data} is specified}</td></tr>
<tr><td class="h"><a name="296"></a>296</td><td></td><td></td><td></td><td></td><td class="s">   File out:    XYZ output (in $_-&gt;{out_xyz}, if specified}</td></tr>
<tr><td class="h"><a name="297"></a>297</td><td></td><td></td><td></td><td></td><td class="s">                ^# comment lines holding meta data, header_id, riboprobe info</td></tr>
<tr><td class="h"><a name="298"></a>298</td><td></td><td></td><td></td><td></td><td class="s">                  1. grid_id</td></tr>
<tr><td class="h"><a name="299"></a>299</td><td></td><td></td><td></td><td></td><td class="s">                  2. x</td></tr>
<tr><td class="h"><a name="300"></a>300</td><td></td><td></td><td></td><td></td><td class="s">                  3. y</td></tr>
<tr><td class="h"><a name="301"></a>301</td><td></td><td></td><td></td><td></td><td class="s">                  4. z</td></tr>
<tr><td class="h"><a name="302"></a>302</td><td></td><td></td><td></td><td></td><td class="s">                  5. cell_diameter</td></tr>
<tr><td class="h"><a name="303"></a>303</td><td></td><td></td><td></td><td></td><td class="s">                  6. grid_area</td></tr>
<tr><td class="h"><a name="304"></a>304</td><td></td><td></td><td></td><td></td><td class="s">                  7. expression_level</td></tr>
<tr><td class="h"><a name="305"></a>305</td><td></td><td></td><td></td><td></td><td class="s">                  8. section</td></tr>
<tr><td class="h"><a name="306"></a>306</td><td></td><td></td><td></td><td></td><td class="s">                  9. location_1</td></tr>
<tr><td class="h"><a name="307"></a>307</td><td></td><td></td><td></td><td></td><td class="s">                 10. location_2</td></tr>
<tr><td class="h"><a name="308"></a>308</td><td></td><td></td><td></td><td></td><td class="s">                 11. num_expressors</td></tr>
<tr><td class="h"><a name="309"></a>309</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="310"></a>310</td><td></td><td></td><td></td><td></td><td class="s">                PDB output (in $_-&gt;{out_pdb}, if specified}</td></tr>
<tr><td class="h"><a name="311"></a>311</td><td></td><td></td><td></td><td></td><td class="s">                  PDB ATOM RECORD format - per aba_displayxpr_pdbformat()</td></tr>
<tr><td class="h"><a name="312"></a>312</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="313"></a>313</td><td></td><td></td><td></td><td></td><td class="s">=cut</td></tr>
<tr><td class="h"><a name="314"></a>314</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="315"></a>315</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="316"></a>316</td><td></td><td></td><td></td><td></td><td class="s"># NOTE: what is missing:</td></tr>
<tr><td class="h"><a name="317"></a>317</td><td></td><td></td><td></td><td></td><td class="s"># * header info (first 128 bytes after uncompression)</td></tr>
<tr><td class="h"><a name="318"></a>318</td><td></td><td></td><td></td><td></td><td class="s">#   - only extracts (i) identifier number, and (ii) number of aff entries</td></tr>
<tr><td class="h"><a name="319"></a>319</td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h"><a name="320"></a>320</td><td></td><td></td><td></td><td></td><td class="s"># * also dont know what is in the 32 bytes betwen aff entries</td></tr>
<tr><td class="h"><a name="321"></a>321</td><td></td><td></td><td></td><td></td><td class="s">#  (AFF entries = primary and express zoomify image locations - probably used</td></tr>
<tr><td class="h"><a name="322"></a>322</td><td></td><td></td><td></td><td></td><td class="s">#     by their software to link to in situ images)</td></tr>
<tr><td class="h"><a name="323"></a>323</td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h"><a name="324"></a>324</td><td></td><td></td><td></td><td></td><td class="s"># inspiration from: </td></tr>
<tr><td class="h"><a name="325"></a>325</td><td></td><td></td><td></td><td></td><td class="s"># http://www.openrce.org/articles/full_view/16</td></tr>
<tr><td class="h"><a name="326"></a>326</td><td></td><td></td><td></td><td></td><td class="s"># got python zlib uncompression script (and strategy) from web</td></tr>
<tr><td class="h"><a name="327"></a>327</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="328"></a>328</td><td></td><td></td><td></td><td></td><td class="s">sub aba_parse_xpr {</td></tr>
<tr><td class="h"><a name="329"></a>329</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="330"></a>330</td><td></td><td></td><td></td><td></td><td class="s">   require File::Basename ;</td></tr>
<tr><td class="h"><a name="331"></a>331</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="332"></a>332</td><td></td><td></td><td></td><td></td><td class="s">#cut off first 16 bytes, uncompress rest with zlib</td></tr>
<tr><td class="h"><a name="333"></a>333</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="334"></a>334</td><td></td><td></td><td></td><td></td><td class="s">   my $in = shift ;</td></tr>
<tr><td class="h"><a name="335"></a>335</td><td></td><td></td><td></td><td></td><td class="s">   my ($fn, $fh) ;</td></tr>
<tr><td class="h"><a name="336"></a>336</td><td></td><td></td><td></td><td></td><td class="s">   if (!exists $in-&gt;{fn}) {</td></tr>
<tr><td class="h"><a name="337"></a>337</td><td></td><td></td><td></td><td></td><td class="s">      die &quot;XPR file not specified&quot; ; }</td></tr>
<tr><td class="h"><a name="338"></a>338</td><td></td><td></td><td></td><td></td><td class="s">   if (!-s $in-&gt;{fn}) {</td></tr>
<tr><td class="h"><a name="339"></a>339</td><td></td><td></td><td></td><td></td><td class="s">      die &quot;XPR file $in-&gt;{fn} not found &quot; ; }</td></tr>
<tr><td class="h"><a name="340"></a>340</td><td></td><td></td><td></td><td></td><td class="s">   $fn-&gt;{xpr} = $in-&gt;{fn} ;</td></tr>
<tr><td class="h"><a name="341"></a>341</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="342"></a>342</td><td></td><td></td><td></td><td></td><td class="s">   ($fh-&gt;{xpr_frag}, $fn-&gt;{xpr_frag}) =</td></tr>
<tr><td class="h"><a name="343"></a>343</td><td></td><td></td><td></td><td></td><td class="s">      tempfile(&quot;xpr_fragment.XXXXX&quot;, SUFFIX =&gt; &quot;.frag&quot;) ;</td></tr>
<tr><td class="h"><a name="344"></a>344</td><td></td><td></td><td></td><td></td><td class="s">   close($fh-&gt;{xpr_frag}) ;</td></tr>
<tr><td class="h"><a name="345"></a>345</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="346"></a>346</td><td></td><td></td><td></td><td></td><td class="s">   _aba_parse_xpr_uncompress_xpr({</td></tr>
<tr><td class="h"><a name="347"></a>347</td><td></td><td></td><td></td><td></td><td class="s">      fn_in =&gt; $fn-&gt;{xpr},</td></tr>
<tr><td class="h"><a name="348"></a>348</td><td></td><td></td><td></td><td></td><td class="s">      fn_out =&gt; $fn-&gt;{xpr_frag}</td></tr>
<tr><td class="h"><a name="349"></a>349</td><td></td><td></td><td></td><td></td><td class="s">   }) ;</td></tr>
<tr><td class="h"><a name="350"></a>350</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="351"></a>351</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="352"></a>352</td><td></td><td></td><td></td><td></td><td class="s">   my $data ;</td></tr>
<tr><td class="h"><a name="353"></a>353</td><td></td><td></td><td></td><td></td><td class="s">   $data-&gt;{meta} = {} ;</td></tr>
<tr><td class="h"><a name="354"></a>354</td><td></td><td></td><td></td><td></td><td class="s">   if ($fn-&gt;{xpr} =~ /sagittal/) {</td></tr>
<tr><td class="h"><a name="355"></a>355</td><td></td><td></td><td></td><td></td><td class="s">      $data-&gt;{meta}-&gt;{plane} = 'sagittal' ;</td></tr>
<tr><td class="h"><a name="356"></a>356</td><td></td><td></td><td></td><td></td><td class="s">   } else {</td></tr>
<tr><td class="h"><a name="357"></a>357</td><td></td><td></td><td></td><td></td><td class="s">      $data-&gt;{meta}-&gt;{plane} = 'coronal' ;</td></tr>
<tr><td class="h"><a name="358"></a>358</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="359"></a>359</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="360"></a>360</td><td></td><td></td><td></td><td></td><td class="s">   {</td></tr>
<tr><td class="h"><a name="361"></a>361</td><td></td><td></td><td></td><td></td><td class="s">      my $a  = File::Basename::basename($fn-&gt;{xpr}) ;</td></tr>
<tr><td class="h"><a name="362"></a>362</td><td></td><td></td><td></td><td></td><td class="s">      $data-&gt;{meta}-&gt;{xpr_name} = $a ;</td></tr>
<tr><td class="h"><a name="363"></a>363</td><td></td><td></td><td></td><td></td><td class="s">      $a =~ s/_coronal.*// ;</td></tr>
<tr><td class="h"><a name="364"></a>364</td><td></td><td></td><td></td><td></td><td class="s">      $a =~ s/_sagittal.*// ;</td></tr>
<tr><td class="h"><a name="365"></a>365</td><td></td><td></td><td></td><td></td><td class="s">      $data-&gt;{meta}-&gt;{gene_name} = $a ;</td></tr>
<tr><td class="h"><a name="366"></a>366</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="367"></a>367</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="- -"></a>- -</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="370"></a>370</td><td></td><td></td><td></td><td></td><td class="s">#read file header</td></tr>
<tr><td class="h"><a name="371"></a>371</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="372"></a>372</td><td></td><td></td><td></td><td></td><td class="s">   my $buffer ;</td></tr>
<tr><td class="h"><a name="373"></a>373</td><td></td><td></td><td></td><td></td><td class="s">   open( XPRDATA, $fn-&gt;{xpr_frag}) ;</td></tr>
<tr><td class="h"><a name="374"></a>374</td><td></td><td></td><td></td><td></td><td class="s">   read( XPRDATA,$data-&gt;{header},64);</td></tr>
<tr><td class="h"><a name="375"></a>375</td><td></td><td></td><td></td><td></td><td class="s">   $data-&gt;{meta}-&gt;{header_id} = unpack(&quot;I&quot;,substr($data-&gt;{header},0,4));</td></tr>
<tr><td class="h"><a name="376"></a>376</td><td></td><td></td><td></td><td></td><td class="s">   $data-&gt;{hexstring_identifier} = unpack(&quot;H4&quot;,substr($data-&gt;{header},0,4));</td></tr>
<tr><td class="h"><a name="377"></a>377</td><td></td><td></td><td></td><td></td><td class="s">#   print STDERR &quot;id $data-&gt;{identifier} from hexstring $data-&gt;{hexstring_identifier}\n&quot; ;</td></tr>
<tr><td class="h"><a name="378"></a>378</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="379"></a>379</td><td></td><td></td><td></td><td></td><td class="s">   $data-&gt;{hexstring_num_aff_records} = unpack(&quot;H4&quot;,substr($data-&gt;{header},56,4));</td></tr>
<tr><td class="h"><a name="380"></a>380</td><td></td><td></td><td></td><td></td><td class="s">   $data-&gt;{num_aff_records} = unpack(&quot;I&quot;,substr($data-&gt;{header},56,4));</td></tr>
<tr><td class="h"><a name="381"></a>381</td><td></td><td></td><td></td><td></td><td class="s">#   print STDERR &quot;number of aff records: $data-&gt;{num_aff_records} from $data-&gt;{hexstring_num_aff_records}\n&quot; ;</td></tr>
<tr><td class="h"><a name="382"></a>382</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="383"></a>383</td><td></td><td></td><td></td><td></td><td class="s">#read gene meta data</td></tr>
<tr><td class="h"><a name="384"></a>384</td><td></td><td></td><td></td><td></td><td class="s">   while (!exists $data-&gt;{meta}-&gt;{rp}) {</td></tr>
<tr><td class="h"><a name="385"></a>385</td><td></td><td></td><td></td><td></td><td class="s">      read(XPRDATA,$buffer, 1) ;</td></tr>
<tr><td class="h"><a name="386"></a>386</td><td></td><td></td><td></td><td></td><td class="s">      my $cur_reclength = unpack(&quot;c&quot;,$buffer);</td></tr>
<tr><td class="h"><a name="387"></a>387</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="388"></a>388</td><td></td><td></td><td></td><td></td><td class="s">      if ($cur_reclength &lt;= 0) {</td></tr>
<tr><td class="h"><a name="389"></a>389</td><td></td><td></td><td></td><td></td><td class="s">         close(XPRDATA) ;</td></tr>
<tr><td class="h"><a name="390"></a>390</td><td></td><td></td><td></td><td></td><td class="s">         my $error = &quot;ERROR: xpr parsing error (&quot;.__LINE__.</td></tr>
<tr><td class="h"><a name="391"></a>391</td><td></td><td></td><td></td><td></td><td class="s">                      &quot;): negative record length&quot; ;</td></tr>
<tr><td class="h"><a name="392"></a>392</td><td></td><td></td><td></td><td></td><td class="s">         print STDERR $error.&quot;\n&quot; ;</td></tr>
<tr><td class="h"><a name="393"></a>393</td><td></td><td></td><td></td><td></td><td class="s">         return {error_fl =&gt; $error};</td></tr>
<tr><td class="h"><a name="394"></a>394</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="395"></a>395</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="396"></a>396</td><td></td><td></td><td></td><td></td><td class="s">#      my $hex_cur_reclength = unpack(&quot;H2&quot;,$buffer);</td></tr>
<tr><td class="h"><a name="397"></a>397</td><td></td><td></td><td></td><td></td><td class="s">#      print STDERR &quot;length of $cur_reclength (from $hex_cur_reclength)\n&quot; ;</td></tr>
<tr><td class="h"><a name="398"></a>398</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="399"></a>399</td><td></td><td></td><td></td><td></td><td class="s">      read(XPRDATA,$buffer,$cur_reclength) ;</td></tr>
<tr><td class="h"><a name="400"></a>400</td><td></td><td></td><td></td><td></td><td class="s">      my $hex_cur_rec = unpack(&quot;H&quot;.$cur_reclength, $buffer) ;</td></tr>
<tr><td class="h"><a name="401"></a>401</td><td></td><td></td><td></td><td></td><td class="s">      my $cur_rec = unpack(&quot;A&quot;.$cur_reclength, $buffer) ;</td></tr>
<tr><td class="h"><a name="402"></a>402</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="403"></a>403</td><td></td><td></td><td></td><td></td><td class="s">#      print STDERR &quot;$hex_cur_rec giving $cur_rec\n&quot;;</td></tr>
<tr><td class="h"><a name="404"></a>404</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="405"></a>405</td><td></td><td></td><td></td><td></td><td class="s">      if ($cur_rec =~ /^RP/) {</td></tr>
<tr><td class="h"><a name="406"></a>406</td><td></td><td></td><td></td><td></td><td class="s">         $data-&gt;{meta}-&gt;{rp} = $cur_rec ;</td></tr>
<tr><td class="h"><a name="407"></a>407</td><td></td><td></td><td></td><td></td><td class="s">      } else {</td></tr>
<tr><td class="h"><a name="408"></a>408</td><td></td><td></td><td></td><td></td><td class="s">         push @{$data-&gt;{meta}-&gt;{gene}}, $cur_rec ;</td></tr>
<tr><td class="h"><a name="409"></a>409</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="410"></a>410</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="411"></a>411</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="412"></a>412</td><td></td><td></td><td></td><td></td><td class="s">   my $j = 0 ;</td></tr>
<tr><td class="h"><a name="413"></a>413</td><td></td><td></td><td></td><td></td><td class="s">   while ($j &lt; $data-&gt;{num_aff_records}) {</td></tr>
<tr><td class="h"><a name="414"></a>414</td><td></td><td></td><td></td><td></td><td class="s">      read(XPRDATA,$buffer, 16) ;</td></tr>
<tr><td class="h"><a name="415"></a>415</td><td></td><td></td><td></td><td></td><td class="s">      my $hex_pre_aff = unpack(&quot;H16&quot;, $buffer) ;</td></tr>
<tr><td class="h"><a name="416"></a>416</td><td></td><td></td><td></td><td></td><td class="s">      push @{$data-&gt;{aff_header}}, $hex_pre_aff ;</td></tr>
<tr><td class="h"><a name="417"></a>417</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="418"></a>418</td><td></td><td></td><td></td><td></td><td class="s">      my $aff_id = unpack(&quot;c&quot;, substr($buffer,0,2)) ;</td></tr>
<tr><td class="h"><a name="419"></a>419</td><td></td><td></td><td></td><td></td><td class="s">      push @{$data-&gt;{aff_id}}, $aff_id ;</td></tr>
<tr><td class="h"><a name="420"></a>420</td><td></td><td></td><td></td><td></td><td class="s">#      print STDERR &quot;hex is $hex_pre_aff, affid = $aff_id\n&quot; ;</td></tr>
<tr><td class="h"><a name="421"></a>421</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="422"></a>422</td><td></td><td></td><td></td><td></td><td class="s">      read(XPRDATA,$buffer, 1) ;</td></tr>
<tr><td class="h"><a name="423"></a>423</td><td></td><td></td><td></td><td></td><td class="s">      my $hex_primary_aff_length = unpack(&quot;c&quot;, $buffer) ;</td></tr>
<tr><td class="h"><a name="424"></a>424</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="425"></a>425</td><td></td><td></td><td></td><td></td><td class="s"># fpd101205_2132 - catches corrupted files like Cks2_coronal.</td></tr>
<tr><td class="h"><a name="426"></a>426</td><td></td><td></td><td></td><td></td><td class="s">      if ($hex_primary_aff_length &lt;= 0) {</td></tr>
<tr><td class="h"><a name="427"></a>427</td><td></td><td></td><td></td><td></td><td class="s">         close(XPRDATA) ;</td></tr>
<tr><td class="h"><a name="428"></a>428</td><td></td><td></td><td></td><td></td><td class="s">         my $error = &quot;ERROR: xpr parsing error (&quot;.__LINE__.</td></tr>
<tr><td class="h"><a name="429"></a>429</td><td></td><td></td><td></td><td></td><td class="s">                      &quot;): negative record length&quot; ;</td></tr>
<tr><td class="h"><a name="430"></a>430</td><td></td><td></td><td></td><td></td><td class="s">         print STDERR $error.&quot;\n&quot; ;</td></tr>
<tr><td class="h"><a name="431"></a>431</td><td></td><td></td><td></td><td></td><td class="s">         return {error_fl =&gt; $error};</td></tr>
<tr><td class="h"><a name="432"></a>432</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="433"></a>433</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="434"></a>434</td><td></td><td></td><td></td><td></td><td class="s">      read(XPRDATA,$buffer,$hex_primary_aff_length) ;</td></tr>
<tr><td class="h"><a name="435"></a>435</td><td></td><td></td><td></td><td></td><td class="s">      my $hex_primary_aff = unpack(&quot;H&quot;.$hex_primary_aff_length,$buffer) ;</td></tr>
<tr><td class="h"><a name="436"></a>436</td><td></td><td></td><td></td><td></td><td class="s">      my $primary_aff = unpack(&quot;A&quot;.$hex_primary_aff_length,$buffer) ;</td></tr>
<tr><td class="h"><a name="437"></a>437</td><td></td><td></td><td></td><td></td><td class="s">      push @{$data-&gt;{primary_aff}}, $primary_aff ;</td></tr>
<tr><td class="h"><a name="438"></a>438</td><td></td><td></td><td></td><td></td><td class="s">#      print STDERR &quot;$hex_primary_aff to\n$primary_aff\n&quot; ;</td></tr>
<tr><td class="h"><a name="439"></a>439</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="440"></a>440</td><td></td><td></td><td></td><td></td><td class="s">      read(XPRDATA,$buffer, 1) ;</td></tr>
<tr><td class="h"><a name="441"></a>441</td><td></td><td></td><td></td><td></td><td class="s">      my $hex_express_aff_length = unpack(&quot;c&quot;, $buffer) ;</td></tr>
<tr><td class="h"><a name="442"></a>442</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="443"></a>443</td><td></td><td></td><td></td><td></td><td class="s">      if ($hex_express_aff_length &lt;= 0) {</td></tr>
<tr><td class="h"><a name="444"></a>444</td><td></td><td></td><td></td><td></td><td class="s">         close(XPRDATA) ;</td></tr>
<tr><td class="h"><a name="445"></a>445</td><td></td><td></td><td></td><td></td><td class="s">         my $error = &quot;ERROR: xpr parsing error (&quot;.__LINE__.</td></tr>
<tr><td class="h"><a name="446"></a>446</td><td></td><td></td><td></td><td></td><td class="s">                      &quot;): negative record length&quot; ;</td></tr>
<tr><td class="h"><a name="447"></a>447</td><td></td><td></td><td></td><td></td><td class="s">         print STDERR $error.&quot;\n&quot; ;</td></tr>
<tr><td class="h"><a name="448"></a>448</td><td></td><td></td><td></td><td></td><td class="s">         return {error_fl =&gt; $error};</td></tr>
<tr><td class="h"><a name="449"></a>449</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="450"></a>450</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="451"></a>451</td><td></td><td></td><td></td><td></td><td class="s">      read(XPRDATA,$buffer,$hex_express_aff_length) ;</td></tr>
<tr><td class="h"><a name="452"></a>452</td><td></td><td></td><td></td><td></td><td class="s">      my $hex_express_aff = unpack(&quot;H&quot;.$hex_express_aff_length,$buffer) ;</td></tr>
<tr><td class="h"><a name="453"></a>453</td><td></td><td></td><td></td><td></td><td class="s">      my $express_aff = unpack(&quot;A&quot;.$hex_express_aff_length,$buffer) ;</td></tr>
<tr><td class="h"><a name="454"></a>454</td><td></td><td></td><td></td><td></td><td class="s">      push @{$data-&gt;{express_aff}}, $express_aff ;</td></tr>
<tr><td class="h"><a name="455"></a>455</td><td></td><td></td><td></td><td></td><td class="s">#      print STDERR &quot;$hex_express_aff to\n$express_aff\n&quot; ;</td></tr>
<tr><td class="h"><a name="456"></a>456</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="457"></a>457</td><td></td><td></td><td></td><td></td><td class="s">      $j++ ;</td></tr>
<tr><td class="h"><a name="458"></a>458</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="459"></a>459</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="460"></a>460</td><td></td><td></td><td></td><td></td><td class="s">   $data-&gt;{read_something} = 0 ;</td></tr>
<tr><td class="h"><a name="461"></a>461</td><td></td><td></td><td></td><td></td><td class="s">   while (read(XPRDATA,$buffer,24)) {</td></tr>
<tr><td class="h"><a name="462"></a>462</td><td></td><td></td><td></td><td></td><td class="s">      my ($hexes, $vals) ;</td></tr>
<tr><td class="h"><a name="463"></a>463</td><td></td><td></td><td></td><td></td><td class="s">      $hexes-&gt;{grid_id} = unpack(&quot;H8&quot;, substr($buffer,0,4)) ;</td></tr>
<tr><td class="h"><a name="464"></a>464</td><td></td><td></td><td></td><td></td><td class="s">      $vals-&gt;{grid_id} = unpack(&quot;I8&quot;, substr($buffer,0,4)) ;</td></tr>
<tr><td class="h"><a name="465"></a>465</td><td></td><td></td><td></td><td></td><td class="s">#      print STDERR &quot;grid is $hexes-&gt;{grid_id} to $vals-&gt;{grid_id}\n&quot; ;</td></tr>
<tr><td class="h"><a name="466"></a>466</td><td></td><td></td><td></td><td></td><td class="s">      my $z = floor(($vals-&gt;{grid_id} -1 )/ 10773) ;</td></tr>
<tr><td class="h"><a name="467"></a>467</td><td></td><td></td><td></td><td></td><td class="s">      my $y = floor(($vals-&gt;{grid_id} - 1 - ($z * 10773)) / 133) ;</td></tr>
<tr><td class="h"><a name="468"></a>468</td><td></td><td></td><td></td><td></td><td class="s">      my $x = $vals-&gt;{grid_id} - 1 - $z * 10773 - $y * 133 ;</td></tr>
<tr><td class="h"><a name="469"></a>469</td><td></td><td></td><td></td><td></td><td class="s">      ($vals-&gt;{x}, $vals-&gt;{y}, $vals-&gt;{z}) = ($x, $y, $z) ;</td></tr>
<tr><td class="h"><a name="470"></a>470</td><td></td><td></td><td></td><td></td><td class="s">      $vals-&gt;{x} = sprintf(&quot;%d&quot;, $vals-&gt;{x}) ;</td></tr>
<tr><td class="h"><a name="471"></a>471</td><td></td><td></td><td></td><td></td><td class="s">      $vals-&gt;{y} = sprintf(&quot;%d&quot;, $vals-&gt;{y}) ;</td></tr>
<tr><td class="h"><a name="472"></a>472</td><td></td><td></td><td></td><td></td><td class="s">      $vals-&gt;{z} = sprintf(&quot;%d&quot;, $vals-&gt;{z}) ;</td></tr>
<tr><td class="h"><a name="473"></a>473</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="474"></a>474</td><td></td><td></td><td></td><td></td><td class="s">      $hexes-&gt;{cell_diameter} = unpack(&quot;H8&quot;, substr($buffer,4,4)) ;</td></tr>
<tr><td class="h"><a name="475"></a>475</td><td></td><td></td><td></td><td></td><td class="s">      $vals-&gt;{cell_diameter} = sprintf(&quot;%.3f&quot;, unpack(&quot;f&quot;, substr($buffer,4,4))) ;</td></tr>
<tr><td class="h"><a name="476"></a>476</td><td></td><td></td><td></td><td></td><td class="s">#      print STDERR &quot;cell diameter is $hexes-&gt;{cell_diameter} to $vals-&gt;{cell_diameter}\n&quot; ;</td></tr>
<tr><td class="h"><a name="477"></a>477</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="478"></a>478</td><td></td><td></td><td></td><td></td><td class="s">      $hexes-&gt;{grid_area} = unpack(&quot;H8&quot;, substr($buffer,8,4)) ;</td></tr>
<tr><td class="h"><a name="479"></a>479</td><td></td><td></td><td></td><td></td><td class="s">      $vals-&gt;{grid_area} = sprintf(&quot;%.2f&quot;, unpack(&quot;f&quot;, substr($buffer,8,4))) ;</td></tr>
<tr><td class="h"><a name="480"></a>480</td><td></td><td></td><td></td><td></td><td class="s">#      print STDERR &quot;grid_area is $hexes-&gt;{grid_area} to $vals-&gt;{grid_area}\n&quot; ;</td></tr>
<tr><td class="h"><a name="481"></a>481</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="482"></a>482</td><td></td><td></td><td></td><td></td><td class="s">      $hexes-&gt;{expression_level} = unpack(&quot;H8&quot;, substr($buffer,12,4)) ;</td></tr>
<tr><td class="h"><a name="483"></a>483</td><td></td><td></td><td></td><td></td><td class="s">      $vals-&gt;{expression_level} = sprintf(&quot;%.3f&quot;, unpack(&quot;f&quot;, substr($buffer,12,4))) ;</td></tr>
<tr><td class="h"><a name="484"></a>484</td><td></td><td></td><td></td><td></td><td class="s">#      print STDERR &quot;expression_level is $hexes-&gt;{expression_level} to $vals-&gt;{expression_level}\n&quot; ;</td></tr>
<tr><td class="h"><a name="485"></a>485</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="486"></a>486</td><td></td><td></td><td></td><td></td><td class="s">      $hexes-&gt;{section} = unpack(&quot;H4&quot;, substr($buffer,16,2)) ;</td></tr>
<tr><td class="h"><a name="487"></a>487</td><td></td><td></td><td></td><td></td><td class="s">      $vals-&gt;{section} = unpack(&quot;s&quot;, substr($buffer,16,2)) ;</td></tr>
<tr><td class="h"><a name="488"></a>488</td><td></td><td></td><td></td><td></td><td class="s">#      print STDERR &quot;section is $hexes-&gt;{section} to $vals-&gt;{section}\n&quot; ;</td></tr>
<tr><td class="h"><a name="489"></a>489</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="490"></a>490</td><td></td><td></td><td></td><td></td><td class="s">      $hexes-&gt;{location_1} = unpack(&quot;H4&quot;, substr($buffer,18,2)) ;</td></tr>
<tr><td class="h"><a name="491"></a>491</td><td></td><td></td><td></td><td></td><td class="s">      $vals-&gt;{location_1} = unpack(&quot;s&quot;, substr($buffer,18,2)) ;</td></tr>
<tr><td class="h"><a name="492"></a>492</td><td></td><td></td><td></td><td></td><td class="s">#      print STDERR &quot;location_1 is $hexes-&gt;{location_1} to $vals-&gt;{location_1}\n&quot; ;</td></tr>
<tr><td class="h"><a name="493"></a>493</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="494"></a>494</td><td></td><td></td><td></td><td></td><td class="s">      $hexes-&gt;{location_2} = unpack(&quot;H4&quot;, substr($buffer,20,2)) ;</td></tr>
<tr><td class="h"><a name="495"></a>495</td><td></td><td></td><td></td><td></td><td class="s">      $vals-&gt;{location_2} = unpack(&quot;s&quot;, substr($buffer,20,2)) ;</td></tr>
<tr><td class="h"><a name="496"></a>496</td><td></td><td></td><td></td><td></td><td class="s">#      print STDERR &quot;location_2 is $hexes-&gt;{location_2} to $vals-&gt;{location_2}\n&quot; ;</td></tr>
<tr><td class="h"><a name="497"></a>497</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="498"></a>498</td><td></td><td></td><td></td><td></td><td class="s">      $hexes-&gt;{num_expressors} = unpack(&quot;H4&quot;, substr($buffer,22,2)) ;</td></tr>
<tr><td class="h"><a name="499"></a>499</td><td></td><td></td><td></td><td></td><td class="s">      $vals-&gt;{num_expressors} = unpack(&quot;s&quot;, substr($buffer,22,2)) ;</td></tr>
<tr><td class="h"><a name="500"></a>500</td><td></td><td></td><td></td><td></td><td class="s">#      print STDERR &quot;num_expressors is $hexes-&gt;{num_expressors} to $vals-&gt;{num_expressors}\n&quot; ;</td></tr>
<tr><td class="h"><a name="501"></a>501</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="502"></a>502</td><td></td><td></td><td></td><td></td><td class="s">      push @{$data-&gt;{xyz}}, $vals ;</td></tr>
<tr><td class="h"><a name="503"></a>503</td><td></td><td></td><td></td><td></td><td class="s">      $data-&gt;{read_something} = 1 ;</td></tr>
<tr><td class="h"><a name="504"></a>504</td><td></td><td></td><td></td><td></td><td class="s">#      print STDERR &quot;\n\n\n&quot; ;</td></tr>
<tr><td class="h"><a name="505"></a>505</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="506"></a>506</td><td></td><td></td><td></td><td></td><td class="s">   close( XPRDATA) ;</td></tr>
<tr><td class="h"><a name="507"></a>507</td><td></td><td></td><td></td><td></td><td class="s">   unlink $fn-&gt;{xpr_frag} ;</td></tr>
<tr><td class="h"><a name="508"></a>508</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="509"></a>509</td><td></td><td></td><td></td><td></td><td class="s">   if (exists $in-&gt;{out_xyz}) {</td></tr>
<tr><td class="h"><a name="510"></a>510</td><td></td><td></td><td></td><td></td><td class="s">      my $fh_xyz ;</td></tr>
<tr><td class="h"><a name="511"></a>511</td><td></td><td></td><td></td><td></td><td class="s">      open($fh_xyz, &quot;&gt; $in-&gt;{out_xyz}&quot; );</td></tr>
<tr><td class="h"><a name="512"></a>512</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="513"></a>513</td><td></td><td></td><td></td><td></td><td class="s">      foreach my $metainfo (@{$data-&gt;{meta}-&gt;{gene}}) {</td></tr>
<tr><td class="h"><a name="514"></a>514</td><td></td><td></td><td></td><td></td><td class="s">         print {$fh_xyz} &quot;#meta\t$metainfo\n&quot; ;</td></tr>
<tr><td class="h"><a name="515"></a>515</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="516"></a>516</td><td></td><td></td><td></td><td></td><td class="s">      print {$fh_xyz} &quot;#header_id\t$data-&gt;{meta}-&gt;{header_id}\n&quot; ;</td></tr>
<tr><td class="h"><a name="517"></a>517</td><td></td><td></td><td></td><td></td><td class="s">      print {$fh_xyz} &quot;#riboprobe\t$data-&gt;{meta}-&gt;{rp}\n&quot; ;</td></tr>
<tr><td class="h"><a name="518"></a>518</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="519"></a>519</td><td></td><td></td><td></td><td></td><td class="s">      my @fields = qw/grid_id x y z cell_diameter grid_area expression_level section location_1 location_2 num_expressors/ ;</td></tr>
<tr><td class="h"><a name="520"></a>520</td><td></td><td></td><td></td><td></td><td class="s">      print {$fh_xyz} '#'.join(&quot;\t&quot;, @fields).&quot;\n&quot; ;</td></tr>
<tr><td class="h"><a name="521"></a>521</td><td></td><td></td><td></td><td></td><td class="s">      foreach my $point (@{$data-&gt;{xyz}}) {</td></tr>
<tr><td class="h"><a name="522"></a>522</td><td></td><td></td><td></td><td></td><td class="s">         print {$fh_xyz} join(&quot;\t&quot;, @{$point}{@fields}).&quot;\n&quot; ;</td></tr>
<tr><td class="h"><a name="523"></a>523</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="524"></a>524</td><td></td><td></td><td></td><td></td><td class="s">      close($fh_xyz) ;</td></tr>
<tr><td class="h"><a name="525"></a>525</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="526"></a>526</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="527"></a>527</td><td></td><td></td><td></td><td></td><td class="s">   if (exists $in-&gt;{out_pdb}) {</td></tr>
<tr><td class="h"><a name="528"></a>528</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="529"></a>529</td><td></td><td></td><td></td><td></td><td class="s">      my $out_pdb_fn = $in-&gt;{out_pdb} ;</td></tr>
<tr><td class="h"><a name="530"></a>530</td><td></td><td></td><td></td><td></td><td class="s">      my $compress_fl = 0 ;</td></tr>
<tr><td class="h"><a name="531"></a>531</td><td></td><td></td><td></td><td></td><td class="s">      if ($out_pdb_fn =~ /\.gz$/) {</td></tr>
<tr><td class="h"><a name="532"></a>532</td><td></td><td></td><td></td><td></td><td class="s">         $compress_fl = 1 ; $out_pdb_fn =~ s/\.gz// ;}</td></tr>
<tr><td class="h"><a name="533"></a>533</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="534"></a>534</td><td></td><td></td><td></td><td></td><td class="s">      aba_displayxpr_pdbformat({</td></tr>
<tr><td class="h"><a name="535"></a>535</td><td></td><td></td><td></td><td></td><td class="s">         out_pdb =&gt; $out_pdb_fn,</td></tr>
<tr><td class="h"><a name="536"></a>536</td><td></td><td></td><td></td><td></td><td class="s">         data =&gt; $data,</td></tr>
<tr><td class="h"><a name="537"></a>537</td><td></td><td></td><td></td><td></td><td class="s">      }) ;</td></tr>
<tr><td class="h"><a name="538"></a>538</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="539"></a>539</td><td></td><td></td><td></td><td></td><td class="s">      if ($compress_fl) {</td></tr>
<tr><td class="h"><a name="540"></a>540</td><td></td><td></td><td></td><td></td><td class="s">         system(&quot;gzip $out_pdb_fn&quot;) ; }</td></tr>
<tr><td class="h"><a name="541"></a>541</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="542"></a>542</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="543"></a>543</td><td></td><td></td><td></td><td></td><td class="s">   return $data ;</td></tr>
<tr><td class="h"><a name="544"></a>544</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="545"></a>545</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="546"></a>546</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="- -"></a>- -</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="549"></a>549</td><td></td><td></td><td></td><td></td><td class="s">=head2 aba_displayxpr_pdbformat()</td></tr>
<tr><td class="h"><a name="550"></a>550</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="551"></a>551</td><td></td><td></td><td></td><td></td><td class="s">   Title:       aba_displayxpr_pdbformat</td></tr>
<tr><td class="h"><a name="552"></a>552</td><td></td><td></td><td></td><td></td><td class="s">   Function:    Prints out parsed ABA XPR (or XPZ) data as a PDB file</td></tr>
<tr><td class="h"><a name="553"></a>553</td><td></td><td></td><td></td><td></td><td class="s">   Args:        $_-&gt;{data} = parsed ABA XPR data - from aba_parse_xpr()</td></tr>
<tr><td class="h"><a name="554"></a>554</td><td></td><td></td><td></td><td></td><td class="s">                                      (or XPZ file from aba_parse_xpz())</td></tr>
<tr><td class="h"><a name="555"></a>555</td><td></td><td></td><td></td><td></td><td class="s">                $_-&gt;{out_pdb} - output PDB filename</td></tr>
<tr><td class="h"><a name="556"></a>556</td><td></td><td></td><td></td><td></td><td class="s">   Returns:     nothing</td></tr>
<tr><td class="h"><a name="557"></a>557</td><td></td><td></td><td></td><td></td><td class="s">   Files out:   Output PDB file ($_-&gt;{out_pdb})</td></tr>
<tr><td class="h"><a name="558"></a>558</td><td></td><td></td><td></td><td></td><td class="s">                 GLY CA atoms - chains from a-z,A-Z, updated when residue #</td></tr>
<tr><td class="h"><a name="559"></a>559</td><td></td><td></td><td></td><td></td><td class="s">                 reaches 99999</td></tr>
<tr><td class="h"><a name="560"></a>560</td><td></td><td></td><td></td><td></td><td class="s">                 occupancy field = density</td></tr>
<tr><td class="h"><a name="561"></a>561</td><td></td><td></td><td></td><td></td><td class="s">                 B-factor field = energy</td></tr>
<tr><td class="h"><a name="562"></a>562</td><td></td><td></td><td></td><td></td><td class="s">                 charge = intensity</td></tr>
<tr><td class="h"><a name="563"></a>563</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="564"></a>564</td><td></td><td></td><td></td><td></td><td class="s">=cut</td></tr>
<tr><td class="h"><a name="565"></a>565</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="566"></a>566</td><td></td><td></td><td></td><td></td><td class="s">sub aba_displayxpr_pdbformat {</td></tr>
<tr><td class="h"><a name="567"></a>567</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="568"></a>568</td><td></td><td></td><td></td><td></td><td class="s">   my $in = shift ;</td></tr>
<tr><td class="h"><a name="569"></a>569</td><td></td><td></td><td></td><td></td><td class="s">   my $data = $in-&gt;{data} ;</td></tr>
<tr><td class="h"><a name="570"></a>570</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="571"></a>571</td><td></td><td></td><td></td><td></td><td class="s">   my @chains = (1 .. 9);</td></tr>
<tr><td class="h"><a name="572"></a>572</td><td></td><td></td><td></td><td></td><td class="s">   push @chains, ('a' .. 'z'), ('A' .. 'Z');</td></tr>
<tr><td class="h"><a name="573"></a>573</td><td></td><td></td><td></td><td></td><td class="s">   push @chains, ('a' .. 'z'), ('A' .. 'Z');</td></tr>
<tr><td class="h"><a name="574"></a>574</td><td></td><td></td><td></td><td></td><td class="s">   push @chains, ('a' .. 'z'), ('A' .. 'Z');</td></tr>
<tr><td class="h"><a name="575"></a>575</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="576"></a>576</td><td></td><td></td><td></td><td></td><td class="s">   my $fh_pdb ;</td></tr>
<tr><td class="h"><a name="577"></a>577</td><td></td><td></td><td></td><td></td><td class="s">   open($fh_pdb, &quot;&gt; $in-&gt;{out_pdb}&quot;) ;</td></tr>
<tr><td class="h"><a name="578"></a>578</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="579"></a>579</td><td></td><td></td><td></td><td></td><td class="s">   my $atomno = 1;</td></tr>
<tr><td class="h"><a name="580"></a>580</td><td></td><td></td><td></td><td></td><td class="s">   my $chainid = shift @chains ;</td></tr>
<tr><td class="h"><a name="581"></a>581</td><td></td><td></td><td></td><td></td><td class="s">   foreach my $point (@{$data-&gt;{xyz}}) {</td></tr>
<tr><td class="h"><a name="582"></a>582</td><td></td><td></td><td></td><td></td><td class="s">#      my $resno = floor($atomno / 10) ;</td></tr>
<tr><td class="h"><a name="583"></a>583</td><td></td><td></td><td></td><td></td><td class="s">      my $resno = $atomno ;</td></tr>
<tr><td class="h"><a name="584"></a>584</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="585"></a>585</td><td></td><td></td><td></td><td></td><td class="s">      print {$fh_pdb} &quot;ATOM  &quot;.</td></tr>
<tr><td class="h"><a name="586"></a>586</td><td></td><td></td><td></td><td></td><td class="s">            sprintf(&quot;%5d&quot;, $atomno),' ',</td></tr>
<tr><td class="h"><a name="587"></a>587</td><td></td><td></td><td></td><td></td><td class="s">            &quot; CA &quot;,</td></tr>
<tr><td class="h"><a name="588"></a>588</td><td></td><td></td><td></td><td></td><td class="s">            &quot; &quot;,</td></tr>
<tr><td class="h"><a name="589"></a>589</td><td></td><td></td><td></td><td></td><td class="s">            &quot;GLY&quot;,</td></tr>
<tr><td class="h"><a name="590"></a>590</td><td></td><td></td><td></td><td></td><td class="s">            ' ',</td></tr>
<tr><td class="h"><a name="591"></a>591</td><td></td><td></td><td></td><td></td><td class="s">            $chainid,</td></tr>
<tr><td class="h"><a name="592"></a>592</td><td></td><td></td><td></td><td></td><td class="s">            sprintf(&quot;%4d&quot;, $resno),</td></tr>
<tr><td class="h"><a name="593"></a>593</td><td></td><td></td><td></td><td></td><td class="s">            &quot; &quot;,</td></tr>
<tr><td class="h"><a name="594"></a>594</td><td></td><td></td><td></td><td></td><td class="s">            '   ',</td></tr>
<tr><td class="h"><a name="595"></a>595</td><td></td><td></td><td></td><td></td><td class="s">            sprintf(&quot;%8.3f&quot;,$point-&gt;{x}),</td></tr>
<tr><td class="h"><a name="596"></a>596</td><td></td><td></td><td></td><td></td><td class="s">            sprintf(&quot;%8.3f&quot;,$point-&gt;{y}),</td></tr>
<tr><td class="h"><a name="597"></a>597</td><td></td><td></td><td></td><td></td><td class="s">            sprintf(&quot;%8.3f&quot;,$point-&gt;{z}),</td></tr>
<tr><td class="h"><a name="598"></a>598</td><td></td><td></td><td></td><td></td><td class="s">            sprintf(&quot;%6.2f&quot;,$point-&gt;{density}),</td></tr>
<tr><td class="h"><a name="599"></a>599</td><td></td><td></td><td></td><td></td><td class="s">            sprintf(&quot;%6.2f&quot;,$point-&gt;{intensity}),</td></tr>
<tr><td class="h"><a name="600"></a>600</td><td></td><td></td><td></td><td></td><td class="s">            '           ',</td></tr>
<tr><td class="h"><a name="601"></a>601</td><td></td><td></td><td></td><td></td><td class="s">            'CA',</td></tr>
<tr><td class="h"><a name="602"></a>602</td><td></td><td></td><td></td><td></td><td class="s">            $point-&gt;{energy}.&quot;\n&quot; ;</td></tr>
<tr><td class="h"><a name="603"></a>603</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="604"></a>604</td><td></td><td></td><td></td><td></td><td class="s">      $atomno++ ;</td></tr>
<tr><td class="h"><a name="605"></a>605</td><td></td><td></td><td></td><td></td><td class="s">      if ($atomno &gt; 9999) {</td></tr>
<tr><td class="h"><a name="606"></a>606</td><td></td><td></td><td></td><td></td><td class="s">         $atomno = 1 ;</td></tr>
<tr><td class="h"><a name="607"></a>607</td><td></td><td></td><td></td><td></td><td class="s">         $resno  = 1 ;</td></tr>
<tr><td class="h"><a name="608"></a>608</td><td></td><td></td><td></td><td></td><td class="s">         $chainid = shift @chains ;</td></tr>
<tr><td class="h"><a name="609"></a>609</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="610"></a>610</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="611"></a>611</td><td></td><td></td><td></td><td></td><td class="s">   close($fh_pdb) ;</td></tr>
<tr><td class="h"><a name="612"></a>612</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="613"></a>613</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="614"></a>614</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="615"></a>615</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="616"></a>616</td><td></td><td></td><td></td><td></td><td class="s">=head2 _aba_parse_xpr_uncompress_xpr {</td></tr>
<tr><td class="h"><a name="617"></a>617</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="618"></a>618</td><td></td><td></td><td></td><td></td><td class="s">   Title:       _aba_parse_xpr_uncompress_xpr()</td></tr>
<tr><td class="h"><a name="619"></a>619</td><td></td><td></td><td></td><td></td><td class="s">   Function:    creates and runs a python zlib uncompression script to</td></tr>
<tr><td class="h"><a name="620"></a>620</td><td></td><td></td><td></td><td></td><td class="s">                 decompress the zlibbed XPR block</td></tr>
<tr><td class="h"><a name="621"></a>621</td><td></td><td></td><td></td><td></td><td class="s">   Args:        $_-&gt;{fn_out} - output file name</td></tr>
<tr><td class="h"><a name="622"></a>622</td><td></td><td></td><td></td><td></td><td class="s">   Files in:    XPR file ($_-&gt;{fn_in}) ;</td></tr>
<tr><td class="h"><a name="623"></a>623</td><td></td><td></td><td></td><td></td><td class="s">   Files out:   uncompressed XPR block ($_-&gt;{fn_out})</td></tr>
<tr><td class="h"><a name="624"></a>624</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="625"></a>625</td><td></td><td></td><td></td><td></td><td class="s">=cut</td></tr>
<tr><td class="h"><a name="626"></a>626</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="627"></a>627</td><td></td><td></td><td></td><td></td><td class="s">sub _aba_parse_xpr_uncompress_xpr {</td></tr>
<tr><td class="h"><a name="628"></a>628</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="629"></a>629</td><td></td><td></td><td></td><td></td><td class="s">   my $in = shift ;</td></tr>
<tr><td class="h"><a name="630"></a>630</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="631"></a>631</td><td></td><td></td><td></td><td></td><td class="s">   my $xpr_uncompress = &quot;</td></tr>
<tr><td class="h"><a name="632"></a>632</td><td></td><td></td><td></td><td></td><td class="s">import zlib, struct, sys</td></tr>
<tr><td class="h"><a name="633"></a>633</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="634"></a>634</td><td></td><td></td><td></td><td></td><td class="s">try:</td></tr>
<tr><td class="h"><a name="635"></a>635</td><td></td><td></td><td></td><td></td><td class="s">    import psyco</td></tr>
<tr><td class="h"><a name="636"></a>636</td><td></td><td></td><td></td><td></td><td class="s">    psyco.full()</td></tr>
<tr><td class="h"><a name="637"></a>637</td><td></td><td></td><td></td><td></td><td class="s">except ImportError:</td></tr>
<tr><td class="h"><a name="638"></a>638</td><td></td><td></td><td></td><td></td><td class="s">    pass</td></tr>
<tr><td class="h"><a name="639"></a>639</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="640"></a>640</td><td></td><td></td><td></td><td></td><td class="s">def main(args):</td></tr>
<tr><td class="h"><a name="641"></a>641</td><td></td><td></td><td></td><td></td><td class="s">    fp = file('&quot;.$in-&gt;{fn_in}.&quot;', 'rb')</td></tr>
<tr><td class="h"><a name="642"></a>642</td><td></td><td></td><td></td><td></td><td class="s">    data = fp.read(16) #starts 16 in</td></tr>
<tr><td class="h"><a name="643"></a>643</td><td></td><td></td><td></td><td></td><td class="s">    file('&quot;.$in-&gt;{fn_out}.&quot;', 'wb').write(zlib.decompress(fp.read()))</td></tr>
<tr><td class="h"><a name="644"></a>644</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="645"></a>645</td><td></td><td></td><td></td><td></td><td class="s">if __name__=='__main__':</td></tr>
<tr><td class="h"><a name="646"></a>646</td><td></td><td></td><td></td><td></td><td class="s">    sys.exit(main(sys.argv[1:]))</td></tr>
<tr><td class="h"><a name="647"></a>647</td><td></td><td></td><td></td><td></td><td class="s">&quot; ;</td></tr>
<tr><td class="h"><a name="648"></a>648</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="649"></a>649</td><td></td><td></td><td></td><td></td><td class="s">   my ($fh, $fn) = tempfile() ;</td></tr>
<tr><td class="h"><a name="650"></a>650</td><td></td><td></td><td></td><td></td><td class="s">   print $fh ($xpr_uncompress) ;</td></tr>
<tr><td class="h"><a name="651"></a>651</td><td></td><td></td><td></td><td></td><td class="s">   close($fh) ;</td></tr>
<tr><td class="h"><a name="652"></a>652</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="653"></a>653</td><td></td><td></td><td></td><td></td><td class="s">   system(&quot;python $fn&quot;) ;</td></tr>
<tr><td class="h"><a name="654"></a>654</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="655"></a>655</td><td></td><td></td><td></td><td></td><td class="s">   if (!-s $in-&gt;{fn_out}) {</td></tr>
<tr><td class="h"><a name="656"></a>656</td><td></td><td></td><td></td><td></td><td class="s">      die &quot;XPR uncompression didn't work&quot; ; }</td></tr>
<tr><td class="h"><a name="657"></a>657</td><td></td><td></td><td></td><td></td><td class="s">   return ;</td></tr>
<tr><td class="h"><a name="658"></a>658</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="659"></a>659</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="660"></a>660</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="661"></a>661</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="662"></a>662</td><td></td><td></td><td></td><td></td><td class="s">=head2 aba_parse_sva()</td></tr>
<tr><td class="h"><a name="663"></a>663</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="664"></a>664</td><td></td><td></td><td></td><td></td><td class="s">   Title:       aba_parse_sva()</td></tr>
<tr><td class="h"><a name="665"></a>665</td><td></td><td></td><td></td><td></td><td class="s">   Function:    Parses binary ABA SVA files</td></tr>
<tr><td class="h"><a name="666"></a>666</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="667"></a>667</td><td></td><td></td><td></td><td></td><td class="s">   Args:        $_-&gt;{sva} - XPR file path</td></tr>
<tr><td class="h"><a name="668"></a>668</td><td></td><td></td><td></td><td></td><td class="s">                $_-&gt;{roidef} - optionally specify ROIdef structure, if </td></tr>
<tr><td class="h"><a name="669"></a>669</td><td></td><td></td><td></td><td></td><td class="s">                               only those ROI expression is desired</td></tr>
<tr><td class="h"><a name="670"></a>670</td><td></td><td></td><td></td><td></td><td class="s">   Returns:     $-&gt;{x,y,z} = expression energy</td></tr>
<tr><td class="h"><a name="671"></a>671</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="672"></a>672</td><td></td><td></td><td></td><td></td><td class="s">=cut</td></tr>
<tr><td class="h"><a name="673"></a>673</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="674"></a>674</td><td></td><td></td><td></td><td></td><td class="s">sub aba_parse_sva {</td></tr>
<tr><td class="h"><a name="675"></a>675</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="676"></a>676</td><td></td><td></td><td></td><td></td><td class="s">   require File::Basename ;</td></tr>
<tr><td class="h"><a name="677"></a>677</td><td></td><td></td><td></td><td></td><td class="s">   my $in = shift ;</td></tr>
<tr><td class="h"><a name="678"></a>678</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="679"></a>679</td><td></td><td></td><td></td><td></td><td class="s">   my $fn ;</td></tr>
<tr><td class="h"><a name="680"></a>680</td><td></td><td></td><td></td><td></td><td class="s">   $fn-&gt;{sva} = $in-&gt;{fn} ;</td></tr>
<tr><td class="h"><a name="681"></a>681</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="682"></a>682</td><td></td><td></td><td></td><td></td><td class="s">#Comment:Smoothed energy volume for imageseriesId 71919026</td></tr>
<tr><td class="h"><a name="683"></a>683</td><td></td><td></td><td></td><td></td><td class="s">#Dimensions:67,41,58</td></tr>
<tr><td class="h"><a name="684"></a>684</td><td></td><td></td><td></td><td></td><td class="s">#63,9,8,1.43691e-06</td></tr>
<tr><td class="h"><a name="685"></a>685</td><td></td><td></td><td></td><td></td><td class="s">#64,9,8,1.69753e-05</td></tr>
<tr><td class="h"><a name="686"></a>686</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="687"></a>687</td><td></td><td></td><td></td><td></td><td class="s">   open(SVAF, $fn-&gt;{sva}) ;</td></tr>
<tr><td class="h"><a name="688"></a>688</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="689"></a>689</td><td></td><td></td><td></td><td></td><td class="s">   my $comment_line = &lt;SVAF&gt; ;</td></tr>
<tr><td class="h"><a name="690"></a>690</td><td></td><td></td><td></td><td></td><td class="s">   my $dim_line = &lt;SVAF&gt; ; chomp $dim_line; </td></tr>
<tr><td class="h"><a name="691"></a>691</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="692"></a>692</td><td></td><td></td><td></td><td></td><td class="s">   my $xpr_like = 0 ;</td></tr>
<tr><td class="h"><a name="693"></a>693</td><td></td><td></td><td></td><td></td><td class="s">   if (exists $in-&gt;{xpr_like} ||</td></tr>
<tr><td class="h"><a name="694"></a>694</td><td></td><td></td><td></td><td></td><td class="s">       exists $in-&gt;{out_xyz}  ||</td></tr>
<tr><td class="h"><a name="695"></a>695</td><td></td><td></td><td></td><td></td><td class="s">       exists $in-&gt;{out_pdb}    ) { $xpr_like = 1 ; }</td></tr>
<tr><td class="h"><a name="696"></a>696</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="697"></a>697</td><td></td><td></td><td></td><td></td><td class="s">   my $xpr_data ;</td></tr>
<tr><td class="h"><a name="698"></a>698</td><td></td><td></td><td></td><td></td><td class="s">   if ($xpr_like) {</td></tr>
<tr><td class="h"><a name="699"></a>699</td><td></td><td></td><td></td><td></td><td class="s">      $xpr_data-&gt;{meta} = {} ;</td></tr>
<tr><td class="h"><a name="700"></a>700</td><td></td><td></td><td></td><td></td><td class="s">      if ($fn-&gt;{sva} =~ /sagittal/) {</td></tr>
<tr><td class="h"><a name="701"></a>701</td><td></td><td></td><td></td><td></td><td class="s">         $xpr_data-&gt;{meta}-&gt;{plane} = 'sagittal' ;</td></tr>
<tr><td class="h"><a name="702"></a>702</td><td></td><td></td><td></td><td></td><td class="s">      } else {</td></tr>
<tr><td class="h"><a name="703"></a>703</td><td></td><td></td><td></td><td></td><td class="s">         $xpr_data-&gt;{meta}-&gt;{plane} = 'coronal' ;</td></tr>
<tr><td class="h"><a name="704"></a>704</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="705"></a>705</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="706"></a>706</td><td></td><td></td><td></td><td></td><td class="s">      $xpr_data-&gt;{meta}-&gt;{stage} = 'P56' ;</td></tr>
<tr><td class="h"><a name="707"></a>707</td><td></td><td></td><td></td><td></td><td class="s">      $xpr_data-&gt;{meta}-&gt;{xpr_name} = File::Basename::basename($fn-&gt;{sva}) ;</td></tr>
<tr><td class="h"><a name="708"></a>708</td><td></td><td></td><td></td><td></td><td class="s">      ($xpr_data-&gt;{meta}-&gt;{gene_name},</td></tr>
<tr><td class="h"><a name="709"></a>709</td><td></td><td></td><td></td><td></td><td class="s">       $xpr_data-&gt;{meta}-&gt;{plane},</td></tr>
<tr><td class="h"><a name="710"></a>710</td><td></td><td></td><td></td><td></td><td class="s">       $xpr_data-&gt;{meta}-&gt;{imageseries_id}) =</td></tr>
<tr><td class="h"><a name="711"></a>711</td><td></td><td></td><td></td><td></td><td class="s">       split('_', $xpr_data-&gt;{meta}-&gt;{xpr_name});</td></tr>
<tr><td class="h"><a name="712"></a>712</td><td></td><td></td><td></td><td></td><td class="s">      $xpr_data-&gt;{meta}-&gt;{imageseries_id} =~ s/\.sva$// ;</td></tr>
<tr><td class="h"><a name="713"></a>713</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="714"></a>714</td><td></td><td></td><td></td><td></td><td class="s">      ($xpr_data-&gt;{meta}-&gt;{dims_x},</td></tr>
<tr><td class="h"><a name="715"></a>715</td><td></td><td></td><td></td><td></td><td class="s">       $xpr_data-&gt;{meta}-&gt;{dims_y},</td></tr>
<tr><td class="h"><a name="716"></a>716</td><td></td><td></td><td></td><td></td><td class="s">       $xpr_data-&gt;{meta}-&gt;{dims_z}) =</td></tr>
<tr><td class="h"><a name="717"></a>717</td><td></td><td></td><td></td><td></td><td class="s">         ($dim_line =~ /Dimensions:([0-9]+),([0-9]+),([0-9]+)/) ;</td></tr>
<tr><td class="h"><a name="718"></a>718</td><td></td><td></td><td></td><td></td><td class="s">      $xpr_data-&gt;{xyz} = [] ;</td></tr>
<tr><td class="h"><a name="719"></a>719</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="720"></a>720</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="721"></a>721</td><td></td><td></td><td></td><td></td><td class="s">   my $data ;</td></tr>
<tr><td class="h"><a name="722"></a>722</td><td></td><td></td><td></td><td></td><td class="s">   while (my $line = &lt;SVAF&gt;) {</td></tr>
<tr><td class="h"><a name="723"></a>723</td><td></td><td></td><td></td><td></td><td class="s">      chomp $line;</td></tr>
<tr><td class="h"><a name="724"></a>724</td><td></td><td></td><td></td><td></td><td class="s">      my ($x,$y,$z,$val) = split(/\,/, $line) ;</td></tr>
<tr><td class="h"><a name="725"></a>725</td><td></td><td></td><td></td><td></td><td class="s">      my $point = $x.','.$y.','.$z ;</td></tr>
<tr><td class="h"><a name="726"></a>726</td><td></td><td></td><td></td><td></td><td class="s">      if (defined $in-&gt;{roidef_200} &amp;&amp; </td></tr>
<tr><td class="h"><a name="727"></a>727</td><td></td><td></td><td></td><td></td><td class="s">          !exists $in-&gt;{roidef_200}-&gt;{point2roi}-&gt;{$point}) {next;}</td></tr>
<tr><td class="h"><a name="728"></a>728</td><td></td><td></td><td></td><td></td><td class="s">      if ($xpr_like) {</td></tr>
<tr><td class="h"><a name="729"></a>729</td><td></td><td></td><td></td><td></td><td class="s">         push @{$xpr_data-&gt;{xyz}}, {</td></tr>
<tr><td class="h"><a name="730"></a>730</td><td></td><td></td><td></td><td></td><td class="s">            x =&gt; $x,</td></tr>
<tr><td class="h"><a name="731"></a>731</td><td></td><td></td><td></td><td></td><td class="s">            y =&gt; $y,</td></tr>
<tr><td class="h"><a name="732"></a>732</td><td></td><td></td><td></td><td></td><td class="s">            z =&gt; $z,</td></tr>
<tr><td class="h"><a name="733"></a>733</td><td></td><td></td><td></td><td></td><td class="s">            energy =&gt; $val,</td></tr>
<tr><td class="h"><a name="734"></a>734</td><td></td><td></td><td></td><td></td><td class="s">            expression_level =&gt; $val,</td></tr>
<tr><td class="h"><a name="735"></a>735</td><td></td><td></td><td></td><td></td><td class="s">            num_expressors =&gt; $val,</td></tr>
<tr><td class="h"><a name="736"></a>736</td><td></td><td></td><td></td><td></td><td class="s">            grid_area =&gt; $val,</td></tr>
<tr><td class="h"><a name="737"></a>737</td><td></td><td></td><td></td><td></td><td class="s">            cell_diameter =&gt; $val,</td></tr>
<tr><td class="h"><a name="738"></a>738</td><td></td><td></td><td></td><td></td><td class="s">         } ;</td></tr>
<tr><td class="h"><a name="739"></a>739</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="740"></a>740</td><td></td><td></td><td></td><td></td><td class="s">      $data-&gt;{$point} = $val ;</td></tr>
<tr><td class="h"><a name="741"></a>741</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="742"></a>742</td><td></td><td></td><td></td><td></td><td class="s">   close(SVAF) ;</td></tr>
<tr><td class="h"><a name="743"></a>743</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="744"></a>744</td><td></td><td></td><td></td><td></td><td class="s">   if (exists $in-&gt;{out_xyz}) {</td></tr>
<tr><td class="h"><a name="745"></a>745</td><td></td><td></td><td></td><td></td><td class="s">      my $fh_xyz ;</td></tr>
<tr><td class="h"><a name="746"></a>746</td><td></td><td></td><td></td><td></td><td class="s">      open($fh_xyz, &quot;&gt; $in-&gt;{out_xyz}&quot; );</td></tr>
<tr><td class="h"><a name="747"></a>747</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="748"></a>748</td><td></td><td></td><td></td><td></td><td class="s">      foreach my $metainfo (@{$xpr_data-&gt;{meta}-&gt;{gene}}) {</td></tr>
<tr><td class="h"><a name="749"></a>749</td><td></td><td></td><td></td><td></td><td class="s">         print {$fh_xyz} &quot;#meta\t$metainfo\n&quot; ;</td></tr>
<tr><td class="h"><a name="750"></a>750</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="751"></a>751</td><td></td><td></td><td></td><td></td><td class="s">      print {$fh_xyz} &quot;#imageseries_id\t&quot;.</td></tr>
<tr><td class="h"><a name="752"></a>752</td><td></td><td></td><td></td><td></td><td class="s">                      $xpr_data-&gt;{meta}-&gt;{imageseries_id}.&quot;\n&quot; ;</td></tr>
<tr><td class="h"><a name="753"></a>753</td><td></td><td></td><td></td><td></td><td class="s">      print {$fh_xyz} &quot;#gene\t&quot;.$xpr_data-&gt;{meta}-&gt;{gene_name}.&quot;\n&quot; ;</td></tr>
<tr><td class="h"><a name="754"></a>754</td><td></td><td></td><td></td><td></td><td class="s">      print {$fh_xyz} &quot;#stage\t&quot;.$xpr_data-&gt;{meta}-&gt;{stage}.&quot;\n&quot; ;</td></tr>
<tr><td class="h"><a name="755"></a>755</td><td></td><td></td><td></td><td></td><td class="s">      print {$fh_xyz} &quot;#slice\t&quot;.$xpr_data-&gt;{meta}-&gt;{plane}.&quot;\n&quot; ;</td></tr>
<tr><td class="h"><a name="756"></a>756</td><td></td><td></td><td></td><td></td><td class="s">      my @fields = qw/x y z energy/;</td></tr>
<tr><td class="h"><a name="757"></a>757</td><td></td><td></td><td></td><td></td><td class="s">      print {$fh_xyz} '#'.join(&quot;\t&quot;, @fields).&quot;\n&quot; ;</td></tr>
<tr><td class="h"><a name="758"></a>758</td><td></td><td></td><td></td><td></td><td class="s">      my $xy_plane_size = $xpr_data-&gt;{meta}-&gt;{dims_x} *</td></tr>
<tr><td class="h"><a name="759"></a>759</td><td></td><td></td><td></td><td></td><td class="s">                          $xpr_data-&gt;{meta}-&gt;{dims_y} ;</td></tr>
<tr><td class="h"><a name="760"></a>760</td><td></td><td></td><td></td><td></td><td class="s">      foreach my $point (@{$xpr_data-&gt;{xyz}}) {</td></tr>
<tr><td class="h"><a name="761"></a>761</td><td></td><td></td><td></td><td></td><td class="s">         print {$fh_xyz} join(&quot;\t&quot;, $point-&gt;{x},</td></tr>
<tr><td class="h"><a name="762"></a>762</td><td></td><td></td><td></td><td></td><td class="s">                                    $point-&gt;{y},</td></tr>
<tr><td class="h"><a name="763"></a>763</td><td></td><td></td><td></td><td></td><td class="s">                                    $point-&gt;{z},</td></tr>
<tr><td class="h"><a name="764"></a>764</td><td></td><td></td><td></td><td></td><td class="s">                                    $point-&gt;{energy}).&quot;\n&quot;;</td></tr>
<tr><td class="h"><a name="765"></a>765</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="766"></a>766</td><td></td><td></td><td></td><td></td><td class="s">      close($fh_xyz) ;</td></tr>
<tr><td class="h"><a name="767"></a>767</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="768"></a>768</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="769"></a>769</td><td></td><td></td><td></td><td></td><td class="s">   if (exists $in-&gt;{out_pdb}) {</td></tr>
<tr><td class="h"><a name="770"></a>770</td><td></td><td></td><td></td><td></td><td class="s">      my $out_pdb_fn = $in-&gt;{out_pdb} ;</td></tr>
<tr><td class="h"><a name="771"></a>771</td><td></td><td></td><td></td><td></td><td class="s">      my $compress_fl = 0 ;</td></tr>
<tr><td class="h"><a name="772"></a>772</td><td></td><td></td><td></td><td></td><td class="s">      if ($out_pdb_fn =~ /\.gz$/) {</td></tr>
<tr><td class="h"><a name="773"></a>773</td><td></td><td></td><td></td><td></td><td class="s">         $compress_fl = 1 ; $out_pdb_fn =~ s/\.gz// ;}</td></tr>
<tr><td class="h"><a name="774"></a>774</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="775"></a>775</td><td></td><td></td><td></td><td></td><td class="s">      aba_displayxpr_pdbformat({</td></tr>
<tr><td class="h"><a name="776"></a>776</td><td></td><td></td><td></td><td></td><td class="s">         out_pdb =&gt; $out_pdb_fn,</td></tr>
<tr><td class="h"><a name="777"></a>777</td><td></td><td></td><td></td><td></td><td class="s">         data =&gt; $xpr_data,</td></tr>
<tr><td class="h"><a name="778"></a>778</td><td></td><td></td><td></td><td></td><td class="s">      }) ;</td></tr>
<tr><td class="h"><a name="779"></a>779</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="780"></a>780</td><td></td><td></td><td></td><td></td><td class="s">      if ($compress_fl) {</td></tr>
<tr><td class="h"><a name="781"></a>781</td><td></td><td></td><td></td><td></td><td class="s">         system(&quot;gzip $out_pdb_fn&quot;) ; }</td></tr>
<tr><td class="h"><a name="782"></a>782</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="783"></a>783</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="784"></a>784</td><td></td><td></td><td></td><td></td><td class="s">   if (exists $in-&gt;{xpr_like}) {</td></tr>
<tr><td class="h"><a name="785"></a>785</td><td></td><td></td><td></td><td></td><td class="s">      return $xpr_data ;</td></tr>
<tr><td class="h"><a name="786"></a>786</td><td></td><td></td><td></td><td></td><td class="s">   } else {</td></tr>
<tr><td class="h"><a name="787"></a>787</td><td></td><td></td><td></td><td></td><td class="s">      return $data ;</td></tr>
<tr><td class="h"><a name="788"></a>788</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="789"></a>789</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="790"></a>790</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="791"></a>791</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="- -"></a>- -</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="794"></a>794</td><td></td><td></td><td></td><td></td><td class="s">#sub readin_roi_list_results {</td></tr>
<tr><td class="h"><a name="795"></a>795</td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h"><a name="796"></a>796</td><td></td><td></td><td></td><td></td><td class="s">#   my $in = shift;</td></tr>
<tr><td class="h"><a name="797"></a>797</td><td></td><td></td><td></td><td></td><td class="s">#   my $f2i ;</td></tr>
<tr><td class="h"><a name="798"></a>798</td><td></td><td></td><td></td><td></td><td class="s">#   foreach my $j ( 0 .. $#{$in-&gt;{headers}-&gt;{headers}}) {</td></tr>
<tr><td class="h"><a name="799"></a>799</td><td></td><td></td><td></td><td></td><td class="s">#      $f2i-&gt;{$in-&gt;{headers}-&gt;{headers}-&gt;[$j]} = $j ; }</td></tr>
<tr><td class="h"><a name="800"></a>800</td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h"><a name="801"></a>801</td><td></td><td></td><td></td><td></td><td class="s">#   open(RESULTSF, $in-&gt;{fn}) ;</td></tr>
<tr><td class="h"><a name="802"></a>802</td><td></td><td></td><td></td><td></td><td class="s">#   my $roi_data ;</td></tr>
<tr><td class="h"><a name="803"></a>803</td><td></td><td></td><td></td><td></td><td class="s">#   while (my $line = &lt;RESULTSF&gt;) {</td></tr>
<tr><td class="h"><a name="804"></a>804</td><td></td><td></td><td></td><td></td><td class="s">#      chomp $line;</td></tr>
<tr><td class="h"><a name="805"></a>805</td><td></td><td></td><td></td><td></td><td class="s">#      if ($line =~ /^#/) {next;}</td></tr>
<tr><td class="h"><a name="806"></a>806</td><td></td><td></td><td></td><td></td><td class="s">#      my $entry ;</td></tr>
<tr><td class="h"><a name="807"></a>807</td><td></td><td></td><td></td><td></td><td class="s">#      my @t = split(/\t/, $line) ;</td></tr>
<tr><td class="h"><a name="808"></a>808</td><td></td><td></td><td></td><td></td><td class="s">#      foreach my $j (0 .. $#t) {</td></tr>
<tr><td class="h"><a name="809"></a>809</td><td></td><td></td><td></td><td></td><td class="s">#         $entry-&gt;{$in-&gt;{headers}-&gt;{headers}-&gt;[$j]} = $t[$j] ;</td></tr>
<tr><td class="h"><a name="810"></a>810</td><td></td><td></td><td></td><td></td><td class="s">#      }</td></tr>
<tr><td class="h"><a name="811"></a>811</td><td></td><td></td><td></td><td></td><td class="s">#      if ($entry-&gt;{plane} ne 'sagittal' &amp;&amp;</td></tr>
<tr><td class="h"><a name="812"></a>812</td><td></td><td></td><td></td><td></td><td class="s">#          $entry-&gt;{plane} ne 'coronal') {</td></tr>
<tr><td class="h"><a name="813"></a>813</td><td></td><td></td><td></td><td></td><td class="s">#         next; }</td></tr>
<tr><td class="h"><a name="814"></a>814</td><td></td><td></td><td></td><td></td><td class="s">#      foreach my $f (sort keys %{$f2i}) {</td></tr>
<tr><td class="h"><a name="815"></a>815</td><td></td><td></td><td></td><td></td><td class="s">#         push @{$roi_data-&gt;{$entry-&gt;{roi_name}}-&gt;{$entry-&gt;{plane}}-&gt;{$f}},</td></tr>
<tr><td class="h"><a name="816"></a>816</td><td></td><td></td><td></td><td></td><td class="s">#            $entry-&gt;{$f} ; }</td></tr>
<tr><td class="h"><a name="817"></a>817</td><td></td><td></td><td></td><td></td><td class="s">#   }</td></tr>
<tr><td class="h"><a name="818"></a>818</td><td></td><td></td><td></td><td></td><td class="s">#   close(RESULTSF) ;</td></tr>
<tr><td class="h"><a name="819"></a>819</td><td></td><td></td><td></td><td></td><td class="s">#   return $roi_data ;</td></tr>
<tr><td class="h"><a name="820"></a>820</td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h"><a name="821"></a>821</td><td></td><td></td><td></td><td></td><td class="s">#}</td></tr>
<tr><td class="h"><a name="822"></a>822</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="823"></a>823</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="824"></a>824</td><td></td><td></td><td></td><td></td><td class="s">=head2 readin_roi_file()</td></tr>
<tr><td class="h"><a name="825"></a>825</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="826"></a>826</td><td></td><td></td><td></td><td></td><td class="s">   Title:       readin_roi_file()</td></tr>
<tr><td class="h"><a name="827"></a>827</td><td></td><td></td><td></td><td></td><td class="s">   Function:    Read in the ROI definition</td></tr>
<tr><td class="h"><a name="828"></a>828</td><td></td><td></td><td></td><td></td><td class="s">   Args:        $_-&gt;{fn} [optional - if not will read in from STDIN]</td></tr>
<tr><td class="h"><a name="829"></a>829</td><td></td><td></td><td></td><td></td><td class="s">   Returns:     $_-&gt;{}-&gt;{point2strx}-&gt;{x,y,z} = brain_strx_id ;</td></tr>
<tr><td class="h"><a name="830"></a>830</td><td></td><td></td><td></td><td></td><td class="s">                $_-&gt;{}-&gt;{strx2points}-&gt;{brain_strx_id}-&gt;[i] = &quot;x_i,y_i,z_i&quot;</td></tr>
<tr><td class="h"><a name="831"></a>831</td><td></td><td></td><td></td><td></td><td class="s">   Files in:    AtlasAnnotation100.sva</td></tr>
<tr><td class="h"><a name="832"></a>832</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="833"></a>833</td><td></td><td></td><td></td><td></td><td class="s">=cut</td></tr>
<tr><td class="h"><a name="834"></a>834</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="835"></a>835</td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 1.76s (105ms+1.66) within alnmnr::io::readin_roi_file which was called:
#    once (105ms+1.66s) by alnmnr::getinp::_getinp_simsearch at <a href="alnmnr-getinp-pm-48-line.html#229">line 229 of alnmnr/getinp.pm</a></div></div>sub readin_roi_file {</td></tr>
<tr><td class="h"><a name="836"></a>836</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="837"></a>837</td><td class="c3">1</td><td class="c3"><span title="Avg 300ns">300ns</span></td><td></td><td></td><td class="s">   my $in = shift ;</td></tr>
<tr><td class="h"><a name="838"></a>838</td><td class="c3">1</td><td class="c3"><span title="Avg 300ns">300ns</span></td><td></td><td></td><td class="s">   my $age = $in-&gt;{age} ;</td></tr>
<tr><td class="h"><a name="839"></a>839</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="840"></a>840</td><td class="c3">1</td><td class="c3"><span title="Avg 2µs">2µs</span></td><td></td><td></td><td class="s">   my $options = {</td></tr>
<tr><td class="h"><a name="841"></a>841</td><td></td><td></td><td></td><td></td><td class="s">      roi_axes =&gt; {</td></tr>
<tr><td class="h"><a name="842"></a>842</td><td></td><td></td><td></td><td></td><td class="s">         xmin =&gt; 1,</td></tr>
<tr><td class="h"><a name="843"></a>843</td><td></td><td></td><td></td><td></td><td class="s">         xmax =&gt; 1,</td></tr>
<tr><td class="h"><a name="844"></a>844</td><td></td><td></td><td></td><td></td><td class="s">         ymin =&gt; 1,</td></tr>
<tr><td class="h"><a name="845"></a>845</td><td></td><td></td><td></td><td></td><td class="s">         ymax =&gt; 1,</td></tr>
<tr><td class="h"><a name="846"></a>846</td><td></td><td></td><td></td><td></td><td class="s">         zmin =&gt; 1,</td></tr>
<tr><td class="h"><a name="847"></a>847</td><td></td><td></td><td></td><td></td><td class="s">         zmax =&gt; 1,</td></tr>
<tr><td class="h"><a name="848"></a>848</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="849"></a>849</td><td></td><td></td><td></td><td></td><td class="s">   } ;</td></tr>
<tr><td class="h"><a name="850"></a>850</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="851"></a>851</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="852"></a>852</td><td class="c3">1</td><td class="c3"><span title="Avg 200ns">200ns</span></td><td></td><td></td><td class="s">   my $specs ;</td></tr>
<tr><td class="h"><a name="853"></a>853</td><td class="c3">1</td><td class="c3"><span title="Avg 400ns">400ns</span></td><td></td><td></td><td class="s">   if (exists $in-&gt;{specs}) {</td></tr>
<tr><td class="h"><a name="854"></a>854</td><td></td><td></td><td></td><td></td><td class="s">      $specs = $in-&gt;{specs} ;</td></tr>
<tr><td class="h"><a name="855"></a>855</td><td></td><td></td><td></td><td></td><td class="s">   } else {</td></tr>
<tr><td class="h"><a name="856"></a>856</td><td class="c3">1</td><td class="c3"><span title="Avg 1µs">1µs</span></td><td class="c3">1</td><td class="c3">79µs</td><td class="s">      $specs = alnmnr::getspecs() ;<div class="calls"><div class="calls_out">      # spent    79µs making 1 call to <a href="alnmnr-pm-8-line.html#58">alnmnr::getspecs</a></div></div></td></tr>
<tr><td class="h"><a name="857"></a>857</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="858"></a>858</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="859"></a>859</td><td class="c3">1</td><td class="c3"><span title="Avg 500ns">500ns</span></td><td></td><td></td><td class="s">   if (!exists $specs-&gt;{dims}-&gt;{$age}) {</td></tr>
<tr><td class="h"><a name="860"></a>860</td><td></td><td></td><td></td><td></td><td class="s">      die &quot;FATAL ERROR: age $age is not one of the ABA timepoints: &quot;.</td></tr>
<tr><td class="h"><a name="861"></a>861</td><td></td><td></td><td></td><td></td><td class="s">          join(&quot;, &quot;, sort keys %{$specs-&gt;{dims}}).&quot;\n&quot; ;</td></tr>
<tr><td class="h"><a name="862"></a>862</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="863"></a>863</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="864"></a>864</td><td class="c3">1</td><td class="c3"><span title="Avg 16µs">16µs</span></td><td class="c3">1</td><td class="c3">11µs</td><td class="s">   if (!-s $in-&gt;{fn}) {<div class="calls"><div class="calls_out">   # spent    11µs making 1 call to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_ftsize">alnmnr::io::CORE:ftsize</a></div></div></td></tr>
<tr><td class="h"><a name="865"></a>865</td><td></td><td></td><td></td><td></td><td class="s">      die &quot;FATAL ERROR: ROI definition file &quot;.$in-&gt;{fn}.&quot; not found\n&quot;; }</td></tr>
<tr><td class="h"><a name="866"></a>866</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="867"></a>867</td><td></td><td></td><td></td><td></td><td class="s"># view-volume = mm / $scaling</td></tr>
<tr><td class="h"><a name="868"></a>868</td><td class="c3">1</td><td class="c3"><span title="Avg 4µs">4µs</span></td><td></td><td></td><td class="s">   my $scaling = $specs-&gt;{view_volume}-&gt;{$in-&gt;{age}}-&gt;{spacing} / 1000;</td></tr>
<tr><td class="h"><a name="869"></a>869</td><td class="c3">1</td><td class="c3"><span title="Avg 900ns">900ns</span></td><td></td><td></td><td class="s">   my $scaling_inv = 1000 / $specs-&gt;{view_volume}-&gt;{$in-&gt;{age}}-&gt;{spacing} ;</td></tr>
<tr><td class="h"><a name="870"></a>870</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="871"></a>871</td><td></td><td></td><td></td><td></td><td class="s"># don't divide by $scaling, just multiply by $scaling_inv if needed</td></tr>
<tr><td class="h"><a name="872"></a>872</td><td></td><td></td><td></td><td></td><td class="s"># because of precision issue.</td></tr>
<tr><td class="h"><a name="873"></a>873</td><td></td><td></td><td></td><td></td><td class="s"># eg, a = 11.6 / (1 / 5 ) = 57.999999999999992894572642398998, not 58.</td></tr>
<tr><td class="h"><a name="874"></a>874</td><td></td><td></td><td></td><td></td><td class="s"># so if we build an array of (a .. n), will start from 57, not 58.</td></tr>
<tr><td class="h"><a name="875"></a>875</td><td></td><td></td><td></td><td></td><td class="s"># alt, call ceil() to be safe...</td></tr>
<tr><td class="h"><a name="876"></a>876</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="877"></a>877</td><td class="c3">1</td><td class="c3"><span title="Avg 42µs">42µs</span></td><td class="c3">1</td><td class="c3">36µs</td><td class="s">   print STDERR &quot;Reading ROI file $in-&gt;{fn}\n&quot; ;<div class="calls"><div class="calls_out">   # spent    36µs making 1 call to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_print">alnmnr::io::CORE:print</a></div></div></td></tr>
<tr><td class="h"><a name="878"></a>878</td><td class="c3">1</td><td class="c0"><span title="Avg 301µs">301µs</span></td><td class="c3">1</td><td class="c3">283µs</td><td class="s">   open(ROIDEF, $in-&gt;{fn}) ;<div class="calls"><div class="calls_out">   # spent   283µs making 1 call to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_open">alnmnr::io::CORE:open</a></div></div></td></tr>
<tr><td class="h"><a name="879"></a>879</td><td class="c3">1</td><td class="c3"><span title="Avg 300ns">300ns</span></td><td></td><td></td><td class="s">   my $roidef ;</td></tr>
<tr><td class="h"><a name="880"></a>880</td><td class="c3">1</td><td class="c3"><span title="Avg 900ns">900ns</span></td><td></td><td></td><td class="s">   my $results = {};</td></tr>
<tr><td class="h"><a name="881"></a>881</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="882"></a>882</td><td></td><td></td><td></td><td></td><td class="s">#120104_1824 - convert all coordinates as they are read from mm to view volume</td></tr>
<tr><td class="h"><a name="883"></a>883</td><td class="c3">1</td><td class="c3"><span title="Avg 29µs">29µs</span></td><td class="c3">2</td><td class="c3">21µs</td><td class="s">   while (my $line = &lt;ROIDEF&gt;) {<div class="calls"><div class="calls_out">   # spent    21µs making 2 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_readline">alnmnr::io::CORE:readline</a>, avg 10µs/call</div></div></td></tr>
<tr><td class="h"><a name="884"></a>884</td><td class="c3">1</td><td class="c3"><span title="Avg 12µs">12µs</span></td><td class="c3">2</td><td class="c3">3µs</td><td class="s">      if ($line =~ /^\#/ || $line =~ /^$/) {next;}<div class="calls"><div class="calls_out">      # spent     3µs making 2 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_match">alnmnr::io::CORE:match</a>, avg 1µs/call</div></div></td></tr>
<tr><td class="h"><a name="885"></a>885</td><td class="c3">1</td><td class="c3"><span title="Avg 2µs">2µs</span></td><td></td><td></td><td class="s">      chomp $line;</td></tr>
<tr><td class="h"><a name="886"></a>886</td><td class="c3">1</td><td class="c3"><span title="Avg 4µs">4µs</span></td><td></td><td></td><td class="s">      my ($name, $subname, $roi_type, @t) = split(/\t/, $line) ;</td></tr>
<tr><td class="h"><a name="887"></a>887</td><td class="c3">1</td><td class="c3"><span title="Avg 800ns">800ns</span></td><td></td><td></td><td class="s">      if ($subname eq '') {$subname = $name;}</td></tr>
<tr><td class="h"><a name="888"></a>888</td><td class="c3">1</td><td class="c3"><span title="Avg 2µs">2µs</span></td><td></td><td></td><td class="s">      if (!exists $roidef-&gt;{$name}-&gt;{$subname}) {</td></tr>
<tr><td class="h"><a name="889"></a>889</td><td class="c3">1</td><td class="c3"><span title="Avg 1µs">1µs</span></td><td></td><td></td><td class="s">         $results-&gt;{roi_meta}-&gt;{$name}-&gt;{$subname}-&gt;{roi_spec} = $line ;</td></tr>
<tr><td class="h"><a name="890"></a>890</td><td class="c3">1</td><td class="c3"><span title="Avg 700ns">700ns</span></td><td></td><td></td><td class="s">         $results-&gt;{roi_meta}-&gt;{$name}-&gt;{$subname}-&gt;{roi_type} = $roi_type ;</td></tr>
<tr><td class="h"><a name="891"></a>891</td><td class="c3">1</td><td class="c3"><span title="Avg 800ns">800ns</span></td><td></td><td></td><td class="s">         $roidef-&gt;{$name}-&gt;{$subname}-&gt;{roi_type} = $roi_type ;</td></tr>
<tr><td class="h"><a name="892"></a>892</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="893"></a>893</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="894"></a>894</td><td class="c3">1</td><td class="c3"><span title="Avg 6µs">6µs</span></td><td class="c3">1</td><td class="c3">400ns</td><td class="s">      if ($roi_type =~ /^boxbounds/) {<div class="calls"><div class="calls_out">      # spent   400ns making 1 call to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_match">alnmnr::io::CORE:match</a></div></div></td></tr>
<tr><td class="h"><a name="895"></a>895</td><td></td><td></td><td></td><td></td><td class="s">         my ($axes_type, $value) = @t ;</td></tr>
<tr><td class="h"><a name="896"></a>896</td><td></td><td></td><td></td><td></td><td class="s">         if (!exists $options-&gt;{roi_axes}-&gt;{$axes_type}) {</td></tr>
<tr><td class="h"><a name="897"></a>897</td><td></td><td></td><td></td><td></td><td class="s">            die &quot;ERROR: roi axes $axes_type not recognized\n&quot;.</td></tr>
<tr><td class="h"><a name="898"></a>898</td><td></td><td></td><td></td><td></td><td class="s">                &quot;must be one of: &quot;.join(&quot;, &quot;,keys %{$options-&gt;{roi_axes}}).&quot;\n&quot;;</td></tr>
<tr><td class="h"><a name="899"></a>899</td><td></td><td></td><td></td><td></td><td class="s">         }</td></tr>
<tr><td class="h"><a name="900"></a>900</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="901"></a>901</td><td></td><td></td><td></td><td></td><td class="s">         $value =~ s/x/(x \* $scaling)/g ;</td></tr>
<tr><td class="h"><a name="902"></a>902</td><td></td><td></td><td></td><td></td><td class="s">         $value =~ s/y/(y \* $scaling)/g ;</td></tr>
<tr><td class="h"><a name="903"></a>903</td><td></td><td></td><td></td><td></td><td class="s">         $value =~ s/z/(z \* $scaling)/g ;</td></tr>
<tr><td class="h"><a name="904"></a>904</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="905"></a>905</td><td></td><td></td><td></td><td></td><td class="s">         if ($value =~ /[xyz]/)  {</td></tr>
<tr><td class="h"><a name="906"></a>906</td><td></td><td></td><td></td><td></td><td class="s">            $value = '( '.$value.&quot; ) * $scaling_inv&quot; ;</td></tr>
<tr><td class="h"><a name="907"></a>907</td><td></td><td></td><td></td><td></td><td class="s">            $roidef-&gt;{$name}-&gt;{$subname}-&gt;{$axes_type}-&gt;{value} = $value ;</td></tr>
<tr><td class="h"><a name="908"></a>908</td><td></td><td></td><td></td><td></td><td class="s">            $roidef-&gt;{$name}-&gt;{$subname}-&gt;{$axes_type}-&gt;{type} = 'variable' ;</td></tr>
<tr><td class="h"><a name="909"></a>909</td><td></td><td></td><td></td><td></td><td class="s">         } else {</td></tr>
<tr><td class="h"><a name="910"></a>910</td><td></td><td></td><td></td><td></td><td class="s">            $roidef-&gt;{$name}-&gt;{$subname}-&gt;{$axes_type}-&gt;{type} = 'constant' ;</td></tr>
<tr><td class="h"><a name="911"></a>911</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="912"></a>912</td><td></td><td></td><td></td><td></td><td class="s"># even though constant, have to apply scaling factor</td></tr>
<tr><td class="h"><a name="913"></a>913</td><td></td><td></td><td></td><td></td><td class="s">            $roidef-&gt;{$name}-&gt;{$subname}-&gt;{$axes_type}-&gt;{value} =</td></tr>
<tr><td class="h"><a name="914"></a>914</td><td></td><td></td><td></td><td></td><td class="s">               $value * $scaling_inv ;</td></tr>
<tr><td class="h"><a name="915"></a>915</td><td></td><td></td><td></td><td></td><td class="s">         }</td></tr>
<tr><td class="h"><a name="916"></a>916</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="917"></a>917</td><td></td><td></td><td></td><td></td><td class="s">      } elsif ($roi_type eq 'point') {</td></tr>
<tr><td class="h"><a name="918"></a>918</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="919"></a>919</td><td></td><td></td><td></td><td></td><td class="s">         my ($x,$y,$z) ;</td></tr>
<tr><td class="h"><a name="920"></a>920</td><td></td><td></td><td></td><td></td><td class="s">         if ($t[0] =~ /\,/) {</td></tr>
<tr><td class="h"><a name="921"></a>921</td><td></td><td></td><td></td><td></td><td class="s">            ($x,$y,$z) = split(',', $t[0]) ;</td></tr>
<tr><td class="h"><a name="922"></a>922</td><td></td><td></td><td></td><td></td><td class="s">         } else {</td></tr>
<tr><td class="h"><a name="923"></a>923</td><td></td><td></td><td></td><td></td><td class="s">            ($x,$y,$z) = ($t[0], $t[1], $t[2]) ;</td></tr>
<tr><td class="h"><a name="924"></a>924</td><td></td><td></td><td></td><td></td><td class="s">         }</td></tr>
<tr><td class="h"><a name="925"></a>925</td><td></td><td></td><td></td><td></td><td class="s">#fpd120405_1825 - internal coordinates must be integer (as in xpz files)</td></tr>
<tr><td class="h"><a name="926"></a>926</td><td></td><td></td><td></td><td></td><td class="s">         my $x2 = sprintf(&quot;%.0f&quot;, $x * $scaling_inv) ;</td></tr>
<tr><td class="h"><a name="927"></a>927</td><td></td><td></td><td></td><td></td><td class="s">         my $y2 = sprintf(&quot;%.0f&quot;, $y * $scaling_inv) ;</td></tr>
<tr><td class="h"><a name="928"></a>928</td><td></td><td></td><td></td><td></td><td class="s">         my $z2 = sprintf(&quot;%.0f&quot;, $z * $scaling_inv) ;</td></tr>
<tr><td class="h"><a name="929"></a>929</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="930"></a>930</td><td></td><td></td><td></td><td></td><td class="s">         $roidef-&gt;{$name}-&gt;{$subname}-&gt;{points}-&gt;{&quot;$x2,$y2,$z2&quot;}++ ;</td></tr>
<tr><td class="h"><a name="931"></a>931</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="932"></a>932</td><td></td><td></td><td></td><td></td><td class="s">      } elsif ($roi_type eq 'brainstrx') {</td></tr>
<tr><td class="h"><a name="933"></a>933</td><td></td><td></td><td></td><td></td><td class="s">         $roidef-&gt;{$name}-&gt;{$subname}-&gt;{brainstrx} = $t[0];</td></tr>
<tr><td class="h"><a name="934"></a>934</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="935"></a>935</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="936"></a>936</td><td class="c3">1</td><td class="c3"><span title="Avg 13µs">13µs</span></td><td class="c3">1</td><td class="c3">8µs</td><td class="s">   close(ROIDEF) ;<div class="calls"><div class="calls_out">   # spent     8µs making 1 call to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_close">alnmnr::io::CORE:close</a></div></div></td></tr>
<tr><td class="h"><a name="937"></a>937</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="938"></a>938</td><td class="c3">1</td><td class="c3"><span title="Avg 4µs">4µs</span></td><td></td><td></td><td class="s">   foreach my $roi_name (keys %{$roidef}) {</td></tr>
<tr><td class="h"><a name="939"></a>939</td><td class="c3">1</td><td class="c3"><span title="Avg 500ns">500ns</span></td><td></td><td></td><td class="s">      my $a = {};</td></tr>
<tr><td class="h"><a name="940"></a>940</td><td></td><td></td><td></td><td></td><td class="s">#      print STDERR &quot;   read in roi $roi_name\n&quot; ;</td></tr>
<tr><td class="h"><a name="941"></a>941</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="942"></a>942</td><td class="c3">1</td><td class="c3"><span title="Avg 100ns">100ns</span></td><td></td><td></td><td class="s">      my $off_points ; #enables use of strx=off AND boxbounds for same ROI</td></tr>
<tr><td class="h"><a name="943"></a>943</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="944"></a>944</td><td class="c3">1</td><td class="c3"><span title="Avg 2µs">2µs</span></td><td></td><td></td><td class="s">      foreach my $roi_subname (keys %{$roidef-&gt;{$roi_name}}) {</td></tr>
<tr><td class="h"><a name="945"></a>945</td><td class="c3">1</td><td class="c3"><span title="Avg 400ns">400ns</span></td><td></td><td></td><td class="s">         my $cur_roidef = $roidef-&gt;{$roi_name}-&gt;{$roi_subname} ;</td></tr>
<tr><td class="h"><a name="946"></a>946</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="947"></a>947</td><td class="c3">1</td><td class="c3"><span title="Avg 2µs">2µs</span></td><td></td><td></td><td class="s">         if ($cur_roidef-&gt;{roi_type} eq 'brainstrx') {</td></tr>
<tr><td class="h"><a name="948"></a>948</td><td class="c3">1</td><td class="c3"><span title="Avg 11µs">11µs</span></td><td class="c3">1</td><td class="c0">1.62s</td><td class="s">            if (!exists $specs-&gt;{parsed_annotation}) {<div class="calls"><div class="calls_out">            # spent  1.62s making 1 call to <a href="alnmnr-io-pm-49-line.html#1695">alnmnr::io::load_aba_Annotation</a></div></div></td></tr>
<tr><td class="h"><a name="949"></a>949</td><td></td><td></td><td></td><td></td><td class="s">               $specs-&gt;{parsed_annotation}= load_aba_Annotation({age =&gt; $age});}</td></tr>
<tr><td class="h"><a name="950"></a>950</td><td></td><td></td><td></td><td></td><td class="s">            $cur_roidef-&gt;{points} = get_brainstrx_voxels({</td></tr>
<tr><td class="h"><a name="951"></a>951</td><td></td><td></td><td></td><td></td><td class="s">               age =&gt; $age,</td></tr>
<tr><td class="h"><a name="952"></a>952</td><td></td><td></td><td></td><td></td><td class="s">               specs =&gt; $specs,</td></tr>
<tr><td class="h"><a name="953"></a>953</td><td></td><td></td><td></td><td></td><td class="s">               brainstrx =&gt; $cur_roidef-&gt;{brainstrx}</td></tr>
<tr><td class="h"><a name="954"></a>954</td><td class="c3">1</td><td class="c3"><span title="Avg 21µs">21µs</span></td><td class="c3">1</td><td class="c0">35.8ms</td><td class="s">            })  ;<div class="calls"><div class="calls_out">            # spent  35.8ms making 1 call to <a href="alnmnr-io-pm-49-line.html#1548">alnmnr::io::get_brainstrx_voxels</a></div></div></td></tr>
<tr><td class="h"><a name="955"></a>955</td><td></td><td></td><td></td><td></td><td class="s">         }</td></tr>
<tr><td class="h"><a name="956"></a>956</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="957"></a>957</td><td class="c3">1</td><td class="c3"><span title="Avg 4µs">4µs</span></td><td></td><td></td><td class="s">         if ($cur_roidef-&gt;{roi_type} eq 'boxbounds') {</td></tr>
<tr><td class="h"><a name="958"></a>958</td><td></td><td></td><td></td><td></td><td class="s">            $cur_roidef-&gt;{points} = alnmnr::roiops::calc_roi_boxbounds_pointlist({</td></tr>
<tr><td class="h"><a name="959"></a>959</td><td></td><td></td><td></td><td></td><td class="s">               roidef =&gt; $cur_roidef,</td></tr>
<tr><td class="h"><a name="960"></a>960</td><td></td><td></td><td></td><td></td><td class="s">               pointlist =&gt; 1,</td></tr>
<tr><td class="h"><a name="961"></a>961</td><td></td><td></td><td></td><td></td><td class="s">            }) ;</td></tr>
<tr><td class="h"><a name="962"></a>962</td><td></td><td></td><td></td><td></td><td class="s">         }</td></tr>
<tr><td class="h"><a name="963"></a>963</td><td class="c3">1</td><td class="c3"><span title="Avg 3µs">3µs</span></td><td></td><td></td><td class="s">         $cur_roidef-&gt;{num_roidef_points} = keys %{$cur_roidef-&gt;{points}} ;</td></tr>
<tr><td class="h"><a name="964"></a>964</td><td class="c3">1</td><td class="c0"><span title="Avg 319µs">319µs</span></td><td></td><td></td><td class="s">         foreach my $point (keys %{$cur_roidef-&gt;{points}}) {</td></tr>
<tr><td class="h"><a name="965"></a>965</td><td class="c0">2706</td><td class="c0"><span title="Avg 372ns">1.01ms</span></td><td></td><td></td><td class="s">            if ($cur_roidef-&gt;{points}-&gt;{$point} &gt; 0) { #if positive</td></tr>
<tr><td class="h"><a name="966"></a>966</td><td class="c0">2706</td><td class="c0"><span title="Avg 482ns">1.30ms</span></td><td></td><td></td><td class="s">               $results-&gt;{point2roi}-&gt;{$point}-&gt;{$roi_name}++ ;</td></tr>
<tr><td class="h"><a name="967"></a>967</td><td class="c0">2706</td><td class="c0"><span title="Avg 246ns">667µs</span></td><td></td><td></td><td class="s">               $a-&gt;{$point}++ ;</td></tr>
<tr><td class="h"><a name="968"></a>968</td><td></td><td></td><td></td><td></td><td class="s">            } else { #otherwise, an off point</td></tr>
<tr><td class="h"><a name="969"></a>969</td><td></td><td></td><td></td><td></td><td class="s">               $off_points-&gt;{$point}++ ;</td></tr>
<tr><td class="h"><a name="970"></a>970</td><td></td><td></td><td></td><td></td><td class="s">            }</td></tr>
<tr><td class="h"><a name="971"></a>971</td><td></td><td></td><td></td><td></td><td class="s">         }</td></tr>
<tr><td class="h"><a name="972"></a>972</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="973"></a>973</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="974"></a>974</td><td class="c3">1</td><td class="c3"><span title="Avg 2µs">2µs</span></td><td></td><td></td><td class="s">      foreach my $off_point (keys %{$off_points}) {</td></tr>
<tr><td class="h"><a name="975"></a>975</td><td></td><td></td><td></td><td></td><td class="s">         if (exists $results-&gt;{point2roi}-&gt;{$off_point}-&gt;{$roi_name}) {</td></tr>
<tr><td class="h"><a name="976"></a>976</td><td></td><td></td><td></td><td></td><td class="s">            delete $results-&gt;{point2roi}-&gt;{$off_point}-&gt;{$roi_name} ; }</td></tr>
<tr><td class="h"><a name="977"></a>977</td><td></td><td></td><td></td><td></td><td class="s">         if (exists $a-&gt;{$off_point}) {</td></tr>
<tr><td class="h"><a name="978"></a>978</td><td></td><td></td><td></td><td></td><td class="s">            delete $a-&gt;{$off_point} ; }</td></tr>
<tr><td class="h"><a name="979"></a>979</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="980"></a>980</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="981"></a>981</td><td class="c3">1</td><td class="c0"><span title="Avg 149µs">149µs</span></td><td></td><td></td><td class="s">      $results-&gt;{num_roidef_points}-&gt;{$roi_name} = keys %{$a} ;</td></tr>
<tr><td class="h"><a name="982"></a>982</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="983"></a>983</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="984"></a>984</td><td class="c3">1</td><td class="c3"><span title="Avg 2µs">2µs</span></td><td></td><td></td><td class="s">   foreach my $roi_name (keys %{$roidef}) {</td></tr>
<tr><td class="h"><a name="985"></a>985</td><td class="c3">1</td><td class="c3"><span title="Avg 36µs">36µs</span></td><td class="c3">1</td><td class="c3">25µs</td><td class="s">      print STDERR &quot;  $roi_name: &quot;;<div class="calls"><div class="calls_out">      # spent    25µs making 1 call to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_print">alnmnr::io::CORE:print</a></div></div></td></tr>
<tr><td class="h"><a name="986"></a>986</td><td class="c3">1</td><td class="c3"><span title="Avg 2µs">2µs</span></td><td></td><td></td><td class="s">      if ($results-&gt;{num_roidef_points}-&gt;{$roi_name} &gt; 0) {</td></tr>
<tr><td class="h"><a name="987"></a>987</td><td class="c3">1</td><td class="c3"><span title="Avg 10µs">10µs</span></td><td class="c3">1</td><td class="c3">3µs</td><td class="s">         print STDERR $results-&gt;{num_roidef_points}-&gt;{$roi_name}.&quot; points\n&quot;;<div class="calls"><div class="calls_out">         # spent     3µs making 1 call to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_print">alnmnr::io::CORE:print</a></div></div></td></tr>
<tr><td class="h"><a name="988"></a>988</td><td class="c3">1</td><td class="c3"><span title="Avg 900ns">900ns</span></td><td></td><td></td><td class="s">         next;</td></tr>
<tr><td class="h"><a name="989"></a>989</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="990"></a>990</td><td></td><td></td><td></td><td></td><td class="s">      print STDERR &quot;ignored because no voxels are defined\n&quot;;</td></tr>
<tr><td class="h"><a name="991"></a>991</td><td></td><td></td><td></td><td></td><td class="s">      delete $results-&gt;{roi_meta}-&gt;{$roi_name} ;</td></tr>
<tr><td class="h"><a name="992"></a>992</td><td></td><td></td><td></td><td></td><td class="s">      delete $results-&gt;{num_roidef_points}-&gt;{$roi_name} ;</td></tr>
<tr><td class="h"><a name="993"></a>993</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="994"></a>994</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="995"></a>995</td><td class="c3">1</td><td class="c0"><span title="Avg 101ms">101ms</span></td><td></td><td></td><td class="s">   return $results;</td></tr>
<tr><td class="h"><a name="996"></a>996</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="997"></a>997</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="998"></a>998</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="999"></a>999</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1000"></a>1000</td><td></td><td></td><td></td><td></td><td class="s">sub PERLZLIB_aba_parse_xpz {</td></tr>
<tr><td class="h"><a name="1001"></a>1001</td><td></td><td></td><td></td><td></td><td class="s"># fpd111124_1821 - slower by ~5-6x than external unzip</td></tr>
<tr><td class="h"><a name="1002"></a>1002</td><td></td><td></td><td></td><td></td><td class="s">#   use IO::Uncompress::Unzip qw/unzip $UnzipError/ ;</td></tr>
<tr><td class="h"><a name="1003"></a>1003</td><td></td><td></td><td></td><td></td><td class="s">   require File::Basename ;</td></tr>
<tr><td class="h"><a name="1004"></a>1004</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1005"></a>1005</td><td></td><td></td><td></td><td></td><td class="s"># XPZ file are ZIP archives of:</td></tr>
<tr><td class="h"><a name="1006"></a>1006</td><td></td><td></td><td></td><td></td><td class="s"># 1. image_series.xml - contains meta info (ascii)</td></tr>
<tr><td class="h"><a name="1007"></a>1007</td><td></td><td></td><td></td><td></td><td class="s"># 2. intensity.mhd - header file describing intensity file format (ascii)</td></tr>
<tr><td class="h"><a name="1008"></a>1008</td><td></td><td></td><td></td><td></td><td class="s"># 3. intensity.raw - raw intensity data (binary format)</td></tr>
<tr><td class="h"><a name="1009"></a>1009</td><td></td><td></td><td></td><td></td><td class="s"># 4. density.mhd - header file describing density file format (ascii)</td></tr>
<tr><td class="h"><a name="1010"></a>1010</td><td></td><td></td><td></td><td></td><td class="s"># 5. density.raw - raw density data (binary format)</td></tr>
<tr><td class="h"><a name="1011"></a>1011</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1012"></a>1012</td><td></td><td></td><td></td><td></td><td class="s">   my $in = shift ;</td></tr>
<tr><td class="h"><a name="1013"></a>1013</td><td></td><td></td><td></td><td></td><td class="s">   my ($fn, $fh) ;</td></tr>
<tr><td class="h"><a name="1014"></a>1014</td><td></td><td></td><td></td><td></td><td class="s">   if (!exists $in-&gt;{fn}) {</td></tr>
<tr><td class="h"><a name="1015"></a>1015</td><td></td><td></td><td></td><td></td><td class="s">      die &quot;XPZ file not specified&quot; ; }</td></tr>
<tr><td class="h"><a name="1016"></a>1016</td><td></td><td></td><td></td><td></td><td class="s">   if (!-s $in-&gt;{fn})     {</td></tr>
<tr><td class="h"><a name="1017"></a>1017</td><td></td><td></td><td></td><td></td><td class="s">      print STDERR &quot;XPZ file $in-&gt;{fn} not found &quot; ;</td></tr>
<tr><td class="h"><a name="1018"></a>1018</td><td></td><td></td><td></td><td></td><td class="s">      return {error_fl =&gt; &quot;file not found &quot;} ;</td></tr>
<tr><td class="h"><a name="1019"></a>1019</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="1020"></a>1020</td><td></td><td></td><td></td><td></td><td class="s">   $fn-&gt;{xpz} = $in-&gt;{fn} ;</td></tr>
<tr><td class="h"><a name="1021"></a>1021</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1022"></a>1022</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1023"></a>1023</td><td></td><td></td><td></td><td></td><td class="s">   my $data = {};</td></tr>
<tr><td class="h"><a name="1024"></a>1024</td><td></td><td></td><td></td><td></td><td class="s">   $data-&gt;{meta}-&gt;{xpr_name} = File::Basename::basename($fn-&gt;{xpz}) ;</td></tr>
<tr><td class="h"><a name="1025"></a>1025</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1026"></a>1026</td><td></td><td></td><td></td><td></td><td class="s"># Check that the XPZ is complete</td></tr>
<tr><td class="h"><a name="1027"></a>1027</td><td></td><td></td><td></td><td></td><td class="s">   {</td></tr>
<tr><td class="h"><a name="1028"></a>1028</td><td></td><td></td><td></td><td></td><td class="s">      my $xpz_u = new IO::Uncompress::Unzip $fn-&gt;{xpz} || </td></tr>
<tr><td class="h"><a name="1029"></a>1029</td><td></td><td></td><td></td><td></td><td class="s">         return {error_fl =&gt; &quot;Fatal error: couldn't open &quot;.$fn-&gt;{xpz}} ;</td></tr>
<tr><td class="h"><a name="1030"></a>1030</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1031"></a>1031</td><td></td><td></td><td></td><td></td><td class="s">      my $expected_files = {} ;</td></tr>
<tr><td class="h"><a name="1032"></a>1032</td><td></td><td></td><td></td><td></td><td class="s">      map {$expected_files-&gt;{$_}++; } ('image_series.xml', 'intensity.mhd',</td></tr>
<tr><td class="h"><a name="1033"></a>1033</td><td></td><td></td><td></td><td></td><td class="s">                           'intensity.raw', 'density.mhd', 'density.raw') ;</td></tr>
<tr><td class="h"><a name="1034"></a>1034</td><td></td><td></td><td></td><td></td><td class="s">      for (my $status = 1; !$xpz_u-&gt;eof(); $status = $xpz_u-&gt;nextStream()) {</td></tr>
<tr><td class="h"><a name="1035"></a>1035</td><td></td><td></td><td></td><td></td><td class="s">         my $internal_fn = $xpz_u-&gt;getHeaderInfo()-&gt;{Name} ;</td></tr>
<tr><td class="h"><a name="1036"></a>1036</td><td></td><td></td><td></td><td></td><td class="s">         delete $expected_files-&gt;{$internal_fn} ;</td></tr>
<tr><td class="h"><a name="1037"></a>1037</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="1038"></a>1038</td><td></td><td></td><td></td><td></td><td class="s">      $xpz_u-&gt;close();</td></tr>
<tr><td class="h"><a name="1039"></a>1039</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1040"></a>1040</td><td></td><td></td><td></td><td></td><td class="s">      if (keys %{$expected_files} &gt; 0) {</td></tr>
<tr><td class="h"><a name="1041"></a>1041</td><td></td><td></td><td></td><td></td><td class="s">         return {error_fl =&gt;</td></tr>
<tr><td class="h"><a name="1042"></a>1042</td><td></td><td></td><td></td><td></td><td class="s">                 &quot;Fatal error: $fn-&gt;{xpz} XPZ file did not contain: &quot;.</td></tr>
<tr><td class="h"><a name="1043"></a>1043</td><td></td><td></td><td></td><td></td><td class="s">                 join(&quot;, &quot;, sort keys %{$expected_files})};</td></tr>
<tr><td class="h"><a name="1044"></a>1044</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="1045"></a>1045</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="1046"></a>1046</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1047"></a>1047</td><td></td><td></td><td></td><td></td><td class="s">   my $raw_data = {};</td></tr>
<tr><td class="h"><a name="1048"></a>1048</td><td></td><td></td><td></td><td></td><td class="s">   my $xpz_u = new IO::Uncompress::Unzip $fn-&gt;{xpz} ||</td></tr>
<tr><td class="h"><a name="1049"></a>1049</td><td></td><td></td><td></td><td></td><td class="s">      return {error_fl =&gt; &quot;Fatal error: couldn't open &quot;.$fn-&gt;{xpz}} ;</td></tr>
<tr><td class="h"><a name="1050"></a>1050</td><td></td><td></td><td></td><td></td><td class="s">   my $raw_read_size = {} ; my $raw_unpack_tmpl = {} ;</td></tr>
<tr><td class="h"><a name="1051"></a>1051</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1052"></a>1052</td><td></td><td></td><td></td><td></td><td class="s">   for (my $status = 1; !$xpz_u-&gt;eof(); $status = $xpz_u-&gt;nextStream()) {</td></tr>
<tr><td class="h"><a name="1053"></a>1053</td><td></td><td></td><td></td><td></td><td class="s">      my $internal_fn = $xpz_u-&gt;getHeaderInfo()-&gt;{Name} ;</td></tr>
<tr><td class="h"><a name="1054"></a>1054</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1055"></a>1055</td><td></td><td></td><td></td><td></td><td class="s">      if ($internal_fn eq 'image_series.xml') {</td></tr>
<tr><td class="h"><a name="1056"></a>1056</td><td></td><td></td><td></td><td></td><td class="s"># 1. Parse image-series meta info</td></tr>
<tr><td class="h"><a name="1057"></a>1057</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1058"></a>1058</td><td></td><td></td><td></td><td></td><td class="s"># &lt;section-thickness&gt; only in adult series...</td></tr>
<tr><td class="h"><a name="1059"></a>1059</td><td></td><td></td><td></td><td></td><td class="s">         while (! $xpz_u-&gt;eof()) {</td></tr>
<tr><td class="h"><a name="1060"></a>1060</td><td></td><td></td><td></td><td></td><td class="s">            my $line = $xpz_u-&gt;getline() ;</td></tr>
<tr><td class="h"><a name="1061"></a>1061</td><td></td><td></td><td></td><td></td><td class="s">            chomp $line;</td></tr>
<tr><td class="h"><a name="1062"></a>1062</td><td></td><td></td><td></td><td></td><td class="s">            if ($line =~ /^  &lt;id/) {</td></tr>
<tr><td class="h"><a name="1063"></a>1063</td><td></td><td></td><td></td><td></td><td class="s">               ($data-&gt;{meta}-&gt;{imageseries_id}) =</td></tr>
<tr><td class="h"><a name="1064"></a>1064</td><td></td><td></td><td></td><td></td><td class="s">                  ($line =~ /&lt;id&gt;([0-9]+)&lt;\/id&gt;/) ;</td></tr>
<tr><td class="h"><a name="1065"></a>1065</td><td></td><td></td><td></td><td></td><td class="s">            } elsif ($line =~ /&lt;plane-of-section&gt;/) {</td></tr>
<tr><td class="h"><a name="1066"></a>1066</td><td></td><td></td><td></td><td></td><td class="s">               ($data-&gt;{meta}-&gt;{plane}) =</td></tr>
<tr><td class="h"><a name="1067"></a>1067</td><td></td><td></td><td></td><td></td><td class="s">                  ($line =~ /&lt;plane-of-section&gt;(.+)&lt;\/plane-of-section&gt;/) ;</td></tr>
<tr><td class="h"><a name="1068"></a>1068</td><td></td><td></td><td></td><td></td><td class="s">            } elsif ($line =~ /&lt;section-thickness&gt;/) {</td></tr>
<tr><td class="h"><a name="1069"></a>1069</td><td></td><td></td><td></td><td></td><td class="s">               ($data-&gt;{meta}-&gt;{&quot;section-thickness&quot;}) =</td></tr>
<tr><td class="h"><a name="1070"></a>1070</td><td></td><td></td><td></td><td></td><td class="s">                  ($line =~ /&lt;section-thickness&gt;(.+)&lt;\/section-thickness&gt;/) ;</td></tr>
<tr><td class="h"><a name="1071"></a>1071</td><td></td><td></td><td></td><td></td><td class="s">            } elsif ($line =~ /&lt;age&gt;/) {</td></tr>
<tr><td class="h"><a name="1072"></a>1072</td><td></td><td></td><td></td><td></td><td class="s">               ($data-&gt;{meta}-&gt;{stage}) =</td></tr>
<tr><td class="h"><a name="1073"></a>1073</td><td></td><td></td><td></td><td></td><td class="s">                  ($line =~ /&lt;age&gt;(.+)&lt;\/age&gt;/) ;</td></tr>
<tr><td class="h"><a name="1074"></a>1074</td><td></td><td></td><td></td><td></td><td class="s">            } elsif ($line =~ /&lt;gene-symbol&gt;/) {</td></tr>
<tr><td class="h"><a name="1075"></a>1075</td><td></td><td></td><td></td><td></td><td class="s">               ($data-&gt;{meta}-&gt;{gene_name}) =</td></tr>
<tr><td class="h"><a name="1076"></a>1076</td><td></td><td></td><td></td><td></td><td class="s">                  ($line =~ /&lt;gene-symbol&gt;(.+)&lt;\/gene-symbol&gt;/) ;</td></tr>
<tr><td class="h"><a name="1077"></a>1077</td><td></td><td></td><td></td><td></td><td class="s">            } elsif ($line =~ /&lt;\/gene&gt;$/) {</td></tr>
<tr><td class="h"><a name="1078"></a>1078</td><td></td><td></td><td></td><td></td><td class="s">               last;</td></tr>
<tr><td class="h"><a name="1079"></a>1079</td><td></td><td></td><td></td><td></td><td class="s">            }</td></tr>
<tr><td class="h"><a name="1080"></a>1080</td><td></td><td></td><td></td><td></td><td class="s">         }</td></tr>
<tr><td class="h"><a name="1081"></a>1081</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1082"></a>1082</td><td></td><td></td><td></td><td></td><td class="s">      } elsif ($internal_fn =~ /mhd$/) {</td></tr>
<tr><td class="h"><a name="1083"></a>1083</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1084"></a>1084</td><td></td><td></td><td></td><td></td><td class="s">         my ($file_type) = ($internal_fn =~ /(.+)\.mhd$/) ;</td></tr>
<tr><td class="h"><a name="1085"></a>1085</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1086"></a>1086</td><td></td><td></td><td></td><td></td><td class="s">         while (! $xpz_u-&gt;eof()) {</td></tr>
<tr><td class="h"><a name="1087"></a>1087</td><td></td><td></td><td></td><td></td><td class="s">            my $line = $xpz_u-&gt;getline() ;</td></tr>
<tr><td class="h"><a name="1088"></a>1088</td><td></td><td></td><td></td><td></td><td class="s">            chomp $line;</td></tr>
<tr><td class="h"><a name="1089"></a>1089</td><td></td><td></td><td></td><td></td><td class="s">            my ($key, $val) = split(' = ', $line) ;</td></tr>
<tr><td class="h"><a name="1090"></a>1090</td><td></td><td></td><td></td><td></td><td class="s">            $data-&gt;{meta}-&gt;{$file_type}-&gt;{$key} = $val ;</td></tr>
<tr><td class="h"><a name="1091"></a>1091</td><td></td><td></td><td></td><td></td><td class="s">         }</td></tr>
<tr><td class="h"><a name="1092"></a>1092</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1093"></a>1093</td><td></td><td></td><td></td><td></td><td class="s">         ($data-&gt;{meta}-&gt;{dims_x},</td></tr>
<tr><td class="h"><a name="1094"></a>1094</td><td></td><td></td><td></td><td></td><td class="s">          $data-&gt;{meta}-&gt;{dims_y},</td></tr>
<tr><td class="h"><a name="1095"></a>1095</td><td></td><td></td><td></td><td></td><td class="s">          $data-&gt;{meta}-&gt;{dims_z}) = split(' ',</td></tr>
<tr><td class="h"><a name="1096"></a>1096</td><td></td><td></td><td></td><td></td><td class="s">            $data-&gt;{meta}-&gt;{$file_type}-&gt;{DimSize}) ;</td></tr>
<tr><td class="h"><a name="1097"></a>1097</td><td></td><td></td><td></td><td></td><td class="s">         my $element_type = $data-&gt;{meta}-&gt;{$file_type}-&gt;{ElementType} ;</td></tr>
<tr><td class="h"><a name="1098"></a>1098</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1099"></a>1099</td><td></td><td></td><td></td><td></td><td class="s">#MET_UCHAR = 1 byte; MET_USHORT = 2 byte</td></tr>
<tr><td class="h"><a name="1100"></a>1100</td><td></td><td></td><td></td><td></td><td class="s">         my ($read_size, $unpack_tmpl) ;</td></tr>
<tr><td class="h"><a name="1101"></a>1101</td><td></td><td></td><td></td><td></td><td class="s">         if ($element_type eq 'MET_UCHAR') {</td></tr>
<tr><td class="h"><a name="1102"></a>1102</td><td></td><td></td><td></td><td></td><td class="s">            $raw_read_size-&gt;{$file_type} = 1 ;</td></tr>
<tr><td class="h"><a name="1103"></a>1103</td><td></td><td></td><td></td><td></td><td class="s">            $raw_unpack_tmpl-&gt;{$file_type} = 'C8' ;</td></tr>
<tr><td class="h"><a name="1104"></a>1104</td><td></td><td></td><td></td><td></td><td class="s">         } elsif ($element_type eq 'MET_USHORT') {</td></tr>
<tr><td class="h"><a name="1105"></a>1105</td><td></td><td></td><td></td><td></td><td class="s">            $raw_read_size-&gt;{$file_type} = 2 ;</td></tr>
<tr><td class="h"><a name="1106"></a>1106</td><td></td><td></td><td></td><td></td><td class="s">            $raw_unpack_tmpl-&gt;{$file_type} = 'S' ;</td></tr>
<tr><td class="h"><a name="1107"></a>1107</td><td></td><td></td><td></td><td></td><td class="s">         } else {</td></tr>
<tr><td class="h"><a name="1108"></a>1108</td><td></td><td></td><td></td><td></td><td class="s">            return {error_fl =&gt; &quot;FATAL ERROR: $fn-&gt;{xpz}/$file_type.raw&quot;.</td></tr>
<tr><td class="h"><a name="1109"></a>1109</td><td></td><td></td><td></td><td></td><td class="s">                             &quot; ElementType $element_type not recognized\n&quot; };</td></tr>
<tr><td class="h"><a name="1110"></a>1110</td><td></td><td></td><td></td><td></td><td class="s">         }</td></tr>
<tr><td class="h"><a name="1111"></a>1111</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1112"></a>1112</td><td></td><td></td><td></td><td></td><td class="s">      } elsif ($internal_fn =~ /raw$/) {</td></tr>
<tr><td class="h"><a name="1113"></a>1113</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1114"></a>1114</td><td></td><td></td><td></td><td></td><td class="s">         my ($file_type) = ($internal_fn =~ /(.+)\.raw$/) ;</td></tr>
<tr><td class="h"><a name="1115"></a>1115</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1116"></a>1116</td><td></td><td></td><td></td><td></td><td class="s">         my $buffer ;</td></tr>
<tr><td class="h"><a name="1117"></a>1117</td><td></td><td></td><td></td><td></td><td class="s">         my ($cur_x, $cur_z, $cur_y) = (0,0,0) ;</td></tr>
<tr><td class="h"><a name="1118"></a>1118</td><td></td><td></td><td></td><td></td><td class="s">         while (!$xpz_u-&gt;eof()) {</td></tr>
<tr><td class="h"><a name="1119"></a>1119</td><td></td><td></td><td></td><td></td><td class="s">            read($xpz_u, $buffer, $raw_read_size-&gt;{$file_type}) ;</td></tr>
<tr><td class="h"><a name="1120"></a>1120</td><td></td><td></td><td></td><td></td><td class="s">            my $val = unpack($raw_unpack_tmpl-&gt;{$file_type}, $buffer) ;</td></tr>
<tr><td class="h"><a name="1121"></a>1121</td><td></td><td></td><td></td><td></td><td class="s">            push @{$raw_data-&gt;{$file_type}}, $val ;</td></tr>
<tr><td class="h"><a name="1122"></a>1122</td><td></td><td></td><td></td><td></td><td class="s">         }</td></tr>
<tr><td class="h"><a name="1123"></a>1123</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1124"></a>1124</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="1125"></a>1125</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="1126"></a>1126</td><td></td><td></td><td></td><td></td><td class="s">   $xpz_u-&gt;close();</td></tr>
<tr><td class="h"><a name="1127"></a>1127</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1128"></a>1128</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1129"></a>1129</td><td></td><td></td><td></td><td></td><td class="s"># 2. Parse intensity header file</td></tr>
<tr><td class="h"><a name="1130"></a>1130</td><td></td><td></td><td></td><td></td><td class="s">#-------------------------------</td></tr>
<tr><td class="h"><a name="1131"></a>1131</td><td></td><td></td><td></td><td></td><td class="s"># ObjectType = Image</td></tr>
<tr><td class="h"><a name="1132"></a>1132</td><td></td><td></td><td></td><td></td><td class="s"># NDims = 3</td></tr>
<tr><td class="h"><a name="1133"></a>1133</td><td></td><td></td><td></td><td></td><td class="s"># BinaryData = True</td></tr>
<tr><td class="h"><a name="1134"></a>1134</td><td></td><td></td><td></td><td></td><td class="s"># BinaryDataByteOrderMSB = False</td></tr>
<tr><td class="h"><a name="1135"></a>1135</td><td></td><td></td><td></td><td></td><td class="s"># CompressedData = False</td></tr>
<tr><td class="h"><a name="1136"></a>1136</td><td></td><td></td><td></td><td></td><td class="s"># TransformMatrix = 1 0 0 0 1 0 0 0 1</td></tr>
<tr><td class="h"><a name="1137"></a>1137</td><td></td><td></td><td></td><td></td><td class="s"># Offset = 0 0 -160</td></tr>
<tr><td class="h"><a name="1138"></a>1138</td><td></td><td></td><td></td><td></td><td class="s"># CenterOfRotation = 0 0 0</td></tr>
<tr><td class="h"><a name="1139"></a>1139</td><td></td><td></td><td></td><td></td><td class="s"># AnatomicalOrientation = RAI</td></tr>
<tr><td class="h"><a name="1140"></a>1140</td><td></td><td></td><td></td><td></td><td class="s"># ElementSpacing = 80 80 80</td></tr>
<tr><td class="h"><a name="1141"></a>1141</td><td></td><td></td><td></td><td></td><td class="s"># DimSize = 70 75 40</td></tr>
<tr><td class="h"><a name="1142"></a>1142</td><td></td><td></td><td></td><td></td><td class="s"># ElementType = MET_UCHAR</td></tr>
<tr><td class="h"><a name="1143"></a>1143</td><td></td><td></td><td></td><td></td><td class="s"># ElementDataFile = intensity.raw</td></tr>
<tr><td class="h"><a name="1144"></a>1144</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1145"></a>1145</td><td></td><td></td><td></td><td></td><td class="s">   my $energy = {};</td></tr>
<tr><td class="h"><a name="1146"></a>1146</td><td></td><td></td><td></td><td></td><td class="s">   my $xy_plane_size = $data-&gt;{meta}-&gt;{dims_x} * $data-&gt;{meta}-&gt;{dims_y} ;</td></tr>
<tr><td class="h"><a name="1147"></a>1147</td><td></td><td></td><td></td><td></td><td class="s">   $data-&gt;{xyz} = [] ;</td></tr>
<tr><td class="h"><a name="1148"></a>1148</td><td></td><td></td><td></td><td></td><td class="s">   foreach my $j ( 0 .. $#{$raw_data-&gt;{intensity}}) {</td></tr>
<tr><td class="h"><a name="1149"></a>1149</td><td></td><td></td><td></td><td></td><td class="s">      if ($raw_data-&gt;{density}-&gt;[$j] == 0 &amp;&amp;</td></tr>
<tr><td class="h"><a name="1150"></a>1150</td><td></td><td></td><td></td><td></td><td class="s">          $raw_data-&gt;{intensity}-&gt;[$j] == 0) {next;}</td></tr>
<tr><td class="h"><a name="1151"></a>1151</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1152"></a>1152</td><td></td><td></td><td></td><td></td><td class="s">      my $z = POSIX::floor($j / $xy_plane_size) ;</td></tr>
<tr><td class="h"><a name="1153"></a>1153</td><td></td><td></td><td></td><td></td><td class="s">      my $y = POSIX::floor(($j - $z * $xy_plane_size) /</td></tr>
<tr><td class="h"><a name="1154"></a>1154</td><td></td><td></td><td></td><td></td><td class="s">                              $data-&gt;{meta}-&gt;{dims_x}) ;</td></tr>
<tr><td class="h"><a name="1155"></a>1155</td><td></td><td></td><td></td><td></td><td class="s">      my $x = $j - $z * $xy_plane_size - $y * $data-&gt;{meta}-&gt;{dims_x} - 1 ;</td></tr>
<tr><td class="h"><a name="1156"></a>1156</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1157"></a>1157</td><td></td><td></td><td></td><td></td><td class="s">#fpd101109_1354 - if roidef specified, only store points within ROI</td></tr>
<tr><td class="h"><a name="1158"></a>1158</td><td></td><td></td><td></td><td></td><td class="s">      if (defined $in-&gt;{roidef} &amp;&amp;</td></tr>
<tr><td class="h"><a name="1159"></a>1159</td><td></td><td></td><td></td><td></td><td class="s">          !exists $in-&gt;{roidef}-&gt;{point2roi}-&gt;{$x.','.$y.','.$z}) {next;}</td></tr>
<tr><td class="h"><a name="1160"></a>1160</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1161"></a>1161</td><td></td><td></td><td></td><td></td><td class="s">      if (exists $in-&gt;{energy_fl} &amp;&amp;</td></tr>
<tr><td class="h"><a name="1162"></a>1162</td><td></td><td></td><td></td><td></td><td class="s">          $raw_data-&gt;{density}-&gt;[$j] &gt; 0 &amp;&amp;</td></tr>
<tr><td class="h"><a name="1163"></a>1163</td><td></td><td></td><td></td><td></td><td class="s">          $raw_data-&gt;{intensity}-&gt;[$j] &gt; 0) {</td></tr>
<tr><td class="h"><a name="1164"></a>1164</td><td></td><td></td><td></td><td></td><td class="s">         $energy-&gt;{$x.','.$y.','.$z} = $raw_data-&gt;{intensity}-&gt;[$j]  *</td></tr>
<tr><td class="h"><a name="1165"></a>1165</td><td></td><td></td><td></td><td></td><td class="s">                                          sqrt($raw_data-&gt;{density}-&gt;[$j]) ; }</td></tr>
<tr><td class="h"><a name="1166"></a>1166</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1167"></a>1167</td><td></td><td></td><td></td><td></td><td class="s">      push @{$data-&gt;{xyz}}, {</td></tr>
<tr><td class="h"><a name="1168"></a>1168</td><td></td><td></td><td></td><td></td><td class="s">         x =&gt; $x,</td></tr>
<tr><td class="h"><a name="1169"></a>1169</td><td></td><td></td><td></td><td></td><td class="s">         y =&gt; $y,</td></tr>
<tr><td class="h"><a name="1170"></a>1170</td><td></td><td></td><td></td><td></td><td class="s">         z =&gt; $z,</td></tr>
<tr><td class="h"><a name="1171"></a>1171</td><td></td><td></td><td></td><td></td><td class="s">         expression_level =&gt; $raw_data-&gt;{intensity}-&gt;[$j],</td></tr>
<tr><td class="h"><a name="1172"></a>1172</td><td></td><td></td><td></td><td></td><td class="s">         num_expressors =&gt; $raw_data-&gt;{density}-&gt;[$j],</td></tr>
<tr><td class="h"><a name="1173"></a>1173</td><td></td><td></td><td></td><td></td><td class="s">         grid_area =&gt; $raw_data-&gt;{density}-&gt;[$j],</td></tr>
<tr><td class="h"><a name="1174"></a>1174</td><td></td><td></td><td></td><td></td><td class="s">         cell_diameter =&gt; $raw_data-&gt;{intensity}-&gt;[$j],</td></tr>
<tr><td class="h"><a name="1175"></a>1175</td><td></td><td></td><td></td><td></td><td class="s">      } ;</td></tr>
<tr><td class="h"><a name="1176"></a>1176</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="1177"></a>1177</td><td></td><td></td><td></td><td></td><td class="s">   $raw_data = {} ;</td></tr>
<tr><td class="h"><a name="1178"></a>1178</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1179"></a>1179</td><td></td><td></td><td></td><td></td><td class="s">   if (exists $in-&gt;{out_xyz}) {</td></tr>
<tr><td class="h"><a name="1180"></a>1180</td><td></td><td></td><td></td><td></td><td class="s">      my $fh_xyz ;</td></tr>
<tr><td class="h"><a name="1181"></a>1181</td><td></td><td></td><td></td><td></td><td class="s">      open($fh_xyz, &quot;&gt; $in-&gt;{out_xyz}&quot; );</td></tr>
<tr><td class="h"><a name="1182"></a>1182</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1183"></a>1183</td><td></td><td></td><td></td><td></td><td class="s">      foreach my $metainfo (@{$data-&gt;{meta}-&gt;{gene}}) {</td></tr>
<tr><td class="h"><a name="1184"></a>1184</td><td></td><td></td><td></td><td></td><td class="s">         print {$fh_xyz} &quot;#meta\t$metainfo\n&quot; ;</td></tr>
<tr><td class="h"><a name="1185"></a>1185</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="1186"></a>1186</td><td></td><td></td><td></td><td></td><td class="s">      print {$fh_xyz} &quot;#imageseries_id\t&quot;.$data-&gt;{meta}-&gt;{imageseries_id}.&quot;\n&quot; ;</td></tr>
<tr><td class="h"><a name="1187"></a>1187</td><td></td><td></td><td></td><td></td><td class="s">      print {$fh_xyz} &quot;#gene\t&quot;.$data-&gt;{meta}-&gt;{gene_name}.&quot;\n&quot; ;</td></tr>
<tr><td class="h"><a name="1188"></a>1188</td><td></td><td></td><td></td><td></td><td class="s">      print {$fh_xyz} &quot;#stage\t&quot;.$data-&gt;{meta}-&gt;{stage}.&quot;\n&quot; ;</td></tr>
<tr><td class="h"><a name="1189"></a>1189</td><td></td><td></td><td></td><td></td><td class="s">      print {$fh_xyz} &quot;#plane\t&quot;.$data-&gt;{meta}-&gt;{plane}.&quot;\n&quot; ;</td></tr>
<tr><td class="h"><a name="1190"></a>1190</td><td></td><td></td><td></td><td></td><td class="s">      my @fields = qw/x y z intensity density/;</td></tr>
<tr><td class="h"><a name="1191"></a>1191</td><td></td><td></td><td></td><td></td><td class="s">      print {$fh_xyz} '#'.join(&quot;\t&quot;, @fields).&quot;\n&quot; ;</td></tr>
<tr><td class="h"><a name="1192"></a>1192</td><td></td><td></td><td></td><td></td><td class="s">      my $xy_plane_size = $data-&gt;{meta}-&gt;{dims_x} *</td></tr>
<tr><td class="h"><a name="1193"></a>1193</td><td></td><td></td><td></td><td></td><td class="s">                          $data-&gt;{meta}-&gt;{dims_y} ;</td></tr>
<tr><td class="h"><a name="1194"></a>1194</td><td></td><td></td><td></td><td></td><td class="s">      foreach my $point (@{$data-&gt;{xyz}}) {</td></tr>
<tr><td class="h"><a name="1195"></a>1195</td><td></td><td></td><td></td><td></td><td class="s">         print {$fh_xyz} join(&quot;\t&quot;, $point-&gt;{x},</td></tr>
<tr><td class="h"><a name="1196"></a>1196</td><td></td><td></td><td></td><td></td><td class="s">                                    $point-&gt;{y},</td></tr>
<tr><td class="h"><a name="1197"></a>1197</td><td></td><td></td><td></td><td></td><td class="s">                                    $point-&gt;{z},</td></tr>
<tr><td class="h"><a name="1198"></a>1198</td><td></td><td></td><td></td><td></td><td class="s">                                    $point-&gt;{expression_level},</td></tr>
<tr><td class="h"><a name="1199"></a>1199</td><td></td><td></td><td></td><td></td><td class="s">                                    $point-&gt;{num_expressors}).&quot;\n&quot;;</td></tr>
<tr><td class="h"><a name="1200"></a>1200</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="1201"></a>1201</td><td></td><td></td><td></td><td></td><td class="s">      close($fh_xyz) ;</td></tr>
<tr><td class="h"><a name="1202"></a>1202</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="1203"></a>1203</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1204"></a>1204</td><td></td><td></td><td></td><td></td><td class="s">   if (exists $in-&gt;{out_pdb}) {</td></tr>
<tr><td class="h"><a name="1205"></a>1205</td><td></td><td></td><td></td><td></td><td class="s">      my $out_pdb_fn = $in-&gt;{out_pdb} ;</td></tr>
<tr><td class="h"><a name="1206"></a>1206</td><td></td><td></td><td></td><td></td><td class="s">      my $compress_fl = 0 ;</td></tr>
<tr><td class="h"><a name="1207"></a>1207</td><td></td><td></td><td></td><td></td><td class="s">      if ($out_pdb_fn =~ /\.gz$/) {</td></tr>
<tr><td class="h"><a name="1208"></a>1208</td><td></td><td></td><td></td><td></td><td class="s">         $compress_fl = 1 ; $out_pdb_fn =~ s/\.gz// ;}</td></tr>
<tr><td class="h"><a name="1209"></a>1209</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1210"></a>1210</td><td></td><td></td><td></td><td></td><td class="s">      aba_displayxpr_pdbformat({</td></tr>
<tr><td class="h"><a name="1211"></a>1211</td><td></td><td></td><td></td><td></td><td class="s">         out_pdb =&gt; $out_pdb_fn,</td></tr>
<tr><td class="h"><a name="1212"></a>1212</td><td></td><td></td><td></td><td></td><td class="s">         data =&gt; $data,</td></tr>
<tr><td class="h"><a name="1213"></a>1213</td><td></td><td></td><td></td><td></td><td class="s">      }) ;</td></tr>
<tr><td class="h"><a name="1214"></a>1214</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1215"></a>1215</td><td></td><td></td><td></td><td></td><td class="s">      if ($compress_fl) {</td></tr>
<tr><td class="h"><a name="1216"></a>1216</td><td></td><td></td><td></td><td></td><td class="s">         system(&quot;gzip $out_pdb_fn&quot;) ; }</td></tr>
<tr><td class="h"><a name="1217"></a>1217</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="1218"></a>1218</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1219"></a>1219</td><td></td><td></td><td></td><td></td><td class="s">## Clean up temporary unzip directory</td></tr>
<tr><td class="h"><a name="1220"></a>1220</td><td></td><td></td><td></td><td></td><td class="s">#   foreach my $file (@expected_files) {</td></tr>
<tr><td class="h"><a name="1221"></a>1221</td><td></td><td></td><td></td><td></td><td class="s">#      unlink $unzip_dir.'/'.$file ; }</td></tr>
<tr><td class="h"><a name="1222"></a>1222</td><td></td><td></td><td></td><td></td><td class="s">#   unlink $unzip_dir.'/'.$data-&gt;{meta}-&gt;{xpr_name} ;</td></tr>
<tr><td class="h"><a name="1223"></a>1223</td><td></td><td></td><td></td><td></td><td class="s">#   chdir $pwd ;</td></tr>
<tr><td class="h"><a name="1224"></a>1224</td><td></td><td></td><td></td><td></td><td class="s">#   rmdir $unzip_dir ;</td></tr>
<tr><td class="h"><a name="1225"></a>1225</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1226"></a>1226</td><td></td><td></td><td></td><td></td><td class="s"># For exprsim_query runs: 111122_1811 - dont just return energy here...</td></tr>
<tr><td class="h"><a name="1227"></a>1227</td><td></td><td></td><td></td><td></td><td class="s">   if (exists $in-&gt;{energy_fl}) {</td></tr>
<tr><td class="h"><a name="1228"></a>1228</td><td></td><td></td><td></td><td></td><td class="s">      $data-&gt;{energy} = $energy; }</td></tr>
<tr><td class="h"><a name="1229"></a>1229</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1230"></a>1230</td><td></td><td></td><td></td><td></td><td class="s"># So the XPR routines can be easily adapted, level=intensity; expressors=density</td></tr>
<tr><td class="h"><a name="1231"></a>1231</td><td></td><td></td><td></td><td></td><td class="s"># fpd101206_1135 - actually, already took care of this above in the {xyz} set.</td></tr>
<tr><td class="h"><a name="1232"></a>1232</td><td></td><td></td><td></td><td></td><td class="s">#                  these two lines are most likely unnecessary, though harmless</td></tr>
<tr><td class="h"><a name="1233"></a>1233</td><td></td><td></td><td></td><td></td><td class="s">   $data-&gt;{expression_level} = $data-&gt;{intensity} ;</td></tr>
<tr><td class="h"><a name="1234"></a>1234</td><td></td><td></td><td></td><td></td><td class="s">   $data-&gt;{num_expressors}   = $data-&gt;{density} ;</td></tr>
<tr><td class="h"><a name="1235"></a>1235</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1236"></a>1236</td><td></td><td></td><td></td><td></td><td class="s">   return $data ;</td></tr>
<tr><td class="h"><a name="1237"></a>1237</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1238"></a>1238</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="1239"></a>1239</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1240"></a>1240</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1241"></a>1241</td><td></td><td></td><td></td><td></td><td class="s">sub display_roidef {</td></tr>
<tr><td class="h"><a name="1242"></a>1242</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1243"></a>1243</td><td></td><td></td><td></td><td></td><td class="s">   my $in = shift ;</td></tr>
<tr><td class="h"><a name="1244"></a>1244</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1245"></a>1245</td><td></td><td></td><td></td><td></td><td class="s">   my $specs ;</td></tr>
<tr><td class="h"><a name="1246"></a>1246</td><td></td><td></td><td></td><td></td><td class="s">   if (exists $in-&gt;{specs}) {</td></tr>
<tr><td class="h"><a name="1247"></a>1247</td><td></td><td></td><td></td><td></td><td class="s">      $specs = $in-&gt;{specs} ;</td></tr>
<tr><td class="h"><a name="1248"></a>1248</td><td></td><td></td><td></td><td></td><td class="s">   } else {</td></tr>
<tr><td class="h"><a name="1249"></a>1249</td><td></td><td></td><td></td><td></td><td class="s">      $specs = alnmnr::getspecs() ;</td></tr>
<tr><td class="h"><a name="1250"></a>1250</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="1251"></a>1251</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1252"></a>1252</td><td></td><td></td><td></td><td></td><td class="s"># mm = view-volume * $scaling</td></tr>
<tr><td class="h"><a name="1253"></a>1253</td><td></td><td></td><td></td><td></td><td class="s">   my $scaling = $specs-&gt;{view_volume}-&gt;{$in-&gt;{age}}-&gt;{spacing} / 1000;</td></tr>
<tr><td class="h"><a name="1254"></a>1254</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1255"></a>1255</td><td></td><td></td><td></td><td></td><td class="s">   my $out_fh ;</td></tr>
<tr><td class="h"><a name="1256"></a>1256</td><td></td><td></td><td></td><td></td><td class="s">   if (exists $in-&gt;{out_fn}) {</td></tr>
<tr><td class="h"><a name="1257"></a>1257</td><td></td><td></td><td></td><td></td><td class="s">      open($out_fh, &quot;&gt;$in-&gt;{out_fn}&quot;) ;</td></tr>
<tr><td class="h"><a name="1258"></a>1258</td><td></td><td></td><td></td><td></td><td class="s">   } else {</td></tr>
<tr><td class="h"><a name="1259"></a>1259</td><td></td><td></td><td></td><td></td><td class="s">      open($out_fh, &quot;&gt;-&quot;) ;</td></tr>
<tr><td class="h"><a name="1260"></a>1260</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="1261"></a>1261</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1262"></a>1262</td><td></td><td></td><td></td><td></td><td class="s">   foreach my $xyz (keys %{$in-&gt;{roidef}-&gt;{point2roi}}) {</td></tr>
<tr><td class="h"><a name="1263"></a>1263</td><td></td><td></td><td></td><td></td><td class="s">      my ($x, $y, $z) = split(',', $xyz) ;</td></tr>
<tr><td class="h"><a name="1264"></a>1264</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1265"></a>1265</td><td></td><td></td><td></td><td></td><td class="s"># Convert to mm coordinate system</td></tr>
<tr><td class="h"><a name="1266"></a>1266</td><td></td><td></td><td></td><td></td><td class="s">      my $x2 = sprintf(&quot;%.2f&quot;, $x * $scaling) ;</td></tr>
<tr><td class="h"><a name="1267"></a>1267</td><td></td><td></td><td></td><td></td><td class="s">      my $y2 = sprintf(&quot;%.2f&quot;, $y * $scaling) ;</td></tr>
<tr><td class="h"><a name="1268"></a>1268</td><td></td><td></td><td></td><td></td><td class="s">      my $z2 = sprintf(&quot;%.2f&quot;, $z * $scaling) ;</td></tr>
<tr><td class="h"><a name="1269"></a>1269</td><td></td><td></td><td></td><td></td><td class="s">      foreach my $roi (keys %{$in-&gt;{roidef}-&gt;{point2roi}-&gt;{$xyz}}) {</td></tr>
<tr><td class="h"><a name="1270"></a>1270</td><td></td><td></td><td></td><td></td><td class="s">         print {$out_fh} join(&quot;\t&quot;, $roi, &quot;&quot;, &quot;point&quot;, &quot;$x2,$y2,$z2&quot;).&quot;\n&quot; ; }</td></tr>
<tr><td class="h"><a name="1271"></a>1271</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="1272"></a>1272</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1273"></a>1273</td><td></td><td></td><td></td><td></td><td class="s">   close($out_fh) ;</td></tr>
<tr><td class="h"><a name="1274"></a>1274</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1275"></a>1275</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="1276"></a>1276</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1277"></a>1277</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1278"></a>1278</td><td></td><td></td><td></td><td></td><td class="s">sub display_roidef_pdb {</td></tr>
<tr><td class="h"><a name="1279"></a>1279</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1280"></a>1280</td><td></td><td></td><td></td><td></td><td class="s">   my $in = shift ;</td></tr>
<tr><td class="h"><a name="1281"></a>1281</td><td></td><td></td><td></td><td></td><td class="s">   my $out_fh ;</td></tr>
<tr><td class="h"><a name="1282"></a>1282</td><td></td><td></td><td></td><td></td><td class="s">   if (exists $in-&gt;{out_fn}) {</td></tr>
<tr><td class="h"><a name="1283"></a>1283</td><td></td><td></td><td></td><td></td><td class="s">      open($out_fh, &quot;&gt;$in-&gt;{out_fn}&quot;) ;</td></tr>
<tr><td class="h"><a name="1284"></a>1284</td><td></td><td></td><td></td><td></td><td class="s">   } else {</td></tr>
<tr><td class="h"><a name="1285"></a>1285</td><td></td><td></td><td></td><td></td><td class="s">      open($out_fh, &quot;&gt;-&quot;) ;</td></tr>
<tr><td class="h"><a name="1286"></a>1286</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="1287"></a>1287</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1288"></a>1288</td><td></td><td></td><td></td><td></td><td class="s">   my @chains = (1 .. 9);</td></tr>
<tr><td class="h"><a name="1289"></a>1289</td><td></td><td></td><td></td><td></td><td class="s">   push @chains, ('a' .. 'z'), ('A' .. 'Z');</td></tr>
<tr><td class="h"><a name="1290"></a>1290</td><td></td><td></td><td></td><td></td><td class="s">   push @chains, ('a' .. 'z'), ('A' .. 'Z');</td></tr>
<tr><td class="h"><a name="1291"></a>1291</td><td></td><td></td><td></td><td></td><td class="s">   push @chains, ('a' .. 'z'), ('A' .. 'Z');</td></tr>
<tr><td class="h"><a name="1292"></a>1292</td><td></td><td></td><td></td><td></td><td class="s">   my $atomno = 1; my $chainid = shift @chains ;</td></tr>
<tr><td class="h"><a name="1293"></a>1293</td><td></td><td></td><td></td><td></td><td class="s">   my $roi2num = {} ; my @roi_names ;</td></tr>
<tr><td class="h"><a name="1294"></a>1294</td><td></td><td></td><td></td><td></td><td class="s">   foreach my $xyz (keys %{$in-&gt;{roidef}-&gt;{point2roi}}) {</td></tr>
<tr><td class="h"><a name="1295"></a>1295</td><td></td><td></td><td></td><td></td><td class="s">      my $resno = floor($atomno / 10) ;</td></tr>
<tr><td class="h"><a name="1296"></a>1296</td><td></td><td></td><td></td><td></td><td class="s">      foreach my $roi (keys %{$in-&gt;{roidef}-&gt;{point2roi}-&gt;{$xyz}}) {</td></tr>
<tr><td class="h"><a name="1297"></a>1297</td><td></td><td></td><td></td><td></td><td class="s">         if (!exists $roi2num-&gt;{$roi}) {</td></tr>
<tr><td class="h"><a name="1298"></a>1298</td><td></td><td></td><td></td><td></td><td class="s">            push @roi_names, $roi ;</td></tr>
<tr><td class="h"><a name="1299"></a>1299</td><td></td><td></td><td></td><td></td><td class="s">            $roi2num-&gt;{$roi} = $#roi_names ;</td></tr>
<tr><td class="h"><a name="1300"></a>1300</td><td></td><td></td><td></td><td></td><td class="s">         }</td></tr>
<tr><td class="h"><a name="1301"></a>1301</td><td></td><td></td><td></td><td></td><td class="s">         my ($x, $y, $z) = split(/\,/, $xyz) ;</td></tr>
<tr><td class="h"><a name="1302"></a>1302</td><td></td><td></td><td></td><td></td><td class="s">         print {$out_fh} &quot;ATOM  &quot;.</td></tr>
<tr><td class="h"><a name="1303"></a>1303</td><td></td><td></td><td></td><td></td><td class="s">            sprintf(&quot;%5d&quot;, $atomno),</td></tr>
<tr><td class="h"><a name="1304"></a>1304</td><td></td><td></td><td></td><td></td><td class="s">            &quot; CA &quot;,</td></tr>
<tr><td class="h"><a name="1305"></a>1305</td><td></td><td></td><td></td><td></td><td class="s">            &quot; &quot;,</td></tr>
<tr><td class="h"><a name="1306"></a>1306</td><td></td><td></td><td></td><td></td><td class="s">            &quot;GLY&quot;,</td></tr>
<tr><td class="h"><a name="1307"></a>1307</td><td></td><td></td><td></td><td></td><td class="s">            ' ',</td></tr>
<tr><td class="h"><a name="1308"></a>1308</td><td></td><td></td><td></td><td></td><td class="s">            $chainid,</td></tr>
<tr><td class="h"><a name="1309"></a>1309</td><td></td><td></td><td></td><td></td><td class="s">            sprintf(&quot;%4d&quot;, $resno),</td></tr>
<tr><td class="h"><a name="1310"></a>1310</td><td></td><td></td><td></td><td></td><td class="s">            &quot; &quot;,</td></tr>
<tr><td class="h"><a name="1311"></a>1311</td><td></td><td></td><td></td><td></td><td class="s">            '   ',</td></tr>
<tr><td class="h"><a name="1312"></a>1312</td><td></td><td></td><td></td><td></td><td class="s">            sprintf(&quot;%8.3f&quot;,$x),</td></tr>
<tr><td class="h"><a name="1313"></a>1313</td><td></td><td></td><td></td><td></td><td class="s">            sprintf(&quot;%8.3f&quot;,$y),</td></tr>
<tr><td class="h"><a name="1314"></a>1314</td><td></td><td></td><td></td><td></td><td class="s">            sprintf(&quot;%8.3f&quot;,$z),</td></tr>
<tr><td class="h"><a name="1315"></a>1315</td><td></td><td></td><td></td><td></td><td class="s">            sprintf(&quot;%6.2f&quot;,$roi2num-&gt;{$roi}),</td></tr>
<tr><td class="h"><a name="1316"></a>1316</td><td></td><td></td><td></td><td></td><td class="s">            sprintf(&quot;%6.2f&quot;,$roi2num-&gt;{$roi}),</td></tr>
<tr><td class="h"><a name="1317"></a>1317</td><td></td><td></td><td></td><td></td><td class="s">            '           ',</td></tr>
<tr><td class="h"><a name="1318"></a>1318</td><td></td><td></td><td></td><td></td><td class="s">            'CA',</td></tr>
<tr><td class="h"><a name="1319"></a>1319</td><td></td><td></td><td></td><td></td><td class="s">            $roi2num-&gt;{$roi}.&quot;\n&quot; ;</td></tr>
<tr><td class="h"><a name="1320"></a>1320</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1321"></a>1321</td><td></td><td></td><td></td><td></td><td class="s">         if ($atomno &gt; 99999) {</td></tr>
<tr><td class="h"><a name="1322"></a>1322</td><td></td><td></td><td></td><td></td><td class="s">               $atomno = 1 ;</td></tr>
<tr><td class="h"><a name="1323"></a>1323</td><td></td><td></td><td></td><td></td><td class="s">               $chainid = shift @chains ;</td></tr>
<tr><td class="h"><a name="1324"></a>1324</td><td></td><td></td><td></td><td></td><td class="s">         }</td></tr>
<tr><td class="h"><a name="1325"></a>1325</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="1326"></a>1326</td><td></td><td></td><td></td><td></td><td class="s">      $atomno++ ;</td></tr>
<tr><td class="h"><a name="1327"></a>1327</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="1328"></a>1328</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1329"></a>1329</td><td></td><td></td><td></td><td></td><td class="s">   close($out_fh) ;</td></tr>
<tr><td class="h"><a name="1330"></a>1330</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1331"></a>1331</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="1332"></a>1332</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1333"></a>1333</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1334"></a>1334</td><td></td><td></td><td></td><td></td><td class="s">=head2 downsample_aba_Annotation()</td></tr>
<tr><td class="h"><a name="1335"></a>1335</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1336"></a>1336</td><td></td><td></td><td></td><td></td><td class="s">   Title:       load_aba_Annotation()</td></tr>
<tr><td class="h"><a name="1337"></a>1337</td><td></td><td></td><td></td><td></td><td class="s">   Function:    loads the ABA voxel - brain structure annotation mapping</td></tr>
<tr><td class="h"><a name="1338"></a>1338</td><td></td><td></td><td></td><td></td><td class="s">                 from the developing or adult reference atlases</td></tr>
<tr><td class="h"><a name="1339"></a>1339</td><td></td><td></td><td></td><td></td><td class="s">   Args:        $_-&gt;{fn} [optional - if not will call set_locations()]</td></tr>
<tr><td class="h"><a name="1340"></a>1340</td><td></td><td></td><td></td><td></td><td class="s">   Returns:     $_-&gt;{}-&gt;{point2strx}-&gt;{x,y,z} = brain_strx_id ;</td></tr>
<tr><td class="h"><a name="1341"></a>1341</td><td></td><td></td><td></td><td></td><td class="s">                $_-&gt;{}-&gt;{strx2points}-&gt;{brain_strx_id}-&gt;[i] = &quot;x_i,y_i,z_i&quot;</td></tr>
<tr><td class="h"><a name="1342"></a>1342</td><td></td><td></td><td></td><td></td><td class="s">   Files in:    AtlasAnnotation100.sva (adult) or Annotation (developing)</td></tr>
<tr><td class="h"><a name="1343"></a>1343</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1344"></a>1344</td><td></td><td></td><td></td><td></td><td class="s">=cut</td></tr>
<tr><td class="h"><a name="1345"></a>1345</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1346"></a>1346</td><td></td><td></td><td></td><td></td><td class="s">sub downsample_aba_Annotation {</td></tr>
<tr><td class="h"><a name="1347"></a>1347</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1348"></a>1348</td><td></td><td></td><td></td><td></td><td class="s">   my $in = shift ;</td></tr>
<tr><td class="h"><a name="1349"></a>1349</td><td></td><td></td><td></td><td></td><td class="s">   my $out_fn = $in-&gt;{out_fn};</td></tr>
<tr><td class="h"><a name="1350"></a>1350</td><td></td><td></td><td></td><td></td><td class="s">   my $specs ;</td></tr>
<tr><td class="h"><a name="1351"></a>1351</td><td></td><td></td><td></td><td></td><td class="s">   if (!exists $in-&gt;{specs}) {</td></tr>
<tr><td class="h"><a name="1352"></a>1352</td><td></td><td></td><td></td><td></td><td class="s">      $specs = alnmnr::getspecs() ;</td></tr>
<tr><td class="h"><a name="1353"></a>1353</td><td></td><td></td><td></td><td></td><td class="s">   } else {</td></tr>
<tr><td class="h"><a name="1354"></a>1354</td><td></td><td></td><td></td><td></td><td class="s">      $specs = $in-&gt;{specs} ;</td></tr>
<tr><td class="h"><a name="1355"></a>1355</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="1356"></a>1356</td><td></td><td></td><td></td><td></td><td class="s">   my $age = $in-&gt;{age} ;</td></tr>
<tr><td class="h"><a name="1357"></a>1357</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1358"></a>1358</td><td></td><td></td><td></td><td></td><td class="s">   my $data = {};</td></tr>
<tr><td class="h"><a name="1359"></a>1359</td><td></td><td></td><td></td><td></td><td class="s">      my $fn ;</td></tr>
<tr><td class="h"><a name="1360"></a>1360</td><td></td><td></td><td></td><td></td><td class="s">      if ($age eq 'P56') {</td></tr>
<tr><td class="h"><a name="1361"></a>1361</td><td></td><td></td><td></td><td></td><td class="s">         $fn = $specs-&gt;{allen_adult_atlas_dir}.&quot;/Spaces/P56/Annotation&quot; ;</td></tr>
<tr><td class="h"><a name="1362"></a>1362</td><td></td><td></td><td></td><td></td><td class="s">      } else {</td></tr>
<tr><td class="h"><a name="1363"></a>1363</td><td></td><td></td><td></td><td></td><td class="s">         $fn = $specs-&gt;{allen_devel_atlas_dir}.&quot;/Spaces/$age/Annotation&quot; ;</td></tr>
<tr><td class="h"><a name="1364"></a>1364</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="1365"></a>1365</td><td></td><td></td><td></td><td></td><td class="s">      if (!-s $fn) {</td></tr>
<tr><td class="h"><a name="1366"></a>1366</td><td></td><td></td><td></td><td></td><td class="s">         die &quot;Can't find Annotation file for $age, expecting: $fn&quot; ;}</td></tr>
<tr><td class="h"><a name="1367"></a>1367</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1368"></a>1368</td><td></td><td></td><td></td><td></td><td class="s">      my $xdim = $specs-&gt;{atlas_dims}-&gt;{$age}-&gt;{x} ;</td></tr>
<tr><td class="h"><a name="1369"></a>1369</td><td></td><td></td><td></td><td></td><td class="s">      my $ydim = $specs-&gt;{atlas_dims}-&gt;{$age}-&gt;{y} ;</td></tr>
<tr><td class="h"><a name="1370"></a>1370</td><td></td><td></td><td></td><td></td><td class="s">      my $zdim = $specs-&gt;{atlas_dims}-&gt;{$age}-&gt;{z} ;</td></tr>
<tr><td class="h"><a name="1371"></a>1371</td><td></td><td></td><td></td><td></td><td class="s">      my $xy_plane_size = $xdim * $ydim ;</td></tr>
<tr><td class="h"><a name="1372"></a>1372</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1373"></a>1373</td><td></td><td></td><td></td><td></td><td class="s">      my $downsample = 1 ;</td></tr>
<tr><td class="h"><a name="1374"></a>1374</td><td></td><td></td><td></td><td></td><td class="s">      if (exists $specs-&gt;{atlas_downsample}-&gt;{$age}) {</td></tr>
<tr><td class="h"><a name="1375"></a>1375</td><td></td><td></td><td></td><td></td><td class="s">         $downsample = $specs-&gt;{atlas_downsample}-&gt;{$age}-&gt;{from} /</td></tr>
<tr><td class="h"><a name="1376"></a>1376</td><td></td><td></td><td></td><td></td><td class="s">                       $specs-&gt;{atlas_downsample}-&gt;{$age}-&gt;{to} ; }</td></tr>
<tr><td class="h"><a name="1377"></a>1377</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1378"></a>1378</td><td></td><td></td><td></td><td></td><td class="s">      my $unpacktype = &quot;C&quot; ; #developing atlases have max 232 entries.</td></tr>
<tr><td class="h"><a name="1379"></a>1379</td><td></td><td></td><td></td><td></td><td class="s">      my $read_length = 1 ;</td></tr>
<tr><td class="h"><a name="1380"></a>1380</td><td></td><td></td><td></td><td></td><td class="s">      if ($age eq 'P56') { #adult atlas has more entries, max Id range to 10737</td></tr>
<tr><td class="h"><a name="1381"></a>1381</td><td></td><td></td><td></td><td></td><td class="s">         $unpacktype = &quot;S&quot;;</td></tr>
<tr><td class="h"><a name="1382"></a>1382</td><td></td><td></td><td></td><td></td><td class="s">         $read_length = 2 ;</td></tr>
<tr><td class="h"><a name="1383"></a>1383</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="1384"></a>1384</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1385"></a>1385</td><td></td><td></td><td></td><td></td><td class="s">      my $buffer ;</td></tr>
<tr><td class="h"><a name="1386"></a>1386</td><td></td><td></td><td></td><td></td><td class="s">      my $entry = 0 ;</td></tr>
<tr><td class="h"><a name="1387"></a>1387</td><td></td><td></td><td></td><td></td><td class="s">      open(ANNF, $fn);</td></tr>
<tr><td class="h"><a name="1388"></a>1388</td><td></td><td></td><td></td><td></td><td class="s">      while(read(ANNF, $buffer, $read_length)) {</td></tr>
<tr><td class="h"><a name="1389"></a>1389</td><td></td><td></td><td></td><td></td><td class="s">         $entry++ ;</td></tr>
<tr><td class="h"><a name="1390"></a>1390</td><td></td><td></td><td></td><td></td><td class="s">         my $point_num = $entry ;</td></tr>
<tr><td class="h"><a name="1391"></a>1391</td><td></td><td></td><td></td><td></td><td class="s">         my $z = POSIX::floor($point_num / $xy_plane_size) ;</td></tr>
<tr><td class="h"><a name="1392"></a>1392</td><td></td><td></td><td></td><td></td><td class="s">         my $y = POSIX::floor(($point_num - $z * $xy_plane_size) / $xdim) ;</td></tr>
<tr><td class="h"><a name="1393"></a>1393</td><td></td><td></td><td></td><td></td><td class="s">         my $x = $point_num - $z * $xy_plane_size - $y * $xdim - 1 ;</td></tr>
<tr><td class="h"><a name="1394"></a>1394</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1395"></a>1395</td><td></td><td></td><td></td><td></td><td class="s">         $x = POSIX::floor($downsample * $x) ;</td></tr>
<tr><td class="h"><a name="1396"></a>1396</td><td></td><td></td><td></td><td></td><td class="s">         $y = POSIX::floor($downsample * $y) ;</td></tr>
<tr><td class="h"><a name="1397"></a>1397</td><td></td><td></td><td></td><td></td><td class="s">         $z = POSIX::floor($downsample * $z) ;</td></tr>
<tr><td class="h"><a name="1398"></a>1398</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1399"></a>1399</td><td></td><td></td><td></td><td></td><td class="s">         my $strx = unpack($unpacktype, $buffer) ;</td></tr>
<tr><td class="h"><a name="1400"></a>1400</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1401"></a>1401</td><td></td><td></td><td></td><td></td><td class="s">         if ($strx == 0) {next;}</td></tr>
<tr><td class="h"><a name="1402"></a>1402</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1403"></a>1403</td><td></td><td></td><td></td><td></td><td class="s">         $data-&gt;{point2strx}-&gt;{&quot;$x,$y,$z&quot;} = $strx ;</td></tr>
<tr><td class="h"><a name="1404"></a>1404</td><td></td><td></td><td></td><td></td><td class="s">         $data-&gt;{strx2points}-&gt;{$strx}-&gt;{&quot;$x,$y,$z&quot;}++ ;</td></tr>
<tr><td class="h"><a name="1405"></a>1405</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="1406"></a>1406</td><td></td><td></td><td></td><td></td><td class="s">      close(ANNF) ;</td></tr>
<tr><td class="h"><a name="1407"></a>1407</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1408"></a>1408</td><td></td><td></td><td></td><td></td><td class="s"># NOTE 111122_2005 - danger now is if down-sampling results in a single new-coord-system point being associated with multiple sructures... though luckily {point2strx} doesn't seem to be used...</td></tr>
<tr><td class="h"><a name="1409"></a>1409</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1410"></a>1410</td><td></td><td></td><td></td><td></td><td class="s">   open(OUTF, &quot;&gt;&quot;.$out_fn) ;</td></tr>
<tr><td class="h"><a name="1411"></a>1411</td><td></td><td></td><td></td><td></td><td class="s">   foreach my $strx (keys %{$data-&gt;{strx2points}}) {</td></tr>
<tr><td class="h"><a name="1412"></a>1412</td><td></td><td></td><td></td><td></td><td class="s">      foreach my $point (keys %{$data-&gt;{strx2points}-&gt;{$strx}}) {</td></tr>
<tr><td class="h"><a name="1413"></a>1413</td><td></td><td></td><td></td><td></td><td class="s">         print OUTF $strx.&quot;\t&quot;.$point.&quot;\n&quot;; } }</td></tr>
<tr><td class="h"><a name="1414"></a>1414</td><td></td><td></td><td></td><td></td><td class="s">   close(OUTF) ;</td></tr>
<tr><td class="h"><a name="1415"></a>1415</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1416"></a>1416</td><td></td><td></td><td></td><td></td><td class="s">   return $data ;</td></tr>
<tr><td class="h"><a name="1417"></a>1417</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="1418"></a>1418</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1419"></a>1419</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1420"></a>1420</td><td></td><td></td><td></td><td></td><td class="s">=head2 load_aba_brainstructures()</td></tr>
<tr><td class="h"><a name="1421"></a>1421</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1422"></a>1422</td><td></td><td></td><td></td><td></td><td class="s">   Title:       load_aba_brainstructures()</td></tr>
<tr><td class="h"><a name="1423"></a>1423</td><td></td><td></td><td></td><td></td><td class="s">   Function:    loads the ABA Atlas's ontology2.csv file</td></tr>
<tr><td class="h"><a name="1424"></a>1424</td><td></td><td></td><td></td><td></td><td class="s">   Args:        $_-&gt;{fn} [optional - if not will call set_locations()]</td></tr>
<tr><td class="h"><a name="1425"></a>1425</td><td></td><td></td><td></td><td></td><td class="s">   Returns:     $_-&gt;{abbreviation2ID}-&gt;{abbreviation} = informaticsId ;</td></tr>
<tr><td class="h"><a name="1426"></a>1426</td><td></td><td></td><td></td><td></td><td class="s">                $_-&gt;{ID2info}-&gt;{informaticsId} = {</td></tr>
<tr><td class="h"><a name="1427"></a>1427</td><td></td><td></td><td></td><td></td><td class="s">                  StructureName =&gt;,</td></tr>
<tr><td class="h"><a name="1428"></a>1428</td><td></td><td></td><td></td><td></td><td class="s">                  Abbreviation =&gt;,</td></tr>
<tr><td class="h"><a name="1429"></a>1429</td><td></td><td></td><td></td><td></td><td class="s">                  ParentStruct =&gt;,</td></tr>
<tr><td class="h"><a name="1430"></a>1430</td><td></td><td></td><td></td><td></td><td class="s">                  red =&gt; ,</td></tr>
<tr><td class="h"><a name="1431"></a>1431</td><td></td><td></td><td></td><td></td><td class="s">                  green =&gt;,</td></tr>
<tr><td class="h"><a name="1432"></a>1432</td><td></td><td></td><td></td><td></td><td class="s">                  blue =&gt;,</td></tr>
<tr><td class="h"><a name="1433"></a>1433</td><td></td><td></td><td></td><td></td><td class="s">                  informaticsId =&gt;,</td></tr>
<tr><td class="h"><a name="1434"></a>1434</td><td></td><td></td><td></td><td></td><td class="s">                  StructureId =&gt;,</td></tr>
<tr><td class="h"><a name="1435"></a>1435</td><td></td><td></td><td></td><td></td><td class="s">                }</td></tr>
<tr><td class="h"><a name="1436"></a>1436</td><td></td><td></td><td></td><td></td><td class="s">   Files in:    ontology2.csv</td></tr>
<tr><td class="h"><a name="1437"></a>1437</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1438"></a>1438</td><td></td><td></td><td></td><td></td><td class="s">=cut</td></tr>
<tr><td class="h"><a name="1439"></a>1439</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1440"></a>1440</td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 26.4ms (21.1+5.35) within alnmnr::io::load_aba_brainstructures which was called:
#    once (21.1ms+5.35ms) by alnmnr::io::get_brainstrx_info at <a href="alnmnr-io-pm-49-line.html#1656">line 1656</a></div></div>sub load_aba_brainstructures {</td></tr>
<tr><td class="h"><a name="1441"></a>1441</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1442"></a>1442</td><td class="c3">1</td><td class="c3"><span title="Avg 400ns">400ns</span></td><td></td><td></td><td class="s">   my $in = shift ;</td></tr>
<tr><td class="h"><a name="1443"></a>1443</td><td class="c3">1</td><td class="c3"><span title="Avg 1µs">1µs</span></td><td></td><td></td><td class="s">   my $specs ;</td></tr>
<tr><td class="h"><a name="1444"></a>1444</td><td class="c3">1</td><td class="c3"><span title="Avg 12µs">12µs</span></td><td class="c3">1</td><td class="c3">174µs</td><td class="s">   if (!exists $in-&gt;{specs}) {<div class="calls"><div class="calls_out">   # spent   174µs making 1 call to <a href="alnmnr-pm-8-line.html#58">alnmnr::getspecs</a></div></div></td></tr>
<tr><td class="h"><a name="1445"></a>1445</td><td></td><td></td><td></td><td></td><td class="s">      $specs = alnmnr::getspecs() ;</td></tr>
<tr><td class="h"><a name="1446"></a>1446</td><td></td><td></td><td></td><td></td><td class="s">   } else {</td></tr>
<tr><td class="h"><a name="1447"></a>1447</td><td></td><td></td><td></td><td></td><td class="s">      $specs = $in-&gt;{specs} ;</td></tr>
<tr><td class="h"><a name="1448"></a>1448</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="1449"></a>1449</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1450"></a>1450</td><td class="c3">1</td><td class="c3"><span title="Avg 300ns">300ns</span></td><td></td><td></td><td class="s">   my $fn ;</td></tr>
<tr><td class="h"><a name="1451"></a>1451</td><td class="c3">1</td><td class="c3"><span title="Avg 600ns">600ns</span></td><td></td><td></td><td class="s">   if (exists $in-&gt;{fn}) {</td></tr>
<tr><td class="h"><a name="1452"></a>1452</td><td></td><td></td><td></td><td></td><td class="s">      $fn = $in-&gt;{fn} ;</td></tr>
<tr><td class="h"><a name="1453"></a>1453</td><td></td><td></td><td></td><td></td><td class="s">   } else {</td></tr>
<tr><td class="h"><a name="1454"></a>1454</td><td class="c3">1</td><td class="c3"><span title="Avg 3µs">3µs</span></td><td></td><td></td><td class="s">      if ($in-&gt;{age} eq 'P56') {</td></tr>
<tr><td class="h"><a name="1455"></a>1455</td><td></td><td></td><td></td><td></td><td class="s">         $fn = $specs-&gt;{allen_adult_atlas_dir}.'/ontology_v2.csv' ;</td></tr>
<tr><td class="h"><a name="1456"></a>1456</td><td></td><td></td><td></td><td></td><td class="s">      } else {</td></tr>
<tr><td class="h"><a name="1457"></a>1457</td><td></td><td></td><td></td><td></td><td class="s">         $fn = $specs-&gt;{allen_devel_atlas_dir}.'/ontology.csv' ;</td></tr>
<tr><td class="h"><a name="1458"></a>1458</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="1459"></a>1459</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="1460"></a>1460</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1461"></a>1461</td><td class="c3">1</td><td class="c0"><span title="Avg 404µs">404µs</span></td><td class="c3">1</td><td class="c3">393µs</td><td class="s">   if (!-s $fn) {<div class="calls"><div class="calls_out">   # spent   393µs making 1 call to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_ftsize">alnmnr::io::CORE:ftsize</a></div></div></td></tr>
<tr><td class="h"><a name="1462"></a>1462</td><td></td><td></td><td></td><td></td><td class="s">      die &quot;Can't find ontology2.csv, expecting: &quot;.$fn ; }</td></tr>
<tr><td class="h"><a name="1463"></a>1463</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1464"></a>1464</td><td class="c3">1</td><td class="c0"><span title="Avg 347µs">347µs</span></td><td class="c3">1</td><td class="c3">336µs</td><td class="s">   open(INF, $fn) ;<div class="calls"><div class="calls_out">   # spent   336µs making 1 call to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_open">alnmnr::io::CORE:open</a></div></div></td></tr>
<tr><td class="h"><a name="1465"></a>1465</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1466"></a>1466</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1467"></a>1467</td><td></td><td></td><td></td><td></td><td class="s"># ABA Atlas ontology_v2.csv from release May 14,2015:</td></tr>
<tr><td class="h"><a name="1468"></a>1468</td><td></td><td></td><td></td><td></td><td class="s">#  name,abbreviation,parent,mesh_name,red,green,blue,id,database_id,order,level</td></tr>
<tr><td class="h"><a name="1469"></a>1469</td><td></td><td></td><td></td><td></td><td class="s">#  &quot;Basic cell groups and regions&quot;,&quot;grey&quot;,,&quot;grey_8&quot;,191,218,227,1,8,0,99</td></tr>
<tr><td class="h"><a name="1470"></a>1470</td><td></td><td></td><td></td><td></td><td class="s">#  &quot;Cerebrum&quot;,&quot;CH&quot;,8,&quot;CH_567&quot;,176,240,255,2,567,2,99</td></tr>
<tr><td class="h"><a name="1471"></a>1471</td><td class="c3">1</td><td class="c3"><span title="Avg 1µs">1µs</span></td><td></td><td></td><td class="s">   my $data = {};</td></tr>
<tr><td class="h"><a name="1472"></a>1472</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1473"></a>1473</td><td class="c3">1</td><td class="c3"><span title="Avg 4µs">4µs</span></td><td></td><td></td><td class="s">   my @fields ;</td></tr>
<tr><td class="h"><a name="1474"></a>1474</td><td class="c3">1</td><td class="c3"><span title="Avg 4µs">4µs</span></td><td></td><td></td><td class="s">   if ($in-&gt;{age} eq 'P56') {</td></tr>
<tr><td class="h"><a name="1475"></a>1475</td><td class="c3">2</td><td class="c3"><span title="Avg 15µs">29µs</span></td><td class="c3">1</td><td class="c3">24µs</td><td class="s">      my $header_line = &lt;INF&gt;; chomp $header_line ;<div class="calls"><div class="calls_out">      # spent    24µs making 1 call to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_readline">alnmnr::io::CORE:readline</a></div></div></td></tr>
<tr><td class="h"><a name="1476"></a>1476</td><td class="c3">1</td><td class="c3"><span title="Avg 6µs">6µs</span></td><td></td><td></td><td class="s">      @fields = qw/StructureName Abbreviation ParentID MeshName</td></tr>
<tr><td class="h"><a name="1477"></a>1477</td><td></td><td></td><td></td><td></td><td class="s">                   red green blue unk1 informaticsId unk2 ontology_level/ ;</td></tr>
<tr><td class="h"><a name="1478"></a>1478</td><td></td><td></td><td></td><td></td><td class="s">   } else {</td></tr>
<tr><td class="h"><a name="1479"></a>1479</td><td></td><td></td><td></td><td></td><td class="s">#Development atlas ontology.csv didn't change with May 2015 update</td></tr>
<tr><td class="h"><a name="1480"></a>1480</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1481"></a>1481</td><td></td><td></td><td></td><td></td><td class="s"># ABA Atlas ontology.csv from development atlas release May 14,2015:</td></tr>
<tr><td class="h"><a name="1482"></a>1482</td><td></td><td></td><td></td><td></td><td class="s">#  &quot;Mus musculus&quot;,&quot;mouse&quot;,&quot;&quot;,200,106,57,1,15564,10,-1</td></tr>
<tr><td class="h"><a name="1483"></a>1483</td><td></td><td></td><td></td><td></td><td class="s">#  &quot;neural plate&quot;,&quot;NP&quot;,&quot;mouse&quot;,200,106,57,2,15565,0,0</td></tr>
<tr><td class="h"><a name="1484"></a>1484</td><td></td><td></td><td></td><td></td><td class="s">#  &quot;forebrain&quot;,&quot;F&quot;,&quot;NP&quot;,200,106,57,3,15566,0,1</td></tr>
<tr><td class="h"><a name="1485"></a>1485</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1486"></a>1486</td><td></td><td></td><td></td><td></td><td class="s">      @fields = qw/StructureName Abbreviation ParentStruct</td></tr>
<tr><td class="h"><a name="1487"></a>1487</td><td></td><td></td><td></td><td></td><td class="s">                   red green blue informaticsId unk1 unk2 ontology_level/ ;</td></tr>
<tr><td class="h"><a name="1488"></a>1488</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="1489"></a>1489</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1490"></a>1490</td><td class="c3">1</td><td class="c3"><span title="Avg 800ns">800ns</span></td><td></td><td></td><td class="s">   my $f2i = {};</td></tr>
<tr><td class="h"><a name="1491"></a>1491</td><td class="c3">1</td><td class="c3"><span title="Avg 22µs">22µs</span></td><td></td><td></td><td class="s">   foreach my $j ( 0 .. $#fields) {</td></tr>
<tr><td class="h"><a name="1492"></a>1492</td><td class="c3">11</td><td class="c3"><span title="Avg 873ns">10µs</span></td><td></td><td></td><td class="s">      $f2i-&gt;{$fields[$j]} = $j; }</td></tr>
<tr><td class="h"><a name="1493"></a>1493</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1494"></a>1494</td><td class="c3">1</td><td class="c0"><span title="Avg 3.58ms">3.58ms</span></td><td class="c0">865</td><td class="c0">1.43ms</td><td class="s">   while (my $line = &lt;INF&gt;) {<div class="calls"><div class="calls_out">   # spent  1.43ms making 865 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_readline">alnmnr::io::CORE:readline</a>, avg 2µs/call</div></div></td></tr>
<tr><td class="h"><a name="1495"></a>1495</td><td class="c0">864</td><td class="c0"><span title="Avg 281ns">243µs</span></td><td></td><td></td><td class="s">      chomp $line;</td></tr>
<tr><td class="h"><a name="1496"></a>1496</td><td class="c0">864</td><td class="c0"><span title="Avg 3µs">2.64ms</span></td><td class="c0">864</td><td class="c0">1.19ms</td><td class="s">      $line =~ s/\, /\; /g ;<div class="calls"><div class="calls_out">      # spent  1.19ms making 864 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_subst">alnmnr::io::CORE:subst</a>, avg 1µs/call</div></div></td></tr>
<tr><td class="h"><a name="1497"></a>1497</td><td class="c0">864</td><td class="c0"><span title="Avg 4µs">3.16ms</span></td><td class="c0">864</td><td class="c0">1.79ms</td><td class="s">      $line =~ s/&quot;//g ;<div class="calls"><div class="calls_out">      # spent  1.79ms making 864 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_subst">alnmnr::io::CORE:subst</a>, avg 2µs/call</div></div></td></tr>
<tr><td class="h"><a name="1498"></a>1498</td><td class="c0">864</td><td class="c0"><span title="Avg 2µs">1.78ms</span></td><td></td><td></td><td class="s">      my @t = split(/\,/, $line) ; </td></tr>
<tr><td class="h"><a name="1499"></a>1499</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1500"></a>1500</td><td></td><td></td><td></td><td></td><td class="s">      $data-&gt;{abbreviation2ID}-&gt;{$t[$f2i-&gt;{Abbreviation}]} =</td></tr>
<tr><td class="h"><a name="1501"></a>1501</td><td class="c0">864</td><td class="c0"><span title="Avg 1µs">1.16ms</span></td><td></td><td></td><td class="s">         $t[$f2i-&gt;{informaticsId}] ;</td></tr>
<tr><td class="h"><a name="1502"></a>1502</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1503"></a>1503</td><td class="c0">864</td><td class="c0"><span title="Avg 2µs">1.85ms</span></td><td></td><td></td><td class="s">      foreach my $f (keys %{$f2i}) {</td></tr>
<tr><td class="h"><a name="1504"></a>1504</td><td class="c0">9504</td><td class="c0"><span title="Avg 793ns">7.54ms</span></td><td></td><td></td><td class="s">         $data-&gt;{ID2info}-&gt;{$t[$f2i-&gt;{informaticsId}]}-&gt;{$f}= $t[$f2i-&gt;{$f}] ;}</td></tr>
<tr><td class="h"><a name="1505"></a>1505</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="1506"></a>1506</td><td class="c3">1</td><td class="c3"><span title="Avg 14µs">14µs</span></td><td class="c3">1</td><td class="c3">9µs</td><td class="s">   close(INF) ;<div class="calls"><div class="calls_out">   # spent     9µs making 1 call to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_close">alnmnr::io::CORE:close</a></div></div></td></tr>
<tr><td class="h"><a name="1507"></a>1507</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1508"></a>1508</td><td></td><td></td><td></td><td></td><td class="s"># If adult atlas, have to convert ParentID to ParentStruct</td></tr>
<tr><td class="h"><a name="1509"></a>1509</td><td class="c3">1</td><td class="c3"><span title="Avg 32µs">32µs</span></td><td></td><td></td><td class="s">   if ($in-&gt;{age} eq 'P56') {</td></tr>
<tr><td class="h"><a name="1510"></a>1510</td><td class="c3">1</td><td class="c0"><span title="Avg 118µs">118µs</span></td><td></td><td></td><td class="s">      foreach my $informaticsId (keys %{$data-&gt;{ID2info}}) {</td></tr>
<tr><td class="h"><a name="1511"></a>1511</td><td></td><td></td><td></td><td></td><td class="s">         my $parentStruct =</td></tr>
<tr><td class="h"><a name="1512"></a>1512</td><td class="c0">864</td><td class="c0"><span title="Avg 609ns">526µs</span></td><td></td><td></td><td class="s">$data-&gt;{ID2info}-&gt;{$data-&gt;{ID2info}-&gt;{$informaticsId}-&gt;{ParentID}}-&gt;{Abbreviation};</td></tr>
<tr><td class="h"><a name="1513"></a>1513</td><td class="c0">864</td><td class="c1"><span title="Avg 91ns">79µs</span></td><td></td><td></td><td class="s">         if (!defined $parentStruct) { $parentStruct = ''; }</td></tr>
<tr><td class="h"><a name="1514"></a>1514</td><td class="c0">864</td><td class="c0"><span title="Avg 565ns">488µs</span></td><td></td><td></td><td class="s">         $data-&gt;{ID2info}-&gt;{$informaticsId}-&gt;{ParentStruct} =  $parentStruct ;</td></tr>
<tr><td class="h"><a name="1515"></a>1515</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="1516"></a>1516</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="1517"></a>1517</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1518"></a>1518</td><td class="c3">1</td><td class="c3"><span title="Avg 1µs">1µs</span></td><td></td><td></td><td class="s">   $data-&gt;{tree} = {} ;</td></tr>
<tr><td class="h"><a name="1519"></a>1519</td><td class="c3">1</td><td class="c1"><span title="Avg 105µs">105µs</span></td><td></td><td></td><td class="s">   foreach my $node (keys %{$data-&gt;{ID2info}}) {</td></tr>
<tr><td class="h"><a name="1520"></a>1520</td><td class="c0">865</td><td class="c0"><span title="Avg 416ns">360µs</span></td><td></td><td></td><td class="s">      if (!exists $data-&gt;{ID2info}-&gt;{$node}-&gt;{ParentStruct} ||</td></tr>
<tr><td class="h"><a name="1521"></a>1521</td><td class="c3">2</td><td class="c3"><span title="Avg 2µs">4µs</span></td><td></td><td></td><td class="s">          $data-&gt;{ID2info}-&gt;{$node}-&gt;{ParentStruct} eq '') {next;}</td></tr>
<tr><td class="h"><a name="1522"></a>1522</td><td class="c0">863</td><td class="c0"><span title="Avg 237ns">204µs</span></td><td></td><td></td><td class="s">      my $parent_name = $data-&gt;{ID2info}-&gt;{$node}-&gt;{ParentStruct} ;</td></tr>
<tr><td class="h"><a name="1523"></a>1523</td><td class="c0">863</td><td class="c0"><span title="Avg 290ns">250µs</span></td><td></td><td></td><td class="s">      my $parent_id = $data-&gt;{abbreviation2ID}-&gt;{$parent_name} ;</td></tr>
<tr><td class="h"><a name="1524"></a>1524</td><td class="c0">863</td><td class="c0"><span title="Avg 571ns">493µs</span></td><td></td><td></td><td class="s">      $data-&gt;{tree}-&gt;{kids}-&gt;{$parent_id}-&gt;{$node}++ ;</td></tr>
<tr><td class="h"><a name="1525"></a>1525</td><td class="c0">863</td><td class="c0"><span title="Avg 870ns">751µs</span></td><td></td><td></td><td class="s">      $data-&gt;{tree}-&gt;{parent}-&gt;{$node}-&gt;{$parent_id}++ ;</td></tr>
<tr><td class="h"><a name="1526"></a>1526</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="1527"></a>1527</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1528"></a>1528</td><td class="c3">1</td><td class="c3"><span title="Avg 30µs">30µs</span></td><td></td><td></td><td class="s">   return $data ;</td></tr>
<tr><td class="h"><a name="1529"></a>1529</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1530"></a>1530</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="1531"></a>1531</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1532"></a>1532</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1533"></a>1533</td><td></td><td></td><td></td><td></td><td class="s">=head2 get_brainstrx_voxels()</td></tr>
<tr><td class="h"><a name="1534"></a>1534</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1535"></a>1535</td><td></td><td></td><td></td><td></td><td class="s">   Title:       get_brainstrx_voxels()</td></tr>
<tr><td class="h"><a name="1536"></a>1536</td><td></td><td></td><td></td><td></td><td class="s">   Function:    Returns list of voxels assigned to a specific ABA brain region</td></tr>
<tr><td class="h"><a name="1537"></a>1537</td><td></td><td></td><td></td><td></td><td class="s">   Args:        $_-&gt;{brainstrx}  either the informatics_ID or abbreviation for a</td></tr>
<tr><td class="h"><a name="1538"></a>1538</td><td></td><td></td><td></td><td></td><td class="s">                  region in the ABA reference atlas</td></tr>
<tr><td class="h"><a name="1539"></a>1539</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1540"></a>1540</td><td></td><td></td><td></td><td></td><td class="s">                $_-{onpoints_only} if set to 1, only returns on points,</td></tr>
<tr><td class="h"><a name="1541"></a>1541</td><td></td><td></td><td></td><td></td><td class="s">                                    otherwise, by default returns off points</td></tr>
<tr><td class="h"><a name="1542"></a>1542</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1543"></a>1543</td><td></td><td></td><td></td><td></td><td class="s">   Returns:     $_-&gt;{x,y,z} = 1  if point (x,y,z) is in the specified ROI</td></tr>
<tr><td class="h"><a name="1544"></a>1544</td><td></td><td></td><td></td><td></td><td class="s">                              -1 if point is specified OFF in the ROI</td></tr>
<tr><td class="h"><a name="1545"></a>1545</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1546"></a>1546</td><td></td><td></td><td></td><td></td><td class="s">=cut</td></tr>
<tr><td class="h"><a name="1547"></a>1547</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1548"></a>1548</td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 35.8ms (7.78+28.0) within alnmnr::io::get_brainstrx_voxels which was called:
#    once (7.78ms+28.0ms) by alnmnr::io::readin_roi_file at <a href="alnmnr-io-pm-49-line.html#954">line 954</a></div></div>sub get_brainstrx_voxels {</td></tr>
<tr><td class="h"><a name="1549"></a>1549</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1550"></a>1550</td><td class="c3">1</td><td class="c3"><span title="Avg 2µs">2µs</span></td><td></td><td></td><td class="s">   my $in = shift ;</td></tr>
<tr><td class="h"><a name="1551"></a>1551</td><td class="c3">1</td><td class="c3"><span title="Avg 2µs">2µs</span></td><td></td><td></td><td class="s">   my $brainstrx = $in-&gt;{brainstrx} ;</td></tr>
<tr><td class="h"><a name="1552"></a>1552</td><td class="c3">1</td><td class="c3"><span title="Avg 1µs">1µs</span></td><td></td><td></td><td class="s">   my $age = $in-&gt;{age} ;</td></tr>
<tr><td class="h"><a name="1553"></a>1553</td><td class="c3">1</td><td class="c3"><span title="Avg 500ns">500ns</span></td><td></td><td></td><td class="s">   my $specs = $in-&gt;{specs} ;</td></tr>
<tr><td class="h"><a name="1554"></a>1554</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1555"></a>1555</td><td class="c3">1</td><td class="c3"><span title="Avg 1µs">1µs</span></td><td></td><td></td><td class="s">   my $strx2status ;</td></tr>
<tr><td class="h"><a name="1556"></a>1556</td><td class="c3">1</td><td class="c3"><span title="Avg 17µs">17µs</span></td><td class="c3">3</td><td class="c3">9µs</td><td class="s">   if ($brainstrx =~ /\,/ || $brainstrx =~ /\=on/ || $brainstrx =~ /\=off/) {<div class="calls"><div class="calls_out">   # spent     9µs making 3 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_match">alnmnr::io::CORE:match</a>, avg 3µs/call</div></div></td></tr>
<tr><td class="h"><a name="1557"></a>1557</td><td></td><td></td><td></td><td></td><td class="s">      my @parts = split(/\,/, $brainstrx) ;</td></tr>
<tr><td class="h"><a name="1558"></a>1558</td><td></td><td></td><td></td><td></td><td class="s">      foreach my $j ( 0.. $#parts) {</td></tr>
<tr><td class="h"><a name="1559"></a>1559</td><td></td><td></td><td></td><td></td><td class="s">         my ($strx, $status) = ($parts[$j] =~ /(.+)=(.+)/) ;</td></tr>
<tr><td class="h"><a name="1560"></a>1560</td><td></td><td></td><td></td><td></td><td class="s">         $strx2status-&gt;{$strx} = $status ;</td></tr>
<tr><td class="h"><a name="1561"></a>1561</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="1562"></a>1562</td><td></td><td></td><td></td><td></td><td class="s">   } else {</td></tr>
<tr><td class="h"><a name="1563"></a>1563</td><td class="c3">1</td><td class="c3"><span title="Avg 2µs">2µs</span></td><td></td><td></td><td class="s">      $strx2status-&gt;{$brainstrx} = 'on' ;</td></tr>
<tr><td class="h"><a name="1564"></a>1564</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="1565"></a>1565</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1566"></a>1566</td><td class="c3">1</td><td class="c3"><span title="Avg 2µs">2µs</span></td><td></td><td></td><td class="s">   my $atlas_annotations = {};</td></tr>
<tr><td class="h"><a name="1567"></a>1567</td><td class="c3">1</td><td class="c3"><span title="Avg 2µs">2µs</span></td><td></td><td></td><td class="s">   if (!exists $specs-&gt;{parsed_annotation}) {</td></tr>
<tr><td class="h"><a name="1568"></a>1568</td><td></td><td></td><td></td><td></td><td class="s">      $atlas_annotations = load_aba_Annotation({age =&gt; $age}) ;</td></tr>
<tr><td class="h"><a name="1569"></a>1569</td><td></td><td></td><td></td><td></td><td class="s">   } else {</td></tr>
<tr><td class="h"><a name="1570"></a>1570</td><td class="c3">1</td><td class="c3"><span title="Avg 700ns">700ns</span></td><td></td><td></td><td class="s">      $atlas_annotations = $specs-&gt;{parsed_annotation} ;</td></tr>
<tr><td class="h"><a name="1571"></a>1571</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="1572"></a>1572</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1573"></a>1573</td><td class="c3">1</td><td class="c3"><span title="Avg 1µs">1µs</span></td><td></td><td></td><td class="s">   my $strx2points ;</td></tr>
<tr><td class="h"><a name="1574"></a>1574</td><td class="c3">1</td><td class="c3"><span title="Avg 8µs">8µs</span></td><td></td><td></td><td class="s">   foreach my $brainstrx (keys %{$strx2status}) {</td></tr>
<tr><td class="h"><a name="1575"></a>1575</td><td class="c3">1</td><td class="c3"><span title="Avg 6µs">6µs</span></td><td class="c3">1</td><td class="c0">28.0ms</td><td class="s">      my $brainstrx_info = get_brainstrx_info({brainstrx =&gt; $brainstrx,<div class="calls"><div class="calls_out">      # spent  28.0ms making 1 call to <a href="alnmnr-io-pm-49-line.html#1653">alnmnr::io::get_brainstrx_info</a></div></div></td></tr>
<tr><td class="h"><a name="1576"></a>1576</td><td></td><td></td><td></td><td></td><td class="s">                                               age =&gt; $age });</td></tr>
<tr><td class="h"><a name="1577"></a>1577</td><td class="c3">1</td><td class="c3"><span title="Avg 2µs">2µs</span></td><td></td><td></td><td class="s">      my $brainstrx_id = $brainstrx_info-&gt;{brainstrx_id} ;</td></tr>
<tr><td class="h"><a name="1578"></a>1578</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1579"></a>1579</td><td class="c3">1</td><td class="c3"><span title="Avg 200ns">200ns</span></td><td></td><td></td><td class="s">      my $brainstrx_points ;</td></tr>
<tr><td class="h"><a name="1580"></a>1580</td><td></td><td></td><td></td><td></td><td class="s">      push @{$brainstrx_points},</td></tr>
<tr><td class="h"><a name="1581"></a>1581</td><td class="c3">1</td><td class="c3"><span title="Avg 3µs">3µs</span></td><td></td><td></td><td class="s">         keys %{$atlas_annotations-&gt;{strx2points}-&gt;{$brainstrx_id}} ;</td></tr>
<tr><td class="h"><a name="1582"></a>1582</td><td class="c3">1</td><td class="c3"><span title="Avg 2µs">2µs</span></td><td></td><td></td><td class="s">      foreach my $node (@{$brainstrx_info-&gt;{kids}}) {</td></tr>
<tr><td class="h"><a name="1583"></a>1583</td><td></td><td></td><td></td><td></td><td class="s">         push @{$brainstrx_points},</td></tr>
<tr><td class="h"><a name="1584"></a>1584</td><td class="c0">58</td><td class="c0"><span title="Avg 15µs">879µs</span></td><td></td><td></td><td class="s">            keys %{$atlas_annotations-&gt;{strx2points}-&gt;{$node}};}</td></tr>
<tr><td class="h"><a name="1585"></a>1585</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1586"></a>1586</td><td class="c3">1</td><td class="c3"><span title="Avg 6µs">6µs</span></td><td></td><td></td><td class="s">      $strx2points-&gt;{$brainstrx} = $brainstrx_points ;</td></tr>
<tr><td class="h"><a name="1587"></a>1587</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="1588"></a>1588</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1589"></a>1589</td><td class="c3">1</td><td class="c3"><span title="Avg 2µs">2µs</span></td><td></td><td></td><td class="s">   my $point_light ;</td></tr>
<tr><td class="h"><a name="1590"></a>1590</td><td class="c3">1</td><td class="c3"><span title="Avg 2µs">2µs</span></td><td></td><td></td><td class="s">   foreach my $brainstrx (keys %{$strx2status}) {</td></tr>
<tr><td class="h"><a name="1591"></a>1591</td><td class="c3">1</td><td class="c3"><span title="Avg 1µs">1µs</span></td><td></td><td></td><td class="s">      foreach my $point (@{$strx2points-&gt;{$brainstrx}}) {</td></tr>
<tr><td class="h"><a name="1592"></a>1592</td><td class="c0">2706</td><td class="c0"><span title="Avg 567ns">1.53ms</span></td><td></td><td></td><td class="s">         if (!exists $point_light-&gt;{$point}) {</td></tr>
<tr><td class="h"><a name="1593"></a>1593</td><td></td><td></td><td></td><td></td><td class="s">            if ($strx2status-&gt;{$brainstrx} eq 'on') {</td></tr>
<tr><td class="h"><a name="1594"></a>1594</td><td></td><td></td><td></td><td></td><td class="s">               $point_light-&gt;{$point} = 1 ;</td></tr>
<tr><td class="h"><a name="1595"></a>1595</td><td></td><td></td><td></td><td></td><td class="s">            } else {</td></tr>
<tr><td class="h"><a name="1596"></a>1596</td><td></td><td></td><td></td><td></td><td class="s">               $point_light-&gt;{$point} = 0 ;</td></tr>
<tr><td class="h"><a name="1597"></a>1597</td><td></td><td></td><td></td><td></td><td class="s">            }</td></tr>
<tr><td class="h"><a name="1598"></a>1598</td><td></td><td></td><td></td><td></td><td class="s">         } else {</td></tr>
<tr><td class="h"><a name="1599"></a>1599</td><td></td><td></td><td></td><td></td><td class="s">            if ($strx2status-&gt;{$brainstrx} eq 'off') {</td></tr>
<tr><td class="h"><a name="1600"></a>1600</td><td></td><td></td><td></td><td></td><td class="s">               $point_light-&gt;{$point} = 0 ;</td></tr>
<tr><td class="h"><a name="1601"></a>1601</td><td></td><td></td><td></td><td></td><td class="s">            }</td></tr>
<tr><td class="h"><a name="1602"></a>1602</td><td></td><td></td><td></td><td></td><td class="s">         }</td></tr>
<tr><td class="h"><a name="1603"></a>1603</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="1604"></a>1604</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="1605"></a>1605</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1606"></a>1606</td><td></td><td></td><td></td><td></td><td class="s"># NOTE: If developing atlas, have to convert between Annotation (tissue-volume)</td></tr>
<tr><td class="h"><a name="1607"></a>1607</td><td></td><td></td><td></td><td></td><td class="s">#       and XPZ (view-volume) coordinate systems</td></tr>
<tr><td class="h"><a name="1608"></a>1608</td><td class="c3">1</td><td class="c3"><span title="Avg 1µs">1µs</span></td><td></td><td></td><td class="s">   my $conversion_factor = 1 ;</td></tr>
<tr><td class="h"><a name="1609"></a>1609</td><td class="c3">1</td><td class="c3"><span title="Avg 800ns">800ns</span></td><td></td><td></td><td class="s">   if ($age ne 'P56') {</td></tr>
<tr><td class="h"><a name="1610"></a>1610</td><td></td><td></td><td></td><td></td><td class="s">      $conversion_factor = $specs-&gt;{dims}-&gt;{$age}-&gt;{spacing} /</td></tr>
<tr><td class="h"><a name="1611"></a>1611</td><td></td><td></td><td></td><td></td><td class="s">                           $specs-&gt;{view_volume}-&gt;{$age}-&gt;{spacing} ;</td></tr>
<tr><td class="h"><a name="1612"></a>1612</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="1613"></a>1613</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1614"></a>1614</td><td class="c3">1</td><td class="c3"><span title="Avg 1µs">1µs</span></td><td></td><td></td><td class="s">   my $results ;</td></tr>
<tr><td class="h"><a name="1615"></a>1615</td><td class="c3">1</td><td class="c0"><span title="Avg 362µs">362µs</span></td><td></td><td></td><td class="s">   foreach my $point (keys %{$point_light}) {</td></tr>
<tr><td class="h"><a name="1616"></a>1616</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1617"></a>1617</td><td class="c0">2706</td><td class="c0"><span title="Avg 783ns">2.12ms</span></td><td></td><td></td><td class="s">      my ($x, $y, $z) = split(',', $point) ;</td></tr>
<tr><td class="h"><a name="1618"></a>1618</td><td class="c0">2706</td><td class="c0"><span title="Avg 125ns">337µs</span></td><td></td><td></td><td class="s">      my $newpoint = $point ;</td></tr>
<tr><td class="h"><a name="1619"></a>1619</td><td class="c0">2706</td><td class="c0"><span title="Avg 112ns">304µs</span></td><td></td><td></td><td class="s">      if ($age ne 'P56') {</td></tr>
<tr><td class="h"><a name="1620"></a>1620</td><td></td><td></td><td></td><td></td><td class="s">         $x = POSIX::floor($x * $conversion_factor) ;</td></tr>
<tr><td class="h"><a name="1621"></a>1621</td><td></td><td></td><td></td><td></td><td class="s">         $y = POSIX::floor($y * $conversion_factor) ;</td></tr>
<tr><td class="h"><a name="1622"></a>1622</td><td></td><td></td><td></td><td></td><td class="s">         $z = POSIX::floor($z * $conversion_factor) ;</td></tr>
<tr><td class="h"><a name="1623"></a>1623</td><td></td><td></td><td></td><td></td><td class="s">         $newpoint = $x.','.$y.','.$z ;</td></tr>
<tr><td class="h"><a name="1624"></a>1624</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="1625"></a>1625</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1626"></a>1626</td><td class="c0">2706</td><td class="c0"><span title="Avg 581ns">1.57ms</span></td><td></td><td></td><td class="s">      if ($point_light-&gt;{$point} == 1) {</td></tr>
<tr><td class="h"><a name="1627"></a>1627</td><td></td><td></td><td></td><td></td><td class="s">         $results-&gt;{$newpoint}++ ;</td></tr>
<tr><td class="h"><a name="1628"></a>1628</td><td></td><td></td><td></td><td></td><td class="s">      } else {</td></tr>
<tr><td class="h"><a name="1629"></a>1629</td><td></td><td></td><td></td><td></td><td class="s">         if (!exists $in-&gt;{onpoints_only} ||</td></tr>
<tr><td class="h"><a name="1630"></a>1630</td><td></td><td></td><td></td><td></td><td class="s">             $in-&gt;{onpoints_only} == 0) {</td></tr>
<tr><td class="h"><a name="1631"></a>1631</td><td></td><td></td><td></td><td></td><td class="s">            $results-&gt;{$newpoint} = -1 ;</td></tr>
<tr><td class="h"><a name="1632"></a>1632</td><td></td><td></td><td></td><td></td><td class="s">         }</td></tr>
<tr><td class="h"><a name="1633"></a>1633</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="1634"></a>1634</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="1635"></a>1635</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1636"></a>1636</td><td class="c3">1</td><td class="c0"><span title="Avg 207µs">207µs</span></td><td></td><td></td><td class="s">   return $results ;</td></tr>
<tr><td class="h"><a name="1637"></a>1637</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="1638"></a>1638</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1639"></a>1639</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1640"></a>1640</td><td></td><td></td><td></td><td></td><td class="s">=head2 get_brainstrx_info()</td></tr>
<tr><td class="h"><a name="1641"></a>1641</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1642"></a>1642</td><td></td><td></td><td></td><td></td><td class="s">   Title:       get_brainstrx_info()</td></tr>
<tr><td class="h"><a name="1643"></a>1643</td><td></td><td></td><td></td><td></td><td class="s">   Function:    loads annotation for voxel - brain structure mapping</td></tr>
<tr><td class="h"><a name="1644"></a>1644</td><td></td><td></td><td></td><td></td><td class="s">   Args:        $_-&gt;{brainstrx}  either the informatics_ID or abbreviation for a</td></tr>
<tr><td class="h"><a name="1645"></a>1645</td><td></td><td></td><td></td><td></td><td class="s">                  region in the ABA reference atlas</td></tr>
<tr><td class="h"><a name="1646"></a>1646</td><td></td><td></td><td></td><td></td><td class="s">   Returns:     $_-&gt;{brainstrx_id} - ABA informatics ID of the brain region</td></tr>
<tr><td class="h"><a name="1647"></a>1647</td><td></td><td></td><td></td><td></td><td class="s">                $_-&gt;{kids} = [kid1, kid2,...] - arrayref of ABA informatics IDs</td></tr>
<tr><td class="h"><a name="1648"></a>1648</td><td></td><td></td><td></td><td></td><td class="s">                   for structures that are children of the specified brainstrx</td></tr>
<tr><td class="h"><a name="1649"></a>1649</td><td></td><td></td><td></td><td></td><td class="s">   Files in:    AtlasAnnotation100.sva</td></tr>
<tr><td class="h"><a name="1650"></a>1650</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1651"></a>1651</td><td></td><td></td><td></td><td></td><td class="s">=cut</td></tr>
<tr><td class="h"><a name="1652"></a>1652</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1653"></a>1653</td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 28.0ms (1.18+26.8) within alnmnr::io::get_brainstrx_info which was called:
#    once (1.18ms+26.8ms) by alnmnr::io::get_brainstrx_voxels at <a href="alnmnr-io-pm-49-line.html#1575">line 1575</a></div></div>sub get_brainstrx_info {</td></tr>
<tr><td class="h"><a name="1654"></a>1654</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1655"></a>1655</td><td class="c3">1</td><td class="c3"><span title="Avg 500ns">500ns</span></td><td></td><td></td><td class="s">   my $in = shift ;</td></tr>
<tr><td class="h"><a name="1656"></a>1656</td><td class="c3">1</td><td class="c3"><span title="Avg 8µs">8µs</span></td><td class="c3">1</td><td class="c0">26.4ms</td><td class="s">   my $brainstrx = load_aba_brainstructures({age =&gt; $in-&gt;{age}}) ;<div class="calls"><div class="calls_out">   # spent  26.4ms making 1 call to <a href="alnmnr-io-pm-49-line.html#1440">alnmnr::io::load_aba_brainstructures</a></div></div></td></tr>
<tr><td class="h"><a name="1657"></a>1657</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1658"></a>1658</td><td class="c3">1</td><td class="c3"><span title="Avg 1µs">1µs</span></td><td></td><td></td><td class="s">   my $brainstrx_id ;</td></tr>
<tr><td class="h"><a name="1659"></a>1659</td><td class="c3">1</td><td class="c3"><span title="Avg 19µs">19µs</span></td><td class="c3">1</td><td class="c3">13µs</td><td class="s">   if ($in-&gt;{brainstrx} =~ /[A-Za-z]/) {<div class="calls"><div class="calls_out">   # spent    13µs making 1 call to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_match">alnmnr::io::CORE:match</a></div></div></td></tr>
<tr><td class="h"><a name="1660"></a>1660</td><td></td><td></td><td></td><td></td><td class="s">      $brainstrx_id = $brainstrx-&gt;{abbreviation2ID}-&gt;{$in-&gt;{brainstrx}} ;</td></tr>
<tr><td class="h"><a name="1661"></a>1661</td><td></td><td></td><td></td><td></td><td class="s">   } else {</td></tr>
<tr><td class="h"><a name="1662"></a>1662</td><td></td><td></td><td></td><td></td><td class="s">      $brainstrx_id = $in-&gt;{brainstrx} ;</td></tr>
<tr><td class="h"><a name="1663"></a>1663</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="1664"></a>1664</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1665"></a>1665</td><td></td><td></td><td></td><td></td><td class="s">#fpd101107_1612  - not used.</td></tr>
<tr><td class="h"><a name="1666"></a>1666</td><td></td><td></td><td></td><td></td><td class="s">#   my $atlas_annotations = load_aba_AtlasAnnotation100() ;</td></tr>
<tr><td class="h"><a name="1667"></a>1667</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1668"></a>1668</td><td class="c3">1</td><td class="c3"><span title="Avg 300ns">300ns</span></td><td></td><td></td><td class="s">   my $brainstrx_points ;</td></tr>
<tr><td class="h"><a name="1669"></a>1669</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1670"></a>1670</td><td></td><td></td><td></td><td></td><td class="s">   my @kids = get_kids({ # also need to get points from kids.</td></tr>
<tr><td class="h"><a name="1671"></a>1671</td><td></td><td></td><td></td><td></td><td class="s">      node =&gt; $brainstrx_id,</td></tr>
<tr><td class="h"><a name="1672"></a>1672</td><td></td><td></td><td></td><td></td><td class="s">      tree =&gt; $brainstrx-&gt;{tree}</td></tr>
<tr><td class="h"><a name="1673"></a>1673</td><td class="c3">1</td><td class="c3"><span title="Avg 13µs">13µs</span></td><td class="c3">1</td><td class="c3">386µs</td><td class="s">   }) ;<div class="calls"><div class="calls_out">   # spent   386µs making 1 call to <a href="alnmnr-io-pm-49-line.html#1769">alnmnr::io::get_kids</a></div></div></td></tr>
<tr><td class="h"><a name="1674"></a>1674</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1675"></a>1675</td><td></td><td></td><td></td><td></td><td class="s">   return  {</td></tr>
<tr><td class="h"><a name="1676"></a>1676</td><td class="c3">1</td><td class="c0"><span title="Avg 1.55ms">1.55ms</span></td><td></td><td></td><td class="s">      brainstrx_id =&gt; $brainstrx_id,</td></tr>
<tr><td class="h"><a name="1677"></a>1677</td><td></td><td></td><td></td><td></td><td class="s">      kids =&gt; \@kids</td></tr>
<tr><td class="h"><a name="1678"></a>1678</td><td></td><td></td><td></td><td></td><td class="s">   } ;</td></tr>
<tr><td class="h"><a name="1679"></a>1679</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1680"></a>1680</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="1681"></a>1681</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1682"></a>1682</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1683"></a>1683</td><td></td><td></td><td></td><td></td><td class="s">=head2 load_aba_Annotation()</td></tr>
<tr><td class="h"><a name="1684"></a>1684</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1685"></a>1685</td><td></td><td></td><td></td><td></td><td class="s">   Title:       load_aba_Annotation()</td></tr>
<tr><td class="h"><a name="1686"></a>1686</td><td></td><td></td><td></td><td></td><td class="s">   Function:    loads the ABA voxel - brain structure annotation mapping</td></tr>
<tr><td class="h"><a name="1687"></a>1687</td><td></td><td></td><td></td><td></td><td class="s">                 from the developing or adult reference atlases</td></tr>
<tr><td class="h"><a name="1688"></a>1688</td><td></td><td></td><td></td><td></td><td class="s">   Args:        $_-&gt;{fn} [optional - if not will call set_locations()]</td></tr>
<tr><td class="h"><a name="1689"></a>1689</td><td></td><td></td><td></td><td></td><td class="s">   Returns:     $_-&gt;{}-&gt;{point2strx}-&gt;{x,y,z} = brain_strx_id ;</td></tr>
<tr><td class="h"><a name="1690"></a>1690</td><td></td><td></td><td></td><td></td><td class="s">                $_-&gt;{}-&gt;{strx2points}-&gt;{brain_strx_id}-&gt;[i] = &quot;x_i,y_i,z_i&quot;</td></tr>
<tr><td class="h"><a name="1691"></a>1691</td><td></td><td></td><td></td><td></td><td class="s">   Files in:    AtlasAnnotation100.sva (adult) or Annotation (developing)</td></tr>
<tr><td class="h"><a name="1692"></a>1692</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1693"></a>1693</td><td></td><td></td><td></td><td></td><td class="s">=cut</td></tr>
<tr><td class="h"><a name="1694"></a>1694</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1695"></a>1695</td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 1.62s (1.54+79.6ms) within alnmnr::io::load_aba_Annotation which was called:
#    once (1.54s+79.6ms) by alnmnr::io::readin_roi_file at <a href="alnmnr-io-pm-49-line.html#948">line 948</a></div></div>sub load_aba_Annotation {</td></tr>
<tr><td class="h"><a name="1696"></a>1696</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1697"></a>1697</td><td class="c3">1</td><td class="c3"><span title="Avg 600ns">600ns</span></td><td></td><td></td><td class="s">   my $in = shift ;</td></tr>
<tr><td class="h"><a name="1698"></a>1698</td><td class="c3">1</td><td class="c3"><span title="Avg 200ns">200ns</span></td><td></td><td></td><td class="s">   my $specs ;</td></tr>
<tr><td class="h"><a name="1699"></a>1699</td><td class="c3">1</td><td class="c3"><span title="Avg 2µs">2µs</span></td><td class="c3">1</td><td class="c3">105µs</td><td class="s">   if (!exists $in-&gt;{specs}) {<div class="calls"><div class="calls_out">   # spent   105µs making 1 call to <a href="alnmnr-pm-8-line.html#58">alnmnr::getspecs</a></div></div></td></tr>
<tr><td class="h"><a name="1700"></a>1700</td><td></td><td></td><td></td><td></td><td class="s">      $specs = alnmnr::getspecs() ;</td></tr>
<tr><td class="h"><a name="1701"></a>1701</td><td></td><td></td><td></td><td></td><td class="s">   } else {</td></tr>
<tr><td class="h"><a name="1702"></a>1702</td><td></td><td></td><td></td><td></td><td class="s">      $specs = $in-&gt;{specs} ;</td></tr>
<tr><td class="h"><a name="1703"></a>1703</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="1704"></a>1704</td><td class="c3">1</td><td class="c3"><span title="Avg 500ns">500ns</span></td><td></td><td></td><td class="s">   my $age = $in-&gt;{age} ;</td></tr>
<tr><td class="h"><a name="1705"></a>1705</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1706"></a>1706</td><td class="c3">1</td><td class="c3"><span title="Avg 300ns">300ns</span></td><td></td><td></td><td class="s">   my $data = {};</td></tr>
<tr><td class="h"><a name="1707"></a>1707</td><td class="c3">1</td><td class="c3"><span title="Avg 100ns">100ns</span></td><td></td><td></td><td class="s">   my $fn ;</td></tr>
<tr><td class="h"><a name="1708"></a>1708</td><td class="c3">1</td><td class="c3"><span title="Avg 1µs">1µs</span></td><td></td><td></td><td class="s">   if ($age eq 'P56') {</td></tr>
<tr><td class="h"><a name="1709"></a>1709</td><td></td><td></td><td></td><td></td><td class="s">      $fn = $specs-&gt;{allen_adult_atlas_dir}.&quot;/Spaces/P56/Annotation&quot; ;</td></tr>
<tr><td class="h"><a name="1710"></a>1710</td><td></td><td></td><td></td><td></td><td class="s">   } else {</td></tr>
<tr><td class="h"><a name="1711"></a>1711</td><td></td><td></td><td></td><td></td><td class="s">      $fn = $specs-&gt;{allen_devel_atlas_dir}.&quot;/Spaces/$age/Annotation&quot; ;</td></tr>
<tr><td class="h"><a name="1712"></a>1712</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="1713"></a>1713</td><td class="c3">1</td><td class="c0"><span title="Avg 1.72ms">1.72ms</span></td><td class="c3">1</td><td class="c0">1.71ms</td><td class="s">   if (!-s $fn) {<div class="calls"><div class="calls_out">   # spent  1.71ms making 1 call to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_ftsize">alnmnr::io::CORE:ftsize</a></div></div></td></tr>
<tr><td class="h"><a name="1714"></a>1714</td><td></td><td></td><td></td><td></td><td class="s">      die &quot;Can't find Annotation file for $age, expecting: $fn&quot; ;}</td></tr>
<tr><td class="h"><a name="1715"></a>1715</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1716"></a>1716</td><td class="c3">1</td><td class="c3"><span title="Avg 2µs">2µs</span></td><td></td><td></td><td class="s">   if (exists $specs-&gt;{atlas_downsample}-&gt;{$age}) {</td></tr>
<tr><td class="h"><a name="1717"></a>1717</td><td class="c3">1</td><td class="c3"><span title="Avg 2µs">2µs</span></td><td></td><td></td><td class="s">      my $downsample_fn = $fn.'.allenminer2-downsample.txt';</td></tr>
<tr><td class="h"><a name="1718"></a>1718</td><td class="c3">1</td><td class="c0"><span title="Avg 298µs">298µs</span></td><td class="c3">1</td><td class="c3">288µs</td><td class="s">      if (!-s $downsample_fn) {<div class="calls"><div class="calls_out">      # spent   288µs making 1 call to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_ftsize">alnmnr::io::CORE:ftsize</a></div></div></td></tr>
<tr><td class="h"><a name="1719"></a>1719</td><td></td><td></td><td></td><td></td><td class="s">         print STDERR &quot;Note: Must downsample atlas Annotation file, &quot;.</td></tr>
<tr><td class="h"><a name="1720"></a>1720</td><td></td><td></td><td></td><td></td><td class="s">                      &quot; one-time ~10min process: &quot;;</td></tr>
<tr><td class="h"><a name="1721"></a>1721</td><td></td><td></td><td></td><td></td><td class="s">         downsample_aba_Annotation({</td></tr>
<tr><td class="h"><a name="1722"></a>1722</td><td></td><td></td><td></td><td></td><td class="s">            age         =&gt; $age,</td></tr>
<tr><td class="h"><a name="1723"></a>1723</td><td></td><td></td><td></td><td></td><td class="s">            specs       =&gt; $specs,</td></tr>
<tr><td class="h"><a name="1724"></a>1724</td><td></td><td></td><td></td><td></td><td class="s">            orig_fn     =&gt; $fn,</td></tr>
<tr><td class="h"><a name="1725"></a>1725</td><td></td><td></td><td></td><td></td><td class="s">            out_fn      =&gt; $downsample_fn,</td></tr>
<tr><td class="h"><a name="1726"></a>1726</td><td></td><td></td><td></td><td></td><td class="s">         }) ;</td></tr>
<tr><td class="h"><a name="1727"></a>1727</td><td></td><td></td><td></td><td></td><td class="s">         print STDERR &quot; Done\n&quot;;</td></tr>
<tr><td class="h"><a name="1728"></a>1728</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="1729"></a>1729</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1730"></a>1730</td><td class="c3">1</td><td class="c0"><span title="Avg 313µs">313µs</span></td><td class="c3">1</td><td class="c3">303µs</td><td class="s">      open(DOWNSAMPLEF, $downsample_fn) ;<div class="calls"><div class="calls_out">      # spent   303µs making 1 call to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_open">alnmnr::io::CORE:open</a></div></div></td></tr>
<tr><td class="h"><a name="1731"></a>1731</td><td class="c3">1</td><td class="c0"><span title="Avg 877ms">877ms</span></td><td class="c0">262961</td><td class="c0">77.2ms</td><td class="s">      while (my $line = &lt;DOWNSAMPLEF&gt;) {<div class="calls"><div class="calls_out">      # spent  77.2ms making 262961 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_readline">alnmnr::io::CORE:readline</a>, avg 294ns/call</div></div></td></tr>
<tr><td class="h"><a name="1732"></a>1732</td><td class="c0">262960</td><td class="c0"><span title="Avg 210ns">55.2ms</span></td><td></td><td></td><td class="s">         chomp $line;</td></tr>
<tr><td class="h"><a name="1733"></a>1733</td><td class="c0">262960</td><td class="c0"><span title="Avg 957ns">252ms</span></td><td></td><td></td><td class="s">         my ($strx, $point) = split(/\t/, $line);</td></tr>
<tr><td class="h"><a name="1734"></a>1734</td><td class="c0">262960</td><td class="c0"><span title="Avg 1µs">283ms</span></td><td></td><td></td><td class="s">         $data-&gt;{point2strx}-&gt;{$point}-&gt;{$strx}++ ;</td></tr>
<tr><td class="h"><a name="1735"></a>1735</td><td class="c0">262960</td><td class="c0"><span title="Avg 575ns">151ms</span></td><td></td><td></td><td class="s">         $data-&gt;{strx2points}-&gt;{$strx}-&gt;{$point}++ ;</td></tr>
<tr><td class="h"><a name="1736"></a>1736</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="1737"></a>1737</td><td class="c3">1</td><td class="c3"><span title="Avg 33µs">33µs</span></td><td class="c3">1</td><td class="c3">21µs</td><td class="s">      close(DOWNSAMPLEF) ;<div class="calls"><div class="calls_out">      # spent    21µs making 1 call to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_close">alnmnr::io::CORE:close</a></div></div></td></tr>
<tr><td class="h"><a name="1738"></a>1738</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1739"></a>1739</td><td></td><td></td><td></td><td></td><td class="s">   } else {</td></tr>
<tr><td class="h"><a name="1740"></a>1740</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1741"></a>1741</td><td></td><td></td><td></td><td></td><td class="s">      my $xdim = $specs-&gt;{dims}-&gt;{$age}-&gt;{x} ;</td></tr>
<tr><td class="h"><a name="1742"></a>1742</td><td></td><td></td><td></td><td></td><td class="s">      my $ydim = $specs-&gt;{dims}-&gt;{$age}-&gt;{y} ;</td></tr>
<tr><td class="h"><a name="1743"></a>1743</td><td></td><td></td><td></td><td></td><td class="s">      my $zdim = $specs-&gt;{dims}-&gt;{$age}-&gt;{z} ;</td></tr>
<tr><td class="h"><a name="1744"></a>1744</td><td></td><td></td><td></td><td></td><td class="s">      my $xy_plane_size = $xdim * $ydim ;</td></tr>
<tr><td class="h"><a name="1745"></a>1745</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1746"></a>1746</td><td></td><td></td><td></td><td></td><td class="s">      my $buffer ;</td></tr>
<tr><td class="h"><a name="1747"></a>1747</td><td></td><td></td><td></td><td></td><td class="s">      my $entry = 0 ;</td></tr>
<tr><td class="h"><a name="1748"></a>1748</td><td></td><td></td><td></td><td></td><td class="s">      open(ANNF, $fn);</td></tr>
<tr><td class="h"><a name="1749"></a>1749</td><td></td><td></td><td></td><td></td><td class="s">      while(read(ANNF, $buffer, 1)) {</td></tr>
<tr><td class="h"><a name="1750"></a>1750</td><td></td><td></td><td></td><td></td><td class="s">         $entry++ ;</td></tr>
<tr><td class="h"><a name="1751"></a>1751</td><td></td><td></td><td></td><td></td><td class="s">         my $point_num = $entry ;</td></tr>
<tr><td class="h"><a name="1752"></a>1752</td><td></td><td></td><td></td><td></td><td class="s">         my $z = POSIX::floor($point_num / $xy_plane_size) ;</td></tr>
<tr><td class="h"><a name="1753"></a>1753</td><td></td><td></td><td></td><td></td><td class="s">         my $y = POSIX::floor(($point_num - $z * $xy_plane_size) / $xdim) ;</td></tr>
<tr><td class="h"><a name="1754"></a>1754</td><td></td><td></td><td></td><td></td><td class="s">         my $x = $point_num - $z * $xy_plane_size - $y * $xdim - 1 ;</td></tr>
<tr><td class="h"><a name="1755"></a>1755</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1756"></a>1756</td><td></td><td></td><td></td><td></td><td class="s">         my $strx = unpack(&quot;C&quot;, $buffer) ;</td></tr>
<tr><td class="h"><a name="1757"></a>1757</td><td></td><td></td><td></td><td></td><td class="s">         if ($strx == 0) {next;}</td></tr>
<tr><td class="h"><a name="1758"></a>1758</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1759"></a>1759</td><td></td><td></td><td></td><td></td><td class="s">         $data-&gt;{point2strx}-&gt;{&quot;$x,$y,$z&quot;} = $strx ;</td></tr>
<tr><td class="h"><a name="1760"></a>1760</td><td></td><td></td><td></td><td></td><td class="s">         $data-&gt;{strx2points}-&gt;{$strx}-&gt;{&quot;$x,$y,$z&quot;}++ ;</td></tr>
<tr><td class="h"><a name="1761"></a>1761</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="1762"></a>1762</td><td></td><td></td><td></td><td></td><td class="s">      close(ANNF) ;</td></tr>
<tr><td class="h"><a name="1763"></a>1763</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="1764"></a>1764</td><td class="c3">1</td><td class="c1"><span title="Avg 87µs">87µs</span></td><td></td><td></td><td class="s">   return $data ;</td></tr>
<tr><td class="h"><a name="1765"></a>1765</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="1766"></a>1766</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="- -"></a>- -</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1769"></a>1769</td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 386µs within alnmnr::io::get_kids which was called 59 times, avg 7µs/call:
# 58 times (354µs+-354µs) by alnmnr::io::get_kids at <a href="alnmnr-io-pm-49-line.html#1779">line 1779</a>, avg 0s/call
#     once (32µs+354µs) by alnmnr::io::get_brainstrx_info at <a href="alnmnr-io-pm-49-line.html#1673">line 1673</a></div></div>sub get_kids {</td></tr>
<tr><td class="h"><a name="1770"></a>1770</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1771"></a>1771</td><td class="c0">59</td><td class="c3"><span title="Avg 212ns">12µs</span></td><td></td><td></td><td class="s">   my $in = shift ;</td></tr>
<tr><td class="h"><a name="1772"></a>1772</td><td class="c0">59</td><td class="c3"><span title="Avg 112ns">7µs</span></td><td></td><td></td><td class="s">   my @kids ;</td></tr>
<tr><td class="h"><a name="1773"></a>1773</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1774"></a>1774</td><td class="c0">59</td><td class="c1"><span title="Avg 2µs">98µs</span></td><td></td><td></td><td class="s">   if (!exists $in-&gt;{tree}-&gt;{kids}-&gt;{$in-&gt;{node}}) {</td></tr>
<tr><td class="h"><a name="1775"></a>1775</td><td></td><td></td><td></td><td></td><td class="s">      return () ;</td></tr>
<tr><td class="h"><a name="1776"></a>1776</td><td></td><td></td><td></td><td></td><td class="s">   } ;</td></tr>
<tr><td class="h"><a name="1777"></a>1777</td><td class="c1">24</td><td class="c3"><span title="Avg 2µs">36µs</span></td><td></td><td></td><td class="s">   foreach my $kid (keys %{$in-&gt;{tree}-&gt;{kids}-&gt;{$in-&gt;{node}}}) {</td></tr>
<tr><td class="h"><a name="1778"></a>1778</td><td class="c0">58</td><td class="c3"><span title="Avg 281ns">16µs</span></td><td></td><td></td><td class="s">      push @kids, $kid ;</td></tr>
<tr><td class="h"><a name="1779"></a>1779</td><td class="c0">58</td><td class="c0"><span title="Avg 3µs">151µs</span></td><td class="c0">58</td><td class="c3">0s</td><td class="s">      push @kids, get_kids({node =&gt; $kid, tree =&gt; $in-&gt;{tree}}) ;<div class="calls"><div class="calls_out">      # spent  1.04ms making 58 calls to <a href="alnmnr-io-pm-49-line.html#1769">alnmnr::io::get_kids</a>, avg 18µs/call, recursion: max depth 5, sum of overlapping time 1.04ms</div></div></td></tr>
<tr><td class="h"><a name="1780"></a>1780</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="1781"></a>1781</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1782"></a>1782</td><td class="c1">24</td><td class="c2"><span title="Avg 3µs">65µs</span></td><td></td><td></td><td class="s">   return @kids ;</td></tr>
<tr><td class="h"><a name="1783"></a>1783</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="1784"></a>1784</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1785"></a>1785</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1786"></a>1786</td><td></td><td></td><td></td><td></td><td class="s">=head2 readin_1col_arr()</td></tr>
<tr><td class="h"><a name="1787"></a>1787</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1788"></a>1788</td><td></td><td></td><td></td><td></td><td class="s">   Title:       readin_1col_arr()</td></tr>
<tr><td class="h"><a name="1789"></a>1789</td><td></td><td></td><td></td><td></td><td class="s">   Function:    Reads in a single column and returns an arrayref of the values</td></tr>
<tr><td class="h"><a name="1790"></a>1790</td><td></td><td></td><td></td><td></td><td class="s">   Args:        $_-&gt;{fn} = input filename</td></tr>
<tr><td class="h"><a name="1791"></a>1791</td><td></td><td></td><td></td><td></td><td class="s">   Returns:     $_-&gt;[i] = value of the ith lines in the file</td></tr>
<tr><td class="h"><a name="1792"></a>1792</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1793"></a>1793</td><td></td><td></td><td></td><td></td><td class="s">=cut</td></tr>
<tr><td class="h"><a name="1794"></a>1794</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1795"></a>1795</td><td></td><td></td><td></td><td></td><td class="s">sub readin_1col_arr {</td></tr>
<tr><td class="h"><a name="1796"></a>1796</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1797"></a>1797</td><td></td><td></td><td></td><td></td><td class="s">   my $in = shift;</td></tr>
<tr><td class="h"><a name="1798"></a>1798</td><td></td><td></td><td></td><td></td><td class="s">   my $fn = $in-&gt;{fn} ;</td></tr>
<tr><td class="h"><a name="1799"></a>1799</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1800"></a>1800</td><td></td><td></td><td></td><td></td><td class="s">   open (FH, $in-&gt;{fn}) ;</td></tr>
<tr><td class="h"><a name="1801"></a>1801</td><td></td><td></td><td></td><td></td><td class="s">   my $results; </td></tr>
<tr><td class="h"><a name="1802"></a>1802</td><td></td><td></td><td></td><td></td><td class="s">   while (my $line = &lt;FH&gt;) {</td></tr>
<tr><td class="h"><a name="1803"></a>1803</td><td></td><td></td><td></td><td></td><td class="s">      chomp $line;</td></tr>
<tr><td class="h"><a name="1804"></a>1804</td><td></td><td></td><td></td><td></td><td class="s">      push @{$results}, $line ;</td></tr>
<tr><td class="h"><a name="1805"></a>1805</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="1806"></a>1806</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1807"></a>1807</td><td></td><td></td><td></td><td></td><td class="s">   return $results;</td></tr>
<tr><td class="h"><a name="1808"></a>1808</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="1809"></a>1809</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1810"></a>1810</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1811"></a>1811</td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 84.0ms (44.8+39.1) within alnmnr::io::parse_image_series_xml which was called 11 times, avg 7.63ms/call:
# 11 times (44.8ms+39.1ms) by alnmnr::io::aba_parse_xpz at <a href="alnmnr-io-pm-49-line.html#125">line 125</a>, avg 7.63ms/call</div></div>sub parse_image_series_xml {</td></tr>
<tr><td class="h"><a name="1812"></a>1812</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1813"></a>1813</td><td class="c3">11</td><td class="c3"><span title="Avg 2µs">24µs</span></td><td></td><td></td><td class="s">   my $in       = shift;</td></tr>
<tr><td class="h"><a name="1814"></a>1814</td><td class="c3">11</td><td class="c3"><span title="Avg 3µs">38µs</span></td><td></td><td></td><td class="s">   my $data     = $in-&gt;{data} ;</td></tr>
<tr><td class="h"><a name="1815"></a>1815</td><td class="c3">11</td><td class="c3"><span title="Avg 1µs">12µs</span></td><td></td><td></td><td class="s">   my $fn       = $in-&gt;{fn} ;</td></tr>
<tr><td class="h"><a name="1816"></a>1816</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1817"></a>1817</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1818"></a>1818</td><td class="c3">11</td><td class="c2"><span title="Avg 5µs">58µs</span></td><td></td><td></td><td class="s">   my $image_keys = {} ;</td></tr>
<tr><td class="h"><a name="1819"></a>1819</td><td class="c3">11</td><td class="c0"><span title="Avg 189µs">2.07ms</span></td><td></td><td></td><td class="s">   map {$image_keys-&gt;{$_}++;}</td></tr>
<tr><td class="h"><a name="1820"></a>1820</td><td></td><td></td><td></td><td></td><td class="s">      (qw/id imagepath expression-imagepath height width left top/,</td></tr>
<tr><td class="h"><a name="1821"></a>1821</td><td></td><td></td><td></td><td></td><td class="s">       qw/parentimageheight parentimagewidth/,</td></tr>
<tr><td class="h"><a name="1822"></a>1822</td><td></td><td></td><td></td><td></td><td class="s">       qw/specimen-tissue-index section-index/,</td></tr>
<tr><td class="h"><a name="1823"></a>1823</td><td></td><td></td><td></td><td></td><td class="s">       qw/tsv tvs z-value/) ;</td></tr>
<tr><td class="h"><a name="1824"></a>1824</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1825"></a>1825</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1826"></a>1826</td><td class="c3">11</td><td class="c0"><span title="Avg 437µs">4.81ms</span></td><td class="c3">11</td><td class="c0">4.63ms</td><td class="s">   open(XMLINFO, $fn) ;<div class="calls"><div class="calls_out">   # spent  4.63ms making 11 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_open">alnmnr::io::CORE:open</a>, avg 421µs/call</div></div></td></tr>
<tr><td class="h"><a name="1827"></a>1827</td><td></td><td></td><td></td><td></td><td class="s"># &lt;section-thickness&gt; only in adult series...</td></tr>
<tr><td class="h"><a name="1828"></a>1828</td><td class="c3">11</td><td class="c0"><span title="Avg 653µs">7.19ms</span></td><td class="c0">447</td><td class="c0">5.98ms</td><td class="s">   while (my $line = &lt;XMLINFO&gt;) {<div class="calls"><div class="calls_out">   # spent  5.98ms making 447 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_readline">alnmnr::io::CORE:readline</a>, avg 13µs/call</div></div></td></tr>
<tr><td class="h"><a name="1829"></a>1829</td><td class="c0">447</td><td class="c0"><span title="Avg 408ns">182µs</span></td><td></td><td></td><td class="s">      chomp $line;</td></tr>
<tr><td class="h"><a name="1830"></a>1830</td><td class="c0">447</td><td class="c0"><span title="Avg 29µs">13.0ms</span></td><td class="c0">3433</td><td class="c0">1.82ms</td><td class="s">      if ($line =~ /^  &lt;id/) {<div class="calls"><div class="calls_out">      # spent  1.82ms making 3433 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_match">alnmnr::io::CORE:match</a>, avg 530ns/call</div></div></td></tr>
<tr><td class="h"><a name="1831"></a>1831</td><td class="c3">11</td><td class="c0"><span title="Avg 32µs">351µs</span></td><td class="c3">11</td><td class="c3">137µs</td><td class="s">         ($data-&gt;{meta}-&gt;{imageseries_id}) = ($line =~ /&lt;id&gt;([0-9]+)&lt;\/id&gt;/) ;<div class="calls"><div class="calls_out">         # spent   137µs making 11 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_match">alnmnr::io::CORE:match</a>, avg 12µs/call</div></div></td></tr>
<tr><td class="h"><a name="1832"></a>1832</td><td></td><td></td><td></td><td></td><td class="s">      } elsif ($line =~ /&lt;plane-of-section&gt;/) {</td></tr>
<tr><td class="h"><a name="1833"></a>1833</td><td class="c3">11</td><td class="c0"><span title="Avg 20µs">219µs</span></td><td class="c3">11</td><td class="c3">83µs</td><td class="s">         ($data-&gt;{meta}-&gt;{plane}) = ($line =~ /&lt;plane-of-section&gt;(.+)&lt;\/plane-of-section&gt;/) ;<div class="calls"><div class="calls_out">         # spent    83µs making 11 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_match">alnmnr::io::CORE:match</a>, avg 8µs/call</div></div></td></tr>
<tr><td class="h"><a name="1834"></a>1834</td><td></td><td></td><td></td><td></td><td class="s">      } elsif ($line =~ /&lt;section-thickness&gt;/) {</td></tr>
<tr><td class="h"><a name="1835"></a>1835</td><td class="c3">11</td><td class="c0"><span title="Avg 19µs">204µs</span></td><td class="c3">11</td><td class="c3">73µs</td><td class="s">         ($data-&gt;{meta}-&gt;{&quot;section-thickness&quot;}) =<div class="calls"><div class="calls_out">         # spent    73µs making 11 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_match">alnmnr::io::CORE:match</a>, avg 7µs/call</div></div></td></tr>
<tr><td class="h"><a name="1836"></a>1836</td><td></td><td></td><td></td><td></td><td class="s">            ($line =~ /&lt;section-thickness&gt;(.+)&lt;\/section-thickness&gt;/) ;</td></tr>
<tr><td class="h"><a name="1837"></a>1837</td><td></td><td></td><td></td><td></td><td class="s">      } elsif ($line =~ /&lt;age&gt;/) {</td></tr>
<tr><td class="h"><a name="1838"></a>1838</td><td class="c3">11</td><td class="c0"><span title="Avg 14µs">153µs</span></td><td class="c3">11</td><td class="c3">50µs</td><td class="s">         ($data-&gt;{meta}-&gt;{stage}) = ($line =~ /&lt;age&gt;(.+)&lt;\/age&gt;/) ;<div class="calls"><div class="calls_out">         # spent    50µs making 11 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_match">alnmnr::io::CORE:match</a>, avg 5µs/call</div></div></td></tr>
<tr><td class="h"><a name="1839"></a>1839</td><td></td><td></td><td></td><td></td><td class="s">      } elsif ($line =~ /&lt;trv&gt;/) {</td></tr>
<tr><td class="h"><a name="1840"></a>1840</td><td class="c3">11</td><td class="c0"><span title="Avg 18µs">200µs</span></td><td class="c3">11</td><td class="c3">70µs</td><td class="s">         ($data-&gt;{meta}-&gt;{trv}) = ($line =~ /&lt;trv&gt;(.+)&lt;\/trv&gt;/) ;<div class="calls"><div class="calls_out">         # spent    70µs making 11 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_match">alnmnr::io::CORE:match</a>, avg 6µs/call</div></div></td></tr>
<tr><td class="h"><a name="1841"></a>1841</td><td></td><td></td><td></td><td></td><td class="s">      } elsif ($line =~ /&lt;tvr&gt;/) {</td></tr>
<tr><td class="h"><a name="1842"></a>1842</td><td class="c3">11</td><td class="c0"><span title="Avg 20µs">219µs</span></td><td class="c3">11</td><td class="c3">76µs</td><td class="s">         ($data-&gt;{meta}-&gt;{tvr}) = ($line =~ /&lt;tvr&gt;(.+)&lt;\/tvr&gt;/) ;<div class="calls"><div class="calls_out">         # spent    76µs making 11 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_match">alnmnr::io::CORE:match</a>, avg 7µs/call</div></div></td></tr>
<tr><td class="h"><a name="1843"></a>1843</td><td></td><td></td><td></td><td></td><td class="s">      } elsif ($line =~ /&lt;gene-symbol&gt;/) {</td></tr>
<tr><td class="h"><a name="1844"></a>1844</td><td class="c3">11</td><td class="c0"><span title="Avg 17µs">182µs</span></td><td class="c3">11</td><td class="c3">71µs</td><td class="s">         ($data-&gt;{meta}-&gt;{gene_name}) = ($line =~ /&lt;gene-symbol&gt;(.+)&lt;\/gene-symbol&gt;/) ;<div class="calls"><div class="calls_out">         # spent    71µs making 11 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_match">alnmnr::io::CORE:match</a>, avg 6µs/call</div></div></td></tr>
<tr><td class="h"><a name="1845"></a>1845</td><td></td><td></td><td></td><td></td><td class="s">#      } elsif ($line =~ /&lt;\/gene&gt;$/) {</td></tr>
<tr><td class="h"><a name="1846"></a>1846</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1847"></a>1847</td><td></td><td></td><td></td><td></td><td class="s">      } elsif ($line =~ /^    &lt;image&gt;/) {</td></tr>
<tr><td class="h"><a name="1848"></a>1848</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1849"></a>1849</td><td class="c0">205</td><td class="c3"><span title="Avg 170ns">35µs</span></td><td></td><td></td><td class="s">         my $curimage ;</td></tr>
<tr><td class="h"><a name="1850"></a>1850</td><td class="c0">205</td><td class="c0"><span title="Avg 6µs">1.20ms</span></td><td class="c0">205</td><td class="c1">686µs</td><td class="s">         while ($line = &lt;XMLINFO&gt;) {<div class="calls"><div class="calls_out">         # spent   686µs making 205 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_readline">alnmnr::io::CORE:readline</a>, avg 3µs/call</div></div></td></tr>
<tr><td class="h"><a name="1851"></a>1851</td><td class="c0">3075</td><td class="c0"><span title="Avg 2µs">6.64ms</span></td><td class="c0">2870</td><td class="c0">1.39ms</td><td class="s">            if ($line =~ /^    &lt;\/image&gt;/) {last;}<div class="calls"><div class="calls_out">            # spent  1.39ms making 2870 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_match">alnmnr::io::CORE:match</a>, avg 484ns/call</div></div></td></tr>
<tr><td class="h"><a name="1852"></a>1852</td><td class="c0">2665</td><td class="c0"><span title="Avg 363ns">968µs</span></td><td></td><td></td><td class="s">            chomp $line;</td></tr>
<tr><td class="h"><a name="1853"></a>1853</td><td class="c0">2665</td><td class="c0"><span title="Avg 9µs">22.9ms</span></td><td class="c0">2665</td><td class="c0">15.3ms</td><td class="s">            my ($key, $val) = ($line =~ /&lt;([^&gt;]+)&gt;(.+)&lt;\//) ;<div class="calls"><div class="calls_out">            # spent  15.3ms making 2665 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_match">alnmnr::io::CORE:match</a>, avg 6µs/call</div></div></td></tr>
<tr><td class="h"><a name="1854"></a>1854</td><td class="c0">2665</td><td class="c0"><span title="Avg 496ns">1.32ms</span></td><td></td><td></td><td class="s">            if (!defined $key || !exists $image_keys-&gt;{$key}) {next;}</td></tr>
<tr><td class="h"><a name="1855"></a>1855</td><td class="c0">2665</td><td class="c0"><span title="Avg 8µs">20.4ms</span></td><td class="c0">2665</td><td class="c0">8.59ms</td><td class="s">            $curimage-&gt;{$key} = $val ;<div class="calls"><div class="calls_out">            # spent  8.59ms making 2665 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_readline">alnmnr::io::CORE:readline</a>, avg 3µs/call</div></div></td></tr>
<tr><td class="h"><a name="1856"></a>1856</td><td></td><td></td><td></td><td></td><td class="s">         }</td></tr>
<tr><td class="h"><a name="1857"></a>1857</td><td class="c0">205</td><td class="c0"><span title="Avg 5µs">1.06ms</span></td><td></td><td></td><td class="s">         $data-&gt;{meta}-&gt;{images}-&gt;{$curimage-&gt;{&quot;z-value&quot;}} = $curimage ;</td></tr>
<tr><td class="h"><a name="1858"></a>1858</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1859"></a>1859</td><td></td><td></td><td></td><td></td><td class="s">      } elsif ($line =~ /&lt;\/images&gt;$/) {</td></tr>
<tr><td class="h"><a name="1860"></a>1860</td><td class="c3">11</td><td class="c3"><span title="Avg 1µs">13µs</span></td><td></td><td></td><td class="s">         last;</td></tr>
<tr><td class="h"><a name="1861"></a>1861</td><td></td><td></td><td></td><td></td><td class="s">      }</td></tr>
<tr><td class="h"><a name="1862"></a>1862</td><td></td><td></td><td></td><td></td><td class="s">   }</td></tr>
<tr><td class="h"><a name="1863"></a>1863</td><td></td><td></td><td></td><td></td><td class="s"># now read in image data</td></tr>
<tr><td class="h"><a name="1864"></a>1864</td><td class="c3">11</td><td class="c0"><span title="Avg 22µs">244µs</span></td><td class="c3">11</td><td class="c3">148µs</td><td class="s">   close(XMLINFO) ;<div class="calls"><div class="calls_out">   # spent   148µs making 11 calls to <a href="alnmnr-io-pm-49-line.html#alnmnr__io__CORE_close">alnmnr::io::CORE:close</a>, avg 13µs/call</div></div></td></tr>
<tr><td class="h"><a name="1865"></a>1865</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1866"></a>1866</td><td class="c3">11</td><td class="c0"><span title="Avg 17µs">192µs</span></td><td></td><td></td><td class="s">   return ;</td></tr>
<tr><td class="h"><a name="1867"></a>1867</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1868"></a>1868</td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h"><a name="1869"></a>1869</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="- -"></a>- -</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1872"></a>1872</td><td></td><td></td><td></td><td></td><td class="s">#fpd111219_1114 </td></tr>
<tr><td class="h"><a name="1873"></a>1873</td><td></td><td></td><td></td><td></td><td class="s">#sub readbitvec_roi_list_results {</td></tr>
<tr><td class="h"><a name="1874"></a>1874</td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h"><a name="1875"></a>1875</td><td></td><td></td><td></td><td></td><td class="s">#   my $in = shift;</td></tr>
<tr><td class="h"><a name="1876"></a>1876</td><td></td><td></td><td></td><td></td><td class="s">#   my $f2i ;</td></tr>
<tr><td class="h"><a name="1877"></a>1877</td><td></td><td></td><td></td><td></td><td class="s">#   foreach my $j ( 0 .. $#{$in-&gt;{headers}-&gt;{headers}}) {</td></tr>
<tr><td class="h"><a name="1878"></a>1878</td><td></td><td></td><td></td><td></td><td class="s">#      $f2i-&gt;{$in-&gt;{headers}-&gt;{headers}-&gt;[$j]} = $j ; }</td></tr>
<tr><td class="h"><a name="1879"></a>1879</td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h"><a name="1880"></a>1880</td><td></td><td></td><td></td><td></td><td class="s">## 1. read through first gene to get roi names, keep levels in buffer</td></tr>
<tr><td class="h"><a name="1881"></a>1881</td><td></td><td></td><td></td><td></td><td class="s">## 2. convert first gene to bit vector</td></tr>
<tr><td class="h"><a name="1882"></a>1882</td><td></td><td></td><td></td><td></td><td class="s">## 3. read ahead and assign bit vectors on the fly</td></tr>
<tr><td class="h"><a name="1883"></a>1883</td><td></td><td></td><td></td><td></td><td class="s">## 4. send back absence/presence bit vectors</td></tr>
<tr><td class="h"><a name="1884"></a>1884</td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h"><a name="1885"></a>1885</td><td></td><td></td><td></td><td></td><td class="s">#   open(RESULTSF, $in-&gt;{fn}) ;</td></tr>
<tr><td class="h"><a name="1886"></a>1886</td><td></td><td></td><td></td><td></td><td class="s">#   my $roi_data ;</td></tr>
<tr><td class="h"><a name="1887"></a>1887</td><td></td><td></td><td></td><td></td><td class="s">#   while (my $line = &lt;RESULTSF&gt;) {</td></tr>
<tr><td class="h"><a name="1888"></a>1888</td><td></td><td></td><td></td><td></td><td class="s">#      chomp $line;</td></tr>
<tr><td class="h"><a name="1889"></a>1889</td><td></td><td></td><td></td><td></td><td class="s">#      if ($line =~ /^#/) {next;}</td></tr>
<tr><td class="h"><a name="1890"></a>1890</td><td></td><td></td><td></td><td></td><td class="s">#      my $entry ;</td></tr>
<tr><td class="h"><a name="1891"></a>1891</td><td></td><td></td><td></td><td></td><td class="s">#      my @t = split(/\t/, $line) ;</td></tr>
<tr><td class="h"><a name="1892"></a>1892</td><td></td><td></td><td></td><td></td><td class="s">#      foreach my $j (0 .. $#t) {</td></tr>
<tr><td class="h"><a name="1893"></a>1893</td><td></td><td></td><td></td><td></td><td class="s">#         $entry-&gt;{$in-&gt;{headers}-&gt;{headers}-&gt;[$j]} = $t[$j] ;</td></tr>
<tr><td class="h"><a name="1894"></a>1894</td><td></td><td></td><td></td><td></td><td class="s">#      }</td></tr>
<tr><td class="h"><a name="1895"></a>1895</td><td></td><td></td><td></td><td></td><td class="s">#      if ($entry-&gt;{plane} ne 'sagittal' &amp;&amp;</td></tr>
<tr><td class="h"><a name="1896"></a>1896</td><td></td><td></td><td></td><td></td><td class="s">#          $entry-&gt;{plane} ne 'coronal') {</td></tr>
<tr><td class="h"><a name="1897"></a>1897</td><td></td><td></td><td></td><td></td><td class="s">#         next; }</td></tr>
<tr><td class="h"><a name="1898"></a>1898</td><td></td><td></td><td></td><td></td><td class="s">#      foreach my $f (sort keys %{$f2i}) {</td></tr>
<tr><td class="h"><a name="1899"></a>1899</td><td></td><td></td><td></td><td></td><td class="s">#         push @{$roi_data-&gt;{$entry-&gt;{roi_name}}-&gt;{$entry-&gt;{plane}}-&gt;{$f}},</td></tr>
<tr><td class="h"><a name="1900"></a>1900</td><td></td><td></td><td></td><td></td><td class="s">#            $entry-&gt;{$f} ; }</td></tr>
<tr><td class="h"><a name="1901"></a>1901</td><td></td><td></td><td></td><td></td><td class="s">#   }</td></tr>
<tr><td class="h"><a name="1902"></a>1902</td><td></td><td></td><td></td><td></td><td class="s">#   close(RESULTSF) ;</td></tr>
<tr><td class="h"><a name="1903"></a>1903</td><td></td><td></td><td></td><td></td><td class="s">#   return $roi_data ;</td></tr>
<tr><td class="h"><a name="1904"></a>1904</td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h"><a name="1905"></a>1905</td><td></td><td></td><td></td><td></td><td class="s">#}</td></tr>
<tr><td class="h"><a name="1906"></a>1906</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1907"></a>1907</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="1908"></a>1908</td><td class="c3">1</td><td class="c3"><span title="Avg 3µs">3µs</span></td><td></td><td></td><td class="s">1;</td></tr>
<tr><td class="s"><a name=""></a>&nbsp;</td><td></td><td></td><td></td><td></td><td class="s"></td></tr>
<tr><td class="h"><a name="alnmnr__io__CORE_chdir"></a></td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 2.45ms within alnmnr::io::CORE:chdir which was called 33 times, avg 74µs/call:
# 11 times (2.17ms+0s) by alnmnr::io::aba_parse_xpz at <a href="alnmnr-io-pm-49-line.html#277">line 277</a>, avg 197µs/call
# 11 times (196µs+0s) by alnmnr::io::aba_parse_xpz at <a href="alnmnr-io-pm-49-line.html#105">line 105</a>, avg 18µs/call
# 11 times (87µs+0s) by alnmnr::io::aba_parse_xpz at <a href="alnmnr-io-pm-49-line.html#102">line 102</a>, avg 8µs/call</div></div>sub alnmnr::io::CORE:chdir; # opcode<br />        </td></tr>
<tr><td class="h"><a name="alnmnr__io__CORE_close"></a></td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 846µs within alnmnr::io::CORE:close which was called 58 times, avg 15µs/call:
# 22 times (536µs+0s) by alnmnr::io::aba_parse_xpz at <a href="alnmnr-io-pm-49-line.html#186">line 186</a>, avg 24µs/call
# 22 times (125µs+0s) by alnmnr::io::aba_parse_xpz at <a href="alnmnr-io-pm-49-line.html#154">line 154</a>, avg 6µs/call
# 11 times (148µs+0s) by alnmnr::io::parse_image_series_xml at <a href="alnmnr-io-pm-49-line.html#1864">line 1864</a>, avg 13µs/call
#     once (21µs+0s) by alnmnr::io::load_aba_Annotation at <a href="alnmnr-io-pm-49-line.html#1737">line 1737</a>
#     once (9µs+0s) by alnmnr::io::load_aba_brainstructures at <a href="alnmnr-io-pm-49-line.html#1506">line 1506</a>
#     once (8µs+0s) by alnmnr::io::readin_roi_file at <a href="alnmnr-io-pm-49-line.html#936">line 936</a></div></div>sub alnmnr::io::CORE:close; # opcode<br />        </td></tr>
<tr><td class="h"><a name="alnmnr__io__CORE_ftsize"></a></td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 3.15ms within alnmnr::io::CORE:ftsize which was called 70 times, avg 45µs/call:
# 55 times (324µs+0s) by alnmnr::io::aba_parse_xpz at <a href="alnmnr-io-pm-49-line.html#110">line 110</a>, avg 6µs/call
# 11 times (419µs+0s) by alnmnr::io::aba_parse_xpz at <a href="alnmnr-io-pm-49-line.html#87">line 87</a>, avg 38µs/call
#     once (1.71ms+0s) by alnmnr::io::load_aba_Annotation at <a href="alnmnr-io-pm-49-line.html#1713">line 1713</a>
#     once (393µs+0s) by alnmnr::io::load_aba_brainstructures at <a href="alnmnr-io-pm-49-line.html#1461">line 1461</a>
#     once (288µs+0s) by alnmnr::io::load_aba_Annotation at <a href="alnmnr-io-pm-49-line.html#1718">line 1718</a>
#     once (11µs+0s) by alnmnr::io::readin_roi_file at <a href="alnmnr-io-pm-49-line.html#864">line 864</a></div></div>sub alnmnr::io::CORE:ftsize; # opcode<br />        </td></tr>
<tr><td class="h"><a name="alnmnr__io__CORE_match"></a></td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 19.1ms within alnmnr::io::CORE:match which was called 9052 times, avg 2µs/call:
# 3433 times (1.82ms+0s) by alnmnr::io::parse_image_series_xml at <a href="alnmnr-io-pm-49-line.html#1830">line 1830</a>, avg 530ns/call
# 2870 times (1.39ms+0s) by alnmnr::io::parse_image_series_xml at <a href="alnmnr-io-pm-49-line.html#1851">line 1851</a>, avg 484ns/call
# 2665 times (15.3ms+0s) by alnmnr::io::parse_image_series_xml at <a href="alnmnr-io-pm-49-line.html#1853">line 1853</a>, avg 6µs/call
#   11 times (137µs+0s) by alnmnr::io::parse_image_series_xml at <a href="alnmnr-io-pm-49-line.html#1831">line 1831</a>, avg 12µs/call
#   11 times (83µs+0s) by alnmnr::io::parse_image_series_xml at <a href="alnmnr-io-pm-49-line.html#1833">line 1833</a>, avg 8µs/call
#   11 times (76µs+0s) by alnmnr::io::parse_image_series_xml at <a href="alnmnr-io-pm-49-line.html#1842">line 1842</a>, avg 7µs/call
#   11 times (73µs+0s) by alnmnr::io::parse_image_series_xml at <a href="alnmnr-io-pm-49-line.html#1835">line 1835</a>, avg 7µs/call
#   11 times (71µs+0s) by alnmnr::io::parse_image_series_xml at <a href="alnmnr-io-pm-49-line.html#1844">line 1844</a>, avg 6µs/call
#   11 times (70µs+0s) by alnmnr::io::parse_image_series_xml at <a href="alnmnr-io-pm-49-line.html#1840">line 1840</a>, avg 6µs/call
#   11 times (50µs+0s) by alnmnr::io::parse_image_series_xml at <a href="alnmnr-io-pm-49-line.html#1838">line 1838</a>, avg 5µs/call
#    3 times (9µs+0s) by alnmnr::io::get_brainstrx_voxels at <a href="alnmnr-io-pm-49-line.html#1556">line 1556</a>, avg 3µs/call
#    2 times (3µs+0s) by alnmnr::io::readin_roi_file at <a href="alnmnr-io-pm-49-line.html#884">line 884</a>, avg 1µs/call
#       once (13µs+0s) by alnmnr::io::get_brainstrx_info at <a href="alnmnr-io-pm-49-line.html#1659">line 1659</a>
#       once (400ns+0s) by alnmnr::io::readin_roi_file at <a href="alnmnr-io-pm-49-line.html#894">line 894</a></div></div>sub alnmnr::io::CORE:match; # opcode<br />        </td></tr>
<tr><td class="h"><a name="alnmnr__io__CORE_open"></a></td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 26.4ms within alnmnr::io::CORE:open which was called 58 times, avg 456µs/call:
# 22 times (11.3ms+0s) by alnmnr::io::aba_parse_xpz at <a href="alnmnr-io-pm-49-line.html#148">line 148</a>, avg 512µs/call
# 22 times (9.62ms+0s) by alnmnr::io::aba_parse_xpz at <a href="alnmnr-io-pm-49-line.html#175">line 175</a>, avg 437µs/call
# 11 times (4.63ms+0s) by alnmnr::io::parse_image_series_xml at <a href="alnmnr-io-pm-49-line.html#1826">line 1826</a>, avg 421µs/call
#     once (336µs+0s) by alnmnr::io::load_aba_brainstructures at <a href="alnmnr-io-pm-49-line.html#1464">line 1464</a>
#     once (303µs+0s) by alnmnr::io::load_aba_Annotation at <a href="alnmnr-io-pm-49-line.html#1730">line 1730</a>
#     once (283µs+0s) by alnmnr::io::readin_roi_file at <a href="alnmnr-io-pm-49-line.html#878">line 878</a></div></div>sub alnmnr::io::CORE:open; # opcode<br />        </td></tr>
<tr><td class="h"><a name="alnmnr__io__CORE_print"></a></td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 64µs within alnmnr::io::CORE:print which was called 3 times, avg 21µs/call:
#    once (36µs+0s) by alnmnr::io::readin_roi_file at <a href="alnmnr-io-pm-49-line.html#877">line 877</a>
#    once (25µs+0s) by alnmnr::io::readin_roi_file at <a href="alnmnr-io-pm-49-line.html#985">line 985</a>
#    once (3µs+0s) by alnmnr::io::readin_roi_file at <a href="alnmnr-io-pm-49-line.html#987">line 987</a></div></div>sub alnmnr::io::CORE:print; # opcode<br />        </td></tr>
<tr><td class="h"><a name="alnmnr__io__CORE_read"></a></td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 1.03s within alnmnr::io::CORE:read which was called 3505194 times, avg 294ns/call:
# 3505172 times (1.03s+0s) by alnmnr::io::aba_parse_xpz at <a href="alnmnr-io-pm-49-line.html#181">line 181</a>, avg 294ns/call
#      22 times (334µs+0s) by alnmnr::io::aba_parse_xpz at <a href="alnmnr-io-pm-49-line.html#178">line 178</a>, avg 15µs/call</div></div>sub alnmnr::io::CORE:read; # opcode<br />        </td></tr>
<tr><td class="h"><a name="alnmnr__io__CORE_readline"></a></td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 94.4ms within alnmnr::io::CORE:readline which was called 267454 times, avg 353ns/call:
# 262961 times (77.2ms+0s) by alnmnr::io::load_aba_Annotation at <a href="alnmnr-io-pm-49-line.html#1731">line 1731</a>, avg 294ns/call
#   2665 times (8.59ms+0s) by alnmnr::io::parse_image_series_xml at <a href="alnmnr-io-pm-49-line.html#1855">line 1855</a>, avg 3µs/call
#    865 times (1.43ms+0s) by alnmnr::io::load_aba_brainstructures at <a href="alnmnr-io-pm-49-line.html#1494">line 1494</a>, avg 2µs/call
#    447 times (5.98ms+0s) by alnmnr::io::parse_image_series_xml at <a href="alnmnr-io-pm-49-line.html#1828">line 1828</a>, avg 13µs/call
#    308 times (502µs+0s) by alnmnr::io::aba_parse_xpz at <a href="alnmnr-io-pm-49-line.html#149">line 149</a>, avg 2µs/call
#    205 times (686µs+0s) by alnmnr::io::parse_image_series_xml at <a href="alnmnr-io-pm-49-line.html#1850">line 1850</a>, avg 3µs/call
#      2 times (21µs+0s) by alnmnr::io::readin_roi_file at <a href="alnmnr-io-pm-49-line.html#883">line 883</a>, avg 10µs/call
#         once (24µs+0s) by alnmnr::io::load_aba_brainstructures at <a href="alnmnr-io-pm-49-line.html#1475">line 1475</a></div></div>sub alnmnr::io::CORE:readline; # opcode<br />        </td></tr>
<tr><td class="h"><a name="alnmnr__io__CORE_rmdir"></a></td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 10.6ms within alnmnr::io::CORE:rmdir which was called 11 times, avg 959µs/call:
# 11 times (10.6ms+0s) by alnmnr::io::aba_parse_xpz at <a href="alnmnr-io-pm-49-line.html#278">line 278</a>, avg 959µs/call</div></div>sub alnmnr::io::CORE:rmdir; # opcode<br />        </td></tr>
<tr><td class="h"><a name="alnmnr__io__CORE_subst"></a></td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 2.98ms within alnmnr::io::CORE:subst which was called 1728 times, avg 2µs/call:
# 864 times (1.79ms+0s) by alnmnr::io::load_aba_brainstructures at <a href="alnmnr-io-pm-49-line.html#1497">line 1497</a>, avg 2µs/call
# 864 times (1.19ms+0s) by alnmnr::io::load_aba_brainstructures at <a href="alnmnr-io-pm-49-line.html#1496">line 1496</a>, avg 1µs/call</div></div>sub alnmnr::io::CORE:subst; # opcode<br />        </td></tr>
<tr><td class="h"><a name="alnmnr__io__CORE_system"></a></td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 448ms within alnmnr::io::CORE:system which was called 11 times, avg 40.7ms/call:
# 11 times (448ms+0s) by alnmnr::io::aba_parse_xpz at <a href="alnmnr-io-pm-49-line.html#104">line 104</a>, avg 40.7ms/call</div></div>sub alnmnr::io::CORE:system; # opcode<br />        </td></tr>
<tr><td class="h"><a name="alnmnr__io__CORE_unlink"></a></td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 74.8ms within alnmnr::io::CORE:unlink which was called 66 times, avg 1.13ms/call:
# 55 times (62.0ms+0s) by alnmnr::io::aba_parse_xpz at <a href="alnmnr-io-pm-49-line.html#275">line 275</a>, avg 1.13ms/call
# 11 times (12.8ms+0s) by alnmnr::io::aba_parse_xpz at <a href="alnmnr-io-pm-49-line.html#276">line 276</a>, avg 1.16ms/call</div></div>sub alnmnr::io::CORE:unlink; # opcode<br />        </td></tr>
<tr><td class="h"><a name="alnmnr__io__CORE_unpack"></a></td><td></td><td></td><td></td><td></td><td class="s"><div class="calls"><div class="calls_in"># spent 1.39s within alnmnr::io::CORE:unpack which was called 3505172 times, avg 396ns/call:
# 3505172 times (1.39s+0s) by alnmnr::io::aba_parse_xpz at <a href="alnmnr-io-pm-49-line.html#179">line 179</a>, avg 396ns/call</div></div>sub alnmnr::io::CORE:unpack; # opcode<br />        </td></tr>
</tbody></table></div>
        
            <script type="text/javascript">
              $(document).ready(function() { 

        $("#subs_table").tablesorter({
            sortList: [[3,1]],
            headers: {
                3: { sorter: 'fmt_time' },
                4: { sorter: 'fmt_time' }
            }
        });
        $(".floatHeaders").each( function(){ $(this).floatThead(); } );

        show_fragment_target();
        $(window).on('hashchange', function(e){
          show_fragment_target();
        });

    
 } );
            </script>
        
        <div class="footer">Report produced by the
        <a href="http://metacpan.org/release/Devel-NYTProf/">NYTProf 6.04</a>
        Perl profiler, developed by
        <a href="http://www.linkedin.com/in/timbunce">Tim Bunce</a> based on
        work by Adam Kaplan and Salvador Fandiño García.
        </div>
        <br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
    </body></html>